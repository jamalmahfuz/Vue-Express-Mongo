{"version":3,"sources":["webpack:///bundle.js","webpack:///webpack/bootstrap 23409b1d95160a6d8db8","webpack:///./server/index.js","webpack:///./server/config/index.js","webpack:///external \"lodash\"","webpack:///./server/config/test.js","webpack:///external \"../package.json\"","webpack:///./server/config/prod.js","webpack:///./server/config/default.js","webpack:///external \"path\"","webpack:///./server/core/secrets.js","webpack:///external \"chalk\"","webpack:///external \"fs\"","webpack:///external \"secret-utils\"","webpack:///./server/core/logger.js","webpack:///external \"winston\"","webpack:///external \"le_node\"","webpack:///external \"winston-papertrail\"","webpack:///external \"winston-daily-rotate-file\"","webpack:///external \"winston-loggly-bulk\"","webpack:///external \"winston-logsene\"","webpack:///external \"winston-logzio\"","webpack:///external \"winston-graylog2\"","webpack:///external \"moment\"","webpack:///./server/core/init.js","webpack:///./server/core/mongo.js","webpack:///external \"mongoose\"","webpack:///external \"mongoose-auto-increment\"","webpack:///./server/core/seed-db.js","webpack:///./server/libs/tokgen.js","webpack:///external \"uuid-token-generator\"","webpack:///external \"fakerator\"","webpack:///./server/models/user.js","webpack:///./server/core/constants.js","webpack:///external \"crypto\"","webpack:///external \"bcrypt-nodejs\"","webpack:///./server/libs/hashids.js","webpack:///external \"hashids\"","webpack:///./server/applogic/libs/seed-db.js","webpack:///./server/applogic/modules/devices/models/device.js","webpack:///./server/applogic/modules/posts/models/post.js","webpack:///./server/core/express.js","webpack:///external \"express\"","webpack:///external \"http\"","webpack:///external \"express-flash\"","webpack:///external \"serve-favicon\"","webpack:///external \"morgan\"","webpack:///external \"body-parser\"","webpack:///external \"cookie-parser\"","webpack:///external \"express-validator\"","webpack:///external \"csurf\"","webpack:///external \"netjet\"","webpack:///external \"express-session\"","webpack:///external \"compression\"","webpack:///external \"method-override\"","webpack:///external \"helmet\"","webpack:///external \"helmet-crossdomain\"","webpack:///external \"connect-mongo\"","webpack:///external \"i18next\"","webpack:///external \"i18next-express-middleware\"","webpack:///external \"i18next-node-fs-backend\"","webpack:///external \"stream\"","webpack:///./server/core/auth/passport.js","webpack:///external \"passport\"","webpack:///./server/core/auth/strategies \\.js$","webpack:///./server/core/auth/strategies/apikey.js","webpack:///external \"passport-localapikey-update\"","webpack:///./server/core/auth/strategies/facebook.js","webpack:///./server/core/auth/helper.js","webpack:///external \"passport-facebook\"","webpack:///./server/core/auth/strategies/github.js","webpack:///external \"passport-github\"","webpack:///./server/core/auth/strategies/google.js","webpack:///external \"passport-google-oauth\"","webpack:///./server/core/auth/strategies/local.js","webpack:///external \"passport-local\"","webpack:///./server/core/auth/strategies/twitter.js","webpack:///external \"passport-twitter\"","webpack:///external \"webpack\"","webpack:///./webpack.dev.config.js","webpack:///external \"glob\"","webpack:///external \"precss\"","webpack:///external \"autoprefixer\"","webpack:///external \"webpack-dev-middleware\"","webpack:///external \"webpack-hot-middleware\"","webpack:///./server/routes/index.js","webpack:///./server/routes/account.js","webpack:///external \"async\"","webpack:///./server/core/response.js","webpack:///./server/libs/mailer.js","webpack:///external \"nodemailer\"","webpack:///external \"nodemailer-html-to-text\"","webpack:///external \"nodemailer-mailgun-transport\"","webpack:///external \"nodemailer-sendgrid-transport\"","webpack:///./server/routes/auth.js","webpack:///./server/applogic/routeHandlers.js","webpack:///./server/applogic/modules routes\\.js$","webpack:///./server/applogic/modules/counter/routes.js","webpack:///./server/applogic/modules/counter/memstore.js","webpack:///./server/applogic/modules/devices/routes.js","webpack:///./server/core/socket.js","webpack:///external \"socket.io\"","webpack:///./server/applogic/socketHandlers.js","webpack:///./server/applogic/modules socket\\.js$","webpack:///./server/applogic/modules/counter/socket.js","webpack:///./server/applogic/modules/devices/socket.js","webpack:///./server/applogic/modules/posts/socket.js","webpack:///./server/applogic/modules/posts/module.json","webpack:///./server/applogic/modules/posts/routes.js","webpack:///./server/applogic/modules/session/routes.js","webpack:///./server/routes/graphql.js","webpack:///external \"apollo-server\"","webpack:///external \"graphql-tools\"","webpack:///./server/schema/index.js","webpack:///./server/schema schema\\.js$","webpack:///./server/schema/user.schema.js","webpack:///./server/libs/schema-helper.js","webpack:///./server/applogic/modules schema\\.js$","webpack:///./server/applogic/modules/devices/schema.js","webpack:///./server/applogic/modules/posts/schema.js","webpack:///./server/routes/errors.js","webpack:///./server/core/agenda.js","webpack:///external \"agenda\"","webpack:///./server/libs/gracefulExit.js","webpack:///./server/libs/sysinfo.js","webpack:///external \"os\"","webpack:///external \"clui\"","webpack:///external \"pretty-bytes\""],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","id","loaded","call","m","c","p","global","WEBPACK_BUNDLE","config","logger","moment","chalk","info","bold","format","db","app","listen","port","title","version","underline","process","env","NODE_ENV","ip","uri","_","isDevMode","isProductionMode","isTestMode","console","log","defaultsDeep","require","pkg","name","test","MONGO_URI","dbName","options","user","pass","SERVER_IP","__dirname","path","secrets","rootPath","normalize","join","bundleFullPath","argv","dirname","description","keywords","url","PORT","contactEmail","dataFolder","uploadLimit","sessions","cookie","maxAge","httpOnly","secure","collection","mailer","from","transport","smtp","host","auth","server","socketOptions","keepAlive","logging","graylog","enabled","servers","papertrail","level","program","logentries","token","loggly","subdomain","logsene","logzio","disableSignUp","verificationRequired","agendaTimer","fs","secretUtils","fName","existsSync","json","hashSecret","url64","sessionSecret","writeFileSync","JSON","stringify","warn","green","parse","readFileSync","winston","logDir","mkdir","err","transports","Console","colorize","prettyPrint","handleExceptions","push","Logentries","Papertrail","ptTransport","filename","timestamp","File","humanReadableUnhandledException","Logger","exitOnError","add","Loggly","inputToken","tags","type","facility","mongoose","autoIncrement","Promise","connection","readyState","connect","error","set","on","initialize","once","yellow","dropDatabase","isProduction","tokgen","User","find","exec","docs","length","admin","fullName","email","username","password","provider","roles","verified","save","apiKey","TokenGenerator","BASE62","generate","C","crypto","bcrypt","Schema","hashids","schemaOptions","timestamps","toObject","virtuals","toJSON","validateLocalStrategyProperty","property","this","updated","validateLocalStrategyPassword","UserSchema","String","trim","default","validate","unique","index","lowercase","match","required","passwordLess","Boolean","passwordLessToken","profile","socialLinks","facebook","sparse","twitter","google","github","enum","ROLE_ADMIN","ROLE_USER","ROLE_GUEST","resetPasswordToken","resetPasswordExpires","Date","verifyToken","lastLogin","metadata","virtual","get","encodeID","plugin","model","startAt","pre","next","isModified","genSalt","salt","hash","methods","comparePassword","cb","compare","isMatch","md5","createHash","update","digest","encodeHex","_id","decodeID","code","decodeHex","pick","props","Hashids","fakerator","Device","Post","times","device","address","internet","random","arrayElement","populate","lorem","sentence","status","lastCommunication","now","lean","select","users","fakePost","entity","post","content","author","DeviceSchema","Number","PostSchema","ref","views","upVoters","downVoters","votes","initLocalVariables","locals","use","req","res","protocol","headers","year","initMiddleware","compress","filter","getHeader","bodyParser","urlencoded","extended","limit","contentMaxLength","validator","methodOverride","netjet","cache","max","express","serverFolder","favicon","cookieParser","flash","stream","lmStream","Stream","writable","write","data","debug","morgan","initI18N","conf","fallbackLng","whitelist","ns","defaultNS","load","saveMissing","saveMissingTo","backend","loadPath","addPath","jsonIndent","i18next","i18nextFs","i18nextExpress","LanguageDetector","init","t","lng","msg","handle","getResourcesHandler","missingKeyHandler","initViewEngine","helmet","noCache","pretty","initSession","session","saveUninitialized","resave","secret","store","MongoStore","mongooseConnection","autoReconnect","initHelmetHeaders","xssFilter","noSniff","ieNoOpen","crossdomain","hidePoweredBy","initAuth","initWebpack","webpack","wpConfig","compiler","devMiddleware","noInfo","publicPath","output","Access-Control-Allow-Origin","stats","colors","hotMiddleware","_app","passport","requireAll","r","keys","map","basename","strategy","serializeUser","done","deserializeUser","findOne","webpackContext","webpackContextResolve","Error","./apikey.js","./facebook.js","./github.js","./google.js","./local.js","./twitter.js","Object","resolve","LocalAPIKeyStrategy","Strategy","passReqToCallback","message","helper","FacebookStrategy","apiKeys","clientID","clientSecret","callbackURL","profileFields","accessToken","refreshToken","linkToSocialAccount","_json","userData","givenName","familyName","gender","picture","location","_typeof","Symbol","iterator","obj","constructor","isAuthenticated","sendStatus","isAuthenticatedOrApiKey","apikey","query","body","authenticate","login","send","hasRole","roleRequired","indexOf","hasAdminRole","opts","search","existingUser","findById","existingEmailUser","_ret","v","GoogleStrategy","displayName","avatar_url","OAuth2Strategy","emails","value","image","LocalStrategy","usernameField","passwordField","$or","consumerKey","consumerSecret","profile_image_url_https","precss","autoprefixer","devtool","entry","frontend","chunkFilename","loaders","loader","exclude","presets","extensions","alias","images","plugins","HotModuleReplacementPlugin","NoErrorsPlugin","postcss","browsers","vue","render","checkAvailableSocialAuth","social","async","response","redirect","socialAuth","logout","assert","notEmpty","isEmail","sanitize","normalizeEmail","remove_dots","toBoolean","passwordless","len","errors","validationErrors","waterfall","randomBytes","buf","toString","field","split","substring","lastIndexOf","subject","html","validateLink","params","undefined","resetLink","where","gt","equals","SERVER_ERROR","NOT_FOUND","UNAUTHORIZED","BAD_REQUEST","REQUEST_FAILED","FORBIDDEN","TOO_MANY_REQUEST","NOT_IMPLEMENTED","errMessage","nodemailer","htmlToText","recipients","mailOptions","to","transporter","createTransport","mg","api_key","mailgun","domain","sgTransport","sendgrid","sendMail","accepts","Response","successData","authRouter","Router","loginLink","scope","failureRedirect","relative","router","./counter/routes.js","./devices/routes.js","./posts/routes.js","./session/routes.js","counter","io","namespace","route","items","item","namespaces","emit","param","deviceID","schema","doc","all","put","remove","http","socketio","socketHandlers","self","onlineUsers","createServer","mongoStore","IO","initNameSpace","socket","request","handlers","forEach","Handler","of","role","isFunction","sessionId","signedCookies","addOnlineUser","removeOnlineUser","nsEmit","command","u","./counter/socket.js","./devices/socket.js","./posts/socket.js","broadcast","moduleConfig","findByIdAndUpdate","$pull","$inc","new","$addToSet","then","viewMode","sort","createdAt","postID","ApolloServer","apolloServer","graphqlTools","Resolvers","resolvers","makeExecutableSchema","typeDefs","graphiql","printErrors","context","mergeModuleResolvers","baseResolvers","moduleResolvers","merge","moduleQueries","moduleTypeDefinitions","moduleMutations","schemas","concat","moduleSchema","typeDefinitions","mutation","Timestamp","__parseValue","__serialize","getTime","__parseLiteral","ast","./user.schema.js","Query","root","args","applyLimitOffsetSort","posts","Mutation","offset","skip","./devices/schema.js","./posts/schema.js","devices","$in","voters","upVote","reject","nsemit","downVote","stack","originalUrl","Agenda","agenda","processEvery","job","define","$lte","subtract","toDate","count","red","every","start","gracefulExit","exit","close","stop","duration","uptime","humanize","os","clui","Gauge","total","totalmem","free","freemem","used","human","arch","cpus","platform"],"mappings":"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","file":"bundle.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tglobal.WEBPACK_BUNDLE = false;\n\t\n\tvar config = __webpack_require__(1);\n\tvar logger = __webpack_require__(12);\n\tvar moment = __webpack_require__(21);\n\tvar chalk = __webpack_require__(9);\n\t\n\tlogger.info();\n\tlogger.info(chalk.bold(\"---------------------[ Server starting at %s ]---------------------------\"), moment().format(\"YYYY-MM-DD HH:mm:ss.SSS\"));\n\t\n\tvar init = __webpack_require__(22);\n\tvar db = __webpack_require__(23)();\n\tvar app = __webpack_require__(39)(db);\n\tvar agenda = __webpack_require__(119);\n\t\n\t__webpack_require__(121);\n\t\n\tapp.listen(config.port, function () {\n\t\n\t\tlogger.info(\"\");\n\t\tlogger.info(config.app.title + \" v\" + config.app.version + \" application started!\");\n\t\tlogger.info(\"----------------------------------------------\");\n\t\tlogger.info(\"Environment:\\t\" + chalk.underline.bold(process.env.NODE_ENV));\n\t\tlogger.info(\"IP:\\t\\t\" + config.ip);\n\t\tlogger.info(\"Port:\\t\\t\" + config.port);\n\t\tlogger.info(\"Database:\\t\\t\" + config.db.uri);\n\t\tlogger.info(\"\");\n\t\n\t\t__webpack_require__(122)();\n\t\n\t\tlogger.info(\"----------------------------------------------\");\n\t});\n\t\n\texports = module.exports = app;\n\n/***/ },\n/* 1 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar _ = __webpack_require__(2);\n\t\n\tmodule.exports = {\n\t\tisDevMode: function isDevMode() {\n\t\t\treturn !process.env.NODE_ENV || process.env.NODE_ENV === \"development\";\n\t\t},\n\t\tisProductionMode: function isProductionMode() {\n\t\t\treturn process.env.NODE_ENV === \"production\";\n\t\t},\n\t\tisTestMode: function isTestMode() {\n\t\t\treturn process.env.NODE_ENV === \"test\";\n\t\t}\n\t};\n\t\n\tvar config = {};\n\tif (module.exports.isTestMode()) {\n\t\tconsole.log(\"Load test config...\");\n\t\tconfig = __webpack_require__(3);\n\t} else if (module.exports.isProductionMode()) {\n\t\tconsole.log(\"Load production config...\");\n\t\tconfig = __webpack_require__(5);\n\t}\n\t\n\tmodule.exports = _.defaultsDeep(module.exports, config, __webpack_require__(6));\n\n/***/ },\n/* 2 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"lodash\");\n\n/***/ },\n/* 3 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar pkg = __webpack_require__(4);\n\t\n\tmodule.exports = {\n\t\tapp: {\n\t\t\ttitle: pkg.name + \" [Test mode]\"\n\t\t},\n\t\n\t\ttest: true,\n\t\n\t\tdb: {\n\t\t\turi: process.env.MONGO_URI || \"mongodb://localhost/\" + pkg.config.dbName + \"-test\",\n\t\t\toptions: {\n\t\t\t\tuser: \"\",\n\t\t\t\tpass: \"\"\n\t\t\t}\n\t\t}\n\t};\n\n/***/ },\n/* 4 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"../package.json\");\n\n/***/ },\n/* 5 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar pkg = __webpack_require__(4);\n\t\n\tmodule.exports = {\n\t\tapp: {},\n\t\n\t\tip: process.env.SERVER_IP || \"127.0.0.1\",\n\t\n\t\tdb: {\n\t\t\turi: process.env.MONGO_URI || \"mongodb://localhost/\" + pkg.config.dbName,\n\t\t\toptions: {\n\t\t\t\tuser: \"\",\n\t\t\t\tpass: \"\"\n\t\t\t}\n\t\t}\n\t\n\t};\n\n/***/ },\n/* 6 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t/* WEBPACK VAR INJECTION */(function(__dirname) {\"use strict\";\n\t\n\tvar path = __webpack_require__(7);\n\tvar pkg = __webpack_require__(4);\n\tvar secrets = __webpack_require__(8);\n\t\n\tvar rootPath = path.normalize(path.join(__dirname, \"..\", \"..\"));\n\t\n\tif (true) {\n\t\tvar bundleFullPath = process.argv[1];\n\t\trootPath = path.normalize(path.join(path.dirname(bundleFullPath), \"..\"));\n\t}\n\t\n\tmodule.exports = {\n\t\tapp: {\n\t\t\ttitle: pkg.title,\n\t\t\tversion: pkg.version,\n\t\t\tdescription: pkg.description,\n\t\t\tkeywords: pkg.keywords.join(\",\"),\n\t\t\turl: \"http://localhost:\" + (process.env.PORT || 3000) + \"/\",\n\t\n\t\t\tcontactEmail: \"hello@boilerplate-app.com\"\n\t\t},\n\t\n\t\tip: \"0.0.0.0\",\n\t\tport: process.env.PORT || 3000,\n\t\trootPath: rootPath,\n\t\tdataFolder: path.join(rootPath, \"data\"),\n\t\tuploadLimit: 2 * 1024 * 1024,\n\t\n\t\tsessions: {\n\t\t\tcookie: {\n\t\t\t\tmaxAge: 7 * 24 * (60 * 60 * 1000),\n\t\n\t\t\t\thttpOnly: true,\n\t\n\t\t\t\tsecure: false\n\t\t\t},\n\t\n\t\t\tname: \"sessionId\",\n\t\n\t\t\tcollection: \"sessions\"\n\t\t},\n\t\n\t\ttest: false,\n\t\n\t\tmailer: {\n\t\t\tfrom: \"noreply@bolierplate-app.com\",\n\t\n\t\t\ttransport: \"smtp\",\n\t\t\tsmtp: {\n\t\t\t\thost: \"mailtrap.io\",\n\t\t\t\tport: 2525,\n\t\t\t\tauth: {\n\t\t\t\t\tuser: \"367335eaa82697636\",\n\t\t\t\t\tpass: \"e5a76af9b056d0\"\n\t\t\t\t}\n\t\t\t}\n\t\n\t\t},\n\t\n\t\tdb: {\n\t\t\turi: process.env.MONGO_URI || \"mongodb://localhost/\" + pkg.config.dbName + \"-dev\",\n\t\t\toptions: {\n\t\t\t\tuser: \"\",\n\t\t\t\tpass: \"\",\n\t\t\t\tserver: {\n\t\t\t\t\tsocketOptions: {\n\t\t\t\t\t\tkeepAlive: 1\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\n\t\t},\n\t\n\t\tlogging: {\n\t\n\t\t\tgraylog: {\n\t\t\t\tenabled: true,\n\t\t\t\tservers: [{ host: \"192.168.0.174\", port: 12201 }]\n\t\t\t},\n\t\n\t\t\tpapertrail: {\n\t\t\t\tenabled: secrets.papertrail != null,\n\t\t\t\thost: secrets.papertrail != null ? secrets.papertrail.host : null,\n\t\t\t\tport: secrets.papertrail != null ? secrets.papertrail.port : null,\n\t\t\t\tlevel: 'debug',\n\t\t\t\tprogram: 'vem'\n\t\t\t},\n\t\n\t\t\tlogentries: {\n\t\t\t\tenabled: secrets.logentries != null,\n\t\t\t\ttoken: secrets.logentries != null ? secrets.logentries.token : null\n\t\t\t},\n\t\n\t\t\tloggly: {\n\t\t\t\tenabled: secrets.loggly != null,\n\t\t\t\ttoken: secrets.loggly != null ? secrets.loggly.token : null,\n\t\t\t\tsubdomain: secrets.loggly != null ? secrets.loggly.subdomain : null\n\t\t\t},\n\t\n\t\t\tlogsene: {\n\t\t\t\tenabled: secrets.logsene != null,\n\t\t\t\ttoken: secrets.logsene != null ? secrets.logsene.token : null\n\t\t\t},\n\t\n\t\t\tlogzio: {\n\t\t\t\tenabled: secrets.logzio != null,\n\t\t\t\ttoken: secrets.logzio != null ? secrets.logzio.token : null\n\t\t\t}\n\t\n\t\t},\n\t\n\t\tdisableSignUp: false,\n\t\tverificationRequired: true,\n\t\n\t\tagendaTimer: \"one minute\"\n\t};\n\t/* WEBPACK VAR INJECTION */}.call(exports, \"server\\\\config\"))\n\n/***/ },\n/* 7 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"path\");\n\n/***/ },\n/* 8 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t/* WEBPACK VAR INJECTION */(function(__dirname) {\"use strict\";\n\t\n\tvar chalk = __webpack_require__(9);\n\tvar fs = __webpack_require__(10);\n\tvar path = __webpack_require__(7);\n\tvar secretUtils = __webpack_require__(11);\n\t\n\tvar fName = path.join(__dirname, \"..\", \"..\", \"secrets.json\");\n\tif (!fs.existsSync(fName)) {\n\t\n\t\tvar json = {\n\t\t\thashSecret: secretUtils.url64(32),\n\t\t\tsessionSecret: secretUtils.url64(32)\n\t\t};\n\t\tfs.writeFileSync(fName, JSON.stringify(json, null, 2));\n\t\n\t\tconsole.warn(chalk.green.bold(\"Secret file created!\"));\n\t}\n\t\n\tmodule.exports = JSON.parse(fs.readFileSync(fName));\n\t/* WEBPACK VAR INJECTION */}.call(exports, \"server\\\\core\"))\n\n/***/ },\n/* 9 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"chalk\");\n\n/***/ },\n/* 10 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"fs\");\n\n/***/ },\n/* 11 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"secret-utils\");\n\n/***/ },\n/* 12 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar winston = __webpack_require__(13);\n\tvar path = __webpack_require__(7);\n\tvar fs = __webpack_require__(10);\n\t\n\tvar config = __webpack_require__(1);\n\tvar secrets = __webpack_require__(8);\n\t\n\tvar logDir = path.join(config.rootPath, \"logs\");\n\tif (!fs.existsSync(logDir)) {\n\t\tfs.mkdir(logDir, function (err) {\n\t\t\tif (err) throw err;\n\t\t});\n\t}\n\t\n\tvar transports = [new winston.transports.Console({\n\t\tlevel: \"debug\",\n\t\tcolorize: true,\n\t\tprettyPrint: true,\n\t\thandleExceptions: process.env.NODE_ENV === \"production\"\n\t})];\n\t\n\tif (config.logging.logentries.enabled && config.logging.logentries.token) {\n\t\tconsole.log(\"Logentries log transport enabled!\");\n\t\tvar Logentries = __webpack_require__(14);\n\t\ttransports.push(new winston.transports.Logentries({\n\t\t\tlevel: \"debug\",\n\t\t\ttoken: config.logging.logentries.token\n\t\t}));\n\t}\n\t\n\tif (config.logging.papertrail.enabled) {\n\t\tconsole.log(\"Papertrail log transport enabled!\");\n\t\t__webpack_require__(15).Papertrail;\n\t\n\t\tvar ptTransport = new winston.transports.Papertrail(config.logging.papertrail);\n\t\n\t\ttransports.push(ptTransport);\n\t}\n\t\n\tif (process.env.NODE_ENV === \"production\") {\n\t\ttransports.push(new (__webpack_require__(16))({\n\t\t\tfilename: path.join(logDir, \"server.log\"),\n\t\t\tlevel: \"info\",\n\t\t\ttimestamp: true,\n\t\t\tjson: true,\n\t\t\thandleExceptions: true\n\t\t}), new winston.transports.File({\n\t\t\tfilename: path.join(logDir, \"exceptions.log\"),\n\t\t\tlevel: \"error\",\n\t\t\ttimestamp: true,\n\t\t\tjson: false,\n\t\t\tprettyPrint: true,\n\t\t\thandleExceptions: true,\n\t\t\thumanReadableUnhandledException: true\n\t\t}));\n\t}\n\t\n\tvar logger = new winston.Logger({\n\t\tlevel: \"debug\",\n\t\ttransports: transports,\n\t\texitOnError: false\n\t});\n\t\n\tif (config.logging.loggly.enabled && config.logging.loggly.token) {\n\t\tconsole.log(\"Loggly log transport enabled!\");\n\t\tvar loggly = __webpack_require__(17);\n\t\tlogger.add(winston.transports.Loggly, {\n\t\t\tinputToken: config.logging.loggly.token,\n\t\t\tsubdomain: config.logging.loggly.subdomain,\n\t\t\ttags: [\"vem-server\"],\n\t\t\tjson: true\n\t\t});\n\t}\n\t\n\tif (config.logging.logsene.enabled && config.logging.logsene.token) {\n\t\tconsole.log(\"Logsene log transport enabled!\");\n\t\tvar logsene = __webpack_require__(18);\n\t\tlogger.add(logsene, {\n\t\t\ttype: \"vem-server\",\n\t\t\ttoken: config.logging.logsene.token\n\t\t});\n\t}\n\t\n\tif (config.logging.logzio.enabled && config.logging.logzio.token) {\n\t\tconsole.log(\"Logz.io log transport enabled!\");\n\t\tvar logzio = __webpack_require__(19);\n\t\tlogger.add(logzio, {\n\t\t\ttoken: config.logging.logzio.token\n\t\t});\n\t}\n\t\n\tif (config.logging.graylog.enabled) {\n\t\tconsole.log(\"Graylog log transport enabled! Servers: \" + JSON.stringify(config.logging.graylog.servers));\n\t\tvar graylog = __webpack_require__(20);\n\t\tlogger.add(graylog, {\n\t\t\tname: \"Graylog\",\n\t\t\tlevel: 'debug',\n\t\t\tgraylog: {\n\t\t\t\tservers: config.logging.graylog.servers,\n\t\t\t\tfacility: \"vem\"\n\t\t\t}\n\t\t});\n\t}\n\t\n\tmodule.exports = logger;\n\n/***/ },\n/* 13 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"winston\");\n\n/***/ },\n/* 14 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"le_node\");\n\n/***/ },\n/* 15 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"winston-papertrail\");\n\n/***/ },\n/* 16 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"winston-daily-rotate-file\");\n\n/***/ },\n/* 17 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"winston-loggly-bulk\");\n\n/***/ },\n/* 18 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"winston-logsene\");\n\n/***/ },\n/* 19 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"winston-logzio\");\n\n/***/ },\n/* 20 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"winston-graylog2\");\n\n/***/ },\n/* 21 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"moment\");\n\n/***/ },\n/* 22 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar logger = __webpack_require__(12);\n\tvar config = __webpack_require__(1);\n\tvar fs = __webpack_require__(10);\n\t\n\tif (!fs.existsSync(config.dataFolder)) {\n\t\tfs.mkdir(config.dataFolder, function (err) {\n\t\t\tif (err) throw err;\n\t\t});\n\t}\n\t\n\tif (config.isDevMode()) {\n\t\tlogger.info(\"Loaded configuration:\");\n\t\tlogger.info(config);\n\t\tlogger.info();\n\t}\n\n/***/ },\n/* 23 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar logger = __webpack_require__(12);\n\tvar config = __webpack_require__(1);\n\t\n\tvar chalk = __webpack_require__(9);\n\tvar mongoose = __webpack_require__(24);\n\tvar autoIncrement = __webpack_require__(25);\n\t\n\tmodule.exports = function () {\n\t\tvar db = void 0;\n\t\n\t\tlogger.info();\n\t\n\t\tmongoose.Promise = global.Promise;\n\t\n\t\tif (mongoose.connection.readyState !== 1) {\n\t\t\tlogger.info(\"Connecting to Mongo \" + config.db.uri + \"...\");\n\t\t\tdb = mongoose.connect(config.db.uri, config.db.options, function mongoAfterConnect(err) {\n\t\t\t\tif (err) {\n\t\t\t\t\tlogger.error(\"Could not connect to MongoDB!\");\n\t\t\t\t\treturn logger.error(err);\n\t\t\t\t}\n\t\n\t\t\t\tmongoose.set(\"debug\", config.isDevMode());\n\t\t\t});\n\t\n\t\t\tmongoose.connection.on(\"error\", function mongoConnectionError(err) {\n\t\t\t\tlogger.error(\"Could not connect to MongoDB!\");\n\t\t\t\treturn logger.error(err);\n\t\t\t});\n\t\n\t\t\tautoIncrement.initialize(db);\n\t\n\t\t\tmongoose.connection.once(\"open\", function mongoAfterOpen() {\n\t\t\t\tlogger.info(chalk.yellow.bold(\"Mongo DB connected.\"));\n\t\t\t\tlogger.info();\n\t\n\t\t\t\tif (config.isTestMode()) {\n\t\t\t\t\tlogger.warn(\"Drop test database...\");\n\t\t\t\t\tmongoose.connection.db.dropDatabase();\n\t\t\t\t}\n\t\n\t\t\t\tif (!config.isProduction) {\n\t\t\t\t\t__webpack_require__(26)();\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tlogger.info(\"Mongo already connected.\");\n\t\t\tdb = mongoose;\n\t\t}\n\t\n\t\treturn db;\n\t};\n\n/***/ },\n/* 24 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"mongoose\");\n\n/***/ },\n/* 25 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"mongoose-auto-increment\");\n\n/***/ },\n/* 26 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar logger = __webpack_require__(12);\n\tvar config = __webpack_require__(1);\n\t\n\tvar _ = __webpack_require__(2);\n\tvar tokgen = __webpack_require__(27);\n\tvar fakerator = __webpack_require__(29)();\n\t\n\tvar User = __webpack_require__(30);\n\t\n\tmodule.exports = function () {\n\t\tUser.find({}).exec(function (err, docs) {\n\t\t\tvar admin = void 0,\n\t\t\t    test = void 0;\n\t\t\tif (docs.length === 0) {\n\t\t\t\tlogger.warn(\"Load default Users to DB...\");\n\t\n\t\t\t\tvar _admin = new User({\n\t\t\t\t\tfullName: \"Administrator\",\n\t\t\t\t\temail: \"admin@boilerplate-app.com\",\n\t\t\t\t\tusername: \"admin\",\n\t\t\t\t\tpassword: \"admin1234\",\n\t\t\t\t\tprovider: \"local\",\n\t\t\t\t\troles: [\"admin\", \"user\"],\n\t\t\t\t\tverified: true\n\t\t\t\t});\n\t\n\t\t\t\t_admin.save(function (err) {\n\t\t\t\t\tif (err) return logger.warn(\"Unable to create default admin user!\");\n\t\n\t\t\t\t\tvar test = new User({\n\t\t\t\t\t\tfullName: \"Test User\",\n\t\t\t\t\t\temail: \"test@boilerplate-app.com\",\n\t\t\t\t\t\tusername: \"test\",\n\t\t\t\t\t\tpassword: \"test1234\",\n\t\t\t\t\t\tprovider: \"local\",\n\t\t\t\t\t\troles: [\"user\"],\n\t\t\t\t\t\tverified: true,\n\t\t\t\t\t\tapiKey: tokgen()\n\t\t\t\t\t});\n\t\n\t\t\t\t\ttest.save(function () {\n\t\t\t\t\t\tif (err) return logger.warn(\"Unable to create default admin user!\");\n\t\n\t\t\t\t\t\tlogger.info(\"Default users created!\");\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\n\t\t__webpack_require__(36)();\n\t};\n\n/***/ },\n/* 27 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar TokenGenerator = __webpack_require__(28);\n\tvar tokgen = new TokenGenerator(256, TokenGenerator.BASE62);\n\t\n\tmodule.exports = function () {\n\t\treturn tokgen.generate();\n\t};\n\n/***/ },\n/* 28 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"uuid-token-generator\");\n\n/***/ },\n/* 29 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"fakerator\");\n\n/***/ },\n/* 30 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar config = __webpack_require__(1);\n\tvar logger = __webpack_require__(12);\n\tvar C = __webpack_require__(31);\n\tvar fs = __webpack_require__(10);\n\tvar path = __webpack_require__(7);\n\t\n\tvar _ = __webpack_require__(2);\n\tvar crypto = __webpack_require__(32);\n\tvar bcrypt = __webpack_require__(33);\n\t\n\tvar db = __webpack_require__(23);\n\tvar mongoose = __webpack_require__(24);\n\tvar Schema = mongoose.Schema;\n\tvar hashids = __webpack_require__(34)(\"users\");\n\tvar autoIncrement = __webpack_require__(25);\n\t\n\tvar schemaOptions = {\n\t\ttimestamps: true,\n\t\ttoObject: {\n\t\t\tvirtuals: true\n\t\t},\n\t\ttoJSON: {\n\t\t\tvirtuals: true\n\t\t}\n\t};\n\t\n\tvar validateLocalStrategyProperty = function validateLocalStrategyProperty(property) {\n\t\treturn this.provider !== \"local\" && !this.updated || property.length;\n\t};\n\t\n\tvar validateLocalStrategyPassword = function validateLocalStrategyPassword(password) {\n\t\treturn this.provider !== \"local\" || password && password.length >= 6;\n\t};\n\t\n\tvar UserSchema = new Schema({\n\t\tfullName: {\n\t\t\ttype: String,\n\t\t\ttrim: true,\n\t\t\t\"default\": \"\",\n\t\t\tvalidate: [validateLocalStrategyProperty, \"Please fill in your full name\"]\n\t\t},\n\t\temail: {\n\t\t\ttype: String,\n\t\t\ttrim: true,\n\t\t\tunique: true,\n\t\t\tindex: true,\n\t\t\tlowercase: true,\n\t\t\t\"default\": \"\",\n\t\t\tvalidate: [validateLocalStrategyProperty, \"Please fill in your email\"],\n\t\t\tmatch: [/.+\\@.+\\..+/, \"Please fill a valid email address\"]\n\t\t},\n\t\tusername: {\n\t\t\ttype: String,\n\t\t\tunique: true,\n\t\t\tindex: true,\n\t\t\trequired: \"Please fill in a username\",\n\t\t\ttrim: true\n\t\t},\n\t\tpassword: {\n\t\t\ttype: String,\n\t\t\t\"default\": \"\",\n\t\t\tvalidate: [validateLocalStrategyPassword, \"Password should be longer\"]\n\t\t},\n\t\tpasswordLess: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false\n\t\t},\n\t\tpasswordLessToken: {\n\t\t\ttype: String\n\t\t},\n\t\tprovider: {\n\t\t\ttype: String,\n\t\t\t\"default\": \"local\"\n\t\t},\n\t\tprofile: {},\n\t\tsocialLinks: {\n\t\t\tfacebook: { type: String, unique: true, sparse: true },\n\t\t\ttwitter: { type: String, unique: true, sparse: true },\n\t\t\tgoogle: { type: String, unique: true, sparse: true },\n\t\t\tgithub: { type: String, unique: true, sparse: true }\n\t\t},\n\t\troles: {\n\t\t\ttype: [{\n\t\t\t\ttype: String,\n\t\t\t\t\"enum\": [C.ROLE_ADMIN, C.ROLE_USER, C.ROLE_GUEST]\n\t\t\t}],\n\t\t\t\"default\": [C.ROLE_USER]\n\t\t},\n\t\tresetPasswordToken: String,\n\t\tresetPasswordExpires: Date,\n\t\n\t\tverified: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false\n\t\t},\n\t\n\t\tverifyToken: {\n\t\t\ttype: String\n\t\t},\n\t\n\t\tapiKey: {\n\t\t\ttype: String,\n\t\t\tunique: true,\n\t\t\tindex: true,\n\t\t\tsparse: true\n\t\t},\n\t\n\t\tlastLogin: {\n\t\t\ttype: Date\n\t\t},\n\t\n\t\tmetadata: {}\n\t\n\t}, schemaOptions);\n\t\n\tUserSchema.virtual(\"code\").get(function () {\n\t\treturn this.encodeID();\n\t});\n\t\n\tUserSchema.plugin(autoIncrement.plugin, {\n\t\tmodel: \"User\",\n\t\tstartAt: 1\n\t});\n\t\n\tUserSchema.pre(\"save\", function (next) {\n\t\tvar user = this;\n\t\tif (!user.isModified(\"password\")) return next();\n\t\n\t\tbcrypt.genSalt(10, function (err, salt) {\n\t\t\tbcrypt.hash(user.password, salt, null, function (err, hash) {\n\t\t\t\tuser.password = hash;\n\t\t\t\tnext();\n\t\t\t});\n\t\t});\n\t});\n\t\n\tUserSchema.methods.comparePassword = function (password, cb) {\n\t\tbcrypt.compare(password, this.password, function (err, isMatch) {\n\t\t\tcb(err, isMatch);\n\t\t});\n\t};\n\t\n\tUserSchema.virtual(\"gravatar\").get(function () {\n\t\tif (!this.email) {\n\t\t\treturn \"https://gravatar.com/avatar/?s=64&d=wavatar\";\n\t\t}\n\t\tvar md5 = crypto.createHash(\"md5\").update(this.email).digest(\"hex\");\n\t\treturn \"https://gravatar.com/avatar/\" + md5 + \"?s=64&d=wavatar\";\n\t});\n\t\n\tUserSchema.methods.encodeID = function () {\n\t\treturn hashids.encodeHex(this._id);\n\t};\n\t\n\tUserSchema.methods.decodeID = function (code) {\n\t\treturn hashids.decodeHex(code);\n\t};\n\t\n\tUserSchema.methods.pick = function (props, model) {\n\t\treturn _.pick(model || this.toJSON(), props || [\"code\", \"fullName\", \"email\", \"username\", \"roles\", \"lastLogin\", \"gravatar\"]);\n\t};\n\t\n\tvar User = mongoose.model(\"User\", UserSchema);\n\t\n\tmodule.exports = User;\n\n/***/ },\n/* 31 */\n/***/ function(module, exports) {\n\n\t\"use strict\";\n\t\n\tmodule.exports = {\n\t\tROLE_ADMIN: \"admin\",\n\t\tROLE_USER: \"user\",\n\t\tROLE_GUEST: \"guest\"\n\t\n\t};\n\n/***/ },\n/* 32 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"crypto\");\n\n/***/ },\n/* 33 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"bcrypt-nodejs\");\n\n/***/ },\n/* 34 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar Hashids = __webpack_require__(35);\n\tvar secrets = __webpack_require__(8);\n\t\n\tmodule.exports = function (module, length) {\n\t\treturn new Hashids(module + secrets.hashSecret, length || 10);\n\t};\n\n/***/ },\n/* 35 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"hashids\");\n\n/***/ },\n/* 36 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar logger = __webpack_require__(12);\n\tvar config = __webpack_require__(1);\n\t\n\tvar _ = __webpack_require__(2);\n\tvar tokgen = __webpack_require__(27);\n\tvar fakerator = __webpack_require__(29)();\n\t\n\tvar User = __webpack_require__(30);\n\tvar Device = __webpack_require__(37);\n\tvar Post = __webpack_require__(38);\n\t\n\tmodule.exports = function () {\n\t\tDevice.find({}).exec(function (err, docs) {\n\t\t\tif (docs.length === 0) {\n\t\t\t\tlogger.warn(\"Load default Devices to DB...\");\n\t\n\t\t\t\t_.times(5, function () {\n\t\n\t\t\t\t\tvar device = new Device({\n\t\t\t\t\t\taddress: fakerator.internet.ip(),\n\t\t\t\t\t\ttype: fakerator.random.arrayElement([\"rasperry\", \"odroid\", \"nanopi\", \"pc\"]),\n\t\t\t\t\t\tname: fakerator.populate(\"#{names.firstName}'s device\"),\n\t\t\t\t\t\tdescription: fakerator.lorem.sentence(),\n\t\t\t\t\t\tstatus: fakerator.random.boolean(\"80\") ? 1 : 0,\n\t\t\t\t\t\tlastCommunication: Date.now()\n\t\t\t\t\t});\n\t\n\t\t\t\t\tdevice.save(function (err) {\n\t\t\t\t\t\tif (err) return logger.warn(\"Unable to create default devices!\", err);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\n\t\tPost.find({}).exec(function (err, docs) {\n\t\t\tif (docs.length === 0) {\n\t\t\t\tlogger.warn(\"Load default Posts to DB...\");\n\t\n\t\t\t\tUser.find({}).lean().select(\"_id\").exec(function (err, users) {\n\t\n\t\t\t\t\t_.times(10, function () {\n\t\n\t\t\t\t\t\tvar fakePost = fakerator.entity.post();\n\t\n\t\t\t\t\t\tvar post = new Post({\n\t\t\t\t\t\t\ttitle: fakePost.title,\n\t\t\t\t\t\t\tcontent: fakePost.content,\n\t\t\t\t\t\t\tauthor: fakerator.random.arrayElement(users)._id\n\t\t\t\t\t\t});\n\t\n\t\t\t\t\t\tpost.save(function (err) {\n\t\t\t\t\t\t\tif (err) return logger.warn(\"Unable to create default posts!\", err);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t};\n\n/***/ },\n/* 37 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar config = __webpack_require__(1);\n\tvar logger = __webpack_require__(12);\n\t\n\tvar db = __webpack_require__(23);\n\tvar mongoose = __webpack_require__(24);\n\tvar Schema = mongoose.Schema;\n\tvar hashids = __webpack_require__(34)(\"devices\");\n\tvar autoIncrement = __webpack_require__(25);\n\t\n\tvar schemaOptions = {\n\t\ttimestamps: true,\n\t\ttoObject: {\n\t\t\tvirtuals: true\n\t\t},\n\t\ttoJSON: {\n\t\t\tvirtuals: true\n\t\t}\n\t};\n\t\n\tvar DeviceSchema = new Schema({\n\t\taddress: {\n\t\t\ttype: String,\n\t\t\ttrim: true\n\t\t},\n\t\ttype: {\n\t\t\ttype: String,\n\t\t\ttrim: true\n\t\t},\n\t\tname: {\n\t\t\ttype: String,\n\t\t\ttrim: true\n\t\t},\n\t\tdescription: {\n\t\t\ttype: String,\n\t\t\ttrim: true,\n\t\t\t\"default\": \"\"\n\t\t},\n\t\tstatus: {\n\t\t\ttype: Number,\n\t\t\t\"default\": 1\n\t\t},\n\t\tlastCommunication: {\n\t\t\ttype: Date,\n\t\t\t\"default\": Date.now\n\t\t},\n\t\tmetadata: {}\n\t\n\t}, schemaOptions);\n\t\n\tDeviceSchema.virtual(\"code\").get(function () {\n\t\treturn this.encodeID();\n\t});\n\t\n\tDeviceSchema.plugin(autoIncrement.plugin, {\n\t\tmodel: \"Device\",\n\t\tstartAt: 1\n\t});\n\t\n\tDeviceSchema.methods.encodeID = function () {\n\t\treturn hashids.encodeHex(this._id);\n\t};\n\t\n\tDeviceSchema.methods.decodeID = function (code) {\n\t\treturn hashids.decodeHex(code);\n\t};\n\t\n\tvar Device = mongoose.model(\"Device\", DeviceSchema);\n\t\n\tmodule.exports = Device;\n\n/***/ },\n/* 38 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar config = __webpack_require__(1);\n\tvar logger = __webpack_require__(12);\n\t\n\tvar db = __webpack_require__(23);\n\tvar mongoose = __webpack_require__(24);\n\tvar Schema = mongoose.Schema;\n\tvar hashids = __webpack_require__(34)(\"posts\");\n\tvar autoIncrement = __webpack_require__(25);\n\t\n\tvar schemaOptions = {\n\t\ttimestamps: true,\n\t\ttoObject: {\n\t\t\tvirtuals: true\n\t\t},\n\t\ttoJSON: {\n\t\t\tvirtuals: true\n\t\t}\n\t};\n\t\n\tvar PostSchema = new Schema({\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\ttrim: true\n\t\t},\n\t\tcontent: {\n\t\t\ttype: String,\n\t\t\ttrim: true\n\t\t},\n\t\tauthor: {\n\t\t\ttype: Number,\n\t\t\trequired: \"Please fill in an author ID\",\n\t\t\tref: \"User\"\n\t\t},\n\t\tviews: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0\n\t\t},\n\t\tupVoters: {\n\t\t\ttype: [Number]\n\t\t},\n\t\tdownVoters: {\n\t\t\ttype: [Number]\n\t\t},\n\t\tvotes: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0\n\t\t},\n\t\tmetadata: {}\n\t\n\t}, schemaOptions);\n\t\n\tPostSchema.virtual(\"code\").get(function () {\n\t\treturn this.encodeID();\n\t});\n\t\n\tPostSchema.plugin(autoIncrement.plugin, {\n\t\tmodel: \"Post\",\n\t\tstartAt: 1\n\t});\n\t\n\tPostSchema.methods.encodeID = function () {\n\t\treturn hashids.encodeHex(this._id);\n\t};\n\t\n\tPostSchema.methods.decodeID = function (code) {\n\t\treturn hashids.decodeHex(code);\n\t};\n\t\n\tvar Post = mongoose.model(\"Post\", PostSchema);\n\t\n\tmodule.exports = Post;\n\n/***/ },\n/* 39 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar logger = __webpack_require__(12);\n\tvar config = __webpack_require__(1);\n\tvar secrets = __webpack_require__(8);\n\t\n\tvar express = __webpack_require__(40);\n\tvar http = __webpack_require__(41);\n\tvar path = __webpack_require__(7);\n\t\n\tvar moment = __webpack_require__(21);\n\tvar flash = __webpack_require__(42);\n\tvar favicon = __webpack_require__(43);\n\tvar morgan = __webpack_require__(44);\n\tvar bodyParser = __webpack_require__(45);\n\tvar cookieParser = __webpack_require__(46);\n\tvar validator = __webpack_require__(47);\n\tvar csrf = __webpack_require__(48);\n\tvar netjet = __webpack_require__(49);\n\t\n\tvar session = __webpack_require__(50);\n\tvar compress = __webpack_require__(51);\n\tvar methodOverride = __webpack_require__(52);\n\tvar helmet = __webpack_require__(53);\n\tvar crossdomain = __webpack_require__(54);\n\tvar mongoose = __webpack_require__(24);\n\tvar MongoStore = __webpack_require__(55)(session);\n\t\n\tvar i18next = __webpack_require__(56);\n\tvar i18nextExpress = __webpack_require__(57);\n\tvar i18nextFs = __webpack_require__(58);\n\t\n\tvar serverFolder = path.normalize(path.join(config.rootPath, \"server\"));\n\t\n\tfunction initLocalVariables(app) {\n\t\tapp.locals.app = config.app;\n\t\n\t\tapp.use(function (req, res, next) {\n\t\t\tres.locals.url = req.protocol + \"://\" + req.headers.host + req.url;\n\t\t\treturn next();\n\t\t});\n\t\n\t\tapp.locals.year = moment().format(\"YYYY\");\n\t\tapp.locals.disableSignUp = config.disableSignUp || false;\n\t}\n\t\n\tfunction initMiddleware(app) {\n\t\tapp.use(compress({\n\t\t\tfilter: function filter(req, res) {\n\t\t\t\treturn (/json|text|javascript|css/.test(res.getHeader(\"Content-Type\"))\n\t\t\t\t);\n\t\t\t},\n\t\t\tlevel: 3\n\t\t}));\n\t\n\t\tapp.set(\"port\", config.port);\n\t\n\t\tapp.use(bodyParser.urlencoded({\n\t\t\textended: true,\n\t\t\tlimit: config.contentMaxLength * 2\n\t\t}));\n\t\tapp.use(validator());\n\t\tapp.use(bodyParser.json());\n\t\tapp.use(methodOverride());\n\t\n\t\tif (config.isProductionMode()) {\n\t\t\tapp.use(netjet({\n\t\t\t\tcache: {\n\t\t\t\t\tmax: 100\n\t\t\t\t}\n\t\t\t}));\n\t\n\t\t\tapp.use(express[\"static\"](path.join(serverFolder, \"public\")));\n\t\t}\n\t\n\t\tapp.use(favicon(path.join(serverFolder, \"public\", \"favicon.ico\")));\n\t\n\t\tapp.use(cookieParser());\n\t\n\t\tapp.set(\"etag\", true);\n\t\n\t\tapp.use(flash());\n\t\n\t\tif (config.isDevMode()) {\n\t\t\tvar stream = __webpack_require__(59);\n\t\t\tvar lmStream = new stream.Stream();\n\t\n\t\t\tlmStream.writable = true;\n\t\t\tlmStream.write = function (data) {\n\t\t\t\treturn logger.debug(data);\n\t\t\t};\n\t\n\t\t\tapp.use(morgan(\"dev\", {\n\t\t\t\tstream: lmStream\n\t\t\t}));\n\t\t}\n\t}\n\t\n\tfunction initI18N(app) {\n\t\n\t\tvar conf = {\n\t\t\tfallbackLng: \"en\",\n\t\t\twhitelist: [\"en\", \"hu\"],\n\t\t\tns: [\"app\", \"frontend\"],\n\t\t\tdefaultNS: \"frontend\",\n\t\t\tload: \"all\",\n\t\t\tsaveMissing: true,\n\t\t\tsaveMissingTo: \"all\",\n\t\n\t\t\tbackend: {\n\t\t\t\tloadPath: path.join(serverFolder, \"locales\", \"{{lng}}\", \"{{ns}}.json\"),\n\t\n\t\t\t\taddPath: path.join(serverFolder, \"locales\", \"{{lng}}\", \"{{ns}}.missing.json\"),\n\t\n\t\t\t\tjsonIndent: 4\n\t\t\t}\n\t\t};\n\t\n\t\tif (config.isTestMode()) {\n\t\t\tconf.whitelist = [\"en\"];\n\t\t}\n\t\n\t\ti18next.use(i18nextFs).use(i18nextExpress.LanguageDetector).init(conf, function (err, t) {\n\t\t\tif (err) logger.warn(err);\n\t\t});\n\t\n\t\ti18next.on(\"failedLoading\", function (lng, ns, msg) {\n\t\t\tconsole.log(\"failedLoading\", lng, ns, msg);\n\t\t});\n\t\n\t\tapp.use(i18nextExpress.handle(i18next));\n\t\n\t\tapp.get(\"/locales/resources.json\", i18nextExpress.getResourcesHandler(i18next));\n\t\n\t\tapp.post(\"/locales/add/:lng/:ns\", i18nextExpress.missingKeyHandler(i18next));\n\t}\n\t\n\tfunction initViewEngine(app) {\n\t\tapp.set(\"views\", path.join(serverFolder, \"views\"));\n\t\tapp.set(\"view engine\", \"jade\");\n\t\n\t\tif (config.isDevMode()) {\n\t\t\tapp.set(\"showStackError\", true);\n\t\n\t\t\tapp.set(\"view cache\", false);\n\t\t\tapp.use(helmet.noCache());\n\t\n\t\t\tapp.locals.pretty = true;\n\t\t} else {\n\t\t\tapp.locals.cache = \"memory\";\n\t\t\tapp.set(\"view cache\", true);\n\t\t}\n\t}\n\t\n\tfunction initSession(app, db) {\n\t\tapp.use(session({\n\t\t\tsaveUninitialized: true,\n\t\t\tresave: true,\n\t\t\tsecret: secrets.sessionSecret,\n\t\t\tstore: new MongoStore({\n\t\t\t\tmongooseConnection: db.connection,\n\t\t\t\tcollection: config.sessions.collection,\n\t\t\t\tautoReconnect: true\n\t\t\t}),\n\t\t\tcookie: config.sessions.cookie,\n\t\t\tname: config.sessions.name\n\t\t}));\n\t}\n\t\n\tfunction initHelmetHeaders(app) {\n\t\tapp.use(helmet.xssFilter());\n\t\tapp.use(helmet.noSniff());\n\t\tapp.use(helmet.ieNoOpen());\n\t\tapp.use(crossdomain());\n\t\tapp.use(helmet.hidePoweredBy());\n\t}\n\t\n\tfunction initAuth(app) {\n\t\t__webpack_require__(60)(app);\n\t\n\t\tif (!config.isTestMode()) {}\n\t}\n\t\n\tfunction initWebpack(app) {\n\t\tif (!config.isProductionMode()) {\n\t\t\tvar webpack = __webpack_require__(76);\n\t\t\tvar wpConfig = __webpack_require__(77);\n\t\n\t\t\tvar compiler = webpack(wpConfig);\n\t\t\tvar devMiddleware = __webpack_require__(81);\n\t\t\tapp.use(devMiddleware(compiler, {\n\t\t\t\tnoInfo: true,\n\t\t\t\tpublicPath: wpConfig.output.publicPath,\n\t\t\t\theaders: { \"Access-Control-Allow-Origin\": \"*\" },\n\t\n\t\t\t\tstats: { colors: true }\n\t\t\t}));\n\t\n\t\t\tvar hotMiddleware = __webpack_require__(82);\n\t\t\tapp.use(hotMiddleware(compiler, {\n\t\t\t\tlog: logger.info\n\t\t\t}));\n\t\t}\n\t}\n\t\n\tmodule.exports = function (db) {\n\t\tvar app = express();\n\t\n\t\tinitLocalVariables(app);\n\t\n\t\tinitMiddleware(app);\n\t\n\t\tinitViewEngine(app);\n\t\n\t\tinitHelmetHeaders(app);\n\t\n\t\tinitI18N(app);\n\t\n\t\tinitSession(app, db);\n\t\n\t\tinitAuth(app);\n\t\n\t\tinitWebpack(app);\n\t\n\t\t__webpack_require__(83)(app, db);\n\t\n\t\tvar server = __webpack_require__(98).init(app, db);\n\t\tserver._app = app;\n\t\n\t\treturn server;\n\t};\n\n/***/ },\n/* 40 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"express\");\n\n/***/ },\n/* 41 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"http\");\n\n/***/ },\n/* 42 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"express-flash\");\n\n/***/ },\n/* 43 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"serve-favicon\");\n\n/***/ },\n/* 44 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"morgan\");\n\n/***/ },\n/* 45 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"body-parser\");\n\n/***/ },\n/* 46 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"cookie-parser\");\n\n/***/ },\n/* 47 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"express-validator\");\n\n/***/ },\n/* 48 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"csurf\");\n\n/***/ },\n/* 49 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"netjet\");\n\n/***/ },\n/* 50 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"express-session\");\n\n/***/ },\n/* 51 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"compression\");\n\n/***/ },\n/* 52 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"method-override\");\n\n/***/ },\n/* 53 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"helmet\");\n\n/***/ },\n/* 54 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"helmet-crossdomain\");\n\n/***/ },\n/* 55 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"connect-mongo\");\n\n/***/ },\n/* 56 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"i18next\");\n\n/***/ },\n/* 57 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"i18next-express-middleware\");\n\n/***/ },\n/* 58 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"i18next-node-fs-backend\");\n\n/***/ },\n/* 59 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"stream\");\n\n/***/ },\n/* 60 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar logger = __webpack_require__(12);\n\tvar config = __webpack_require__(1);\n\t\n\tvar passport = __webpack_require__(61);\n\tvar path = __webpack_require__(7);\n\tvar chalk = __webpack_require__(9);\n\t\n\tif (false) require('require-webpack-compat')(module, require);\n\t\n\tvar User = __webpack_require__(30);\n\t\n\tmodule.exports = function (app) {\n\t\tapp.use(passport.initialize());\n\t\tapp.use(passport.session());\n\t\n\t\tpassport.serializeUser(function (user, done) {\n\t\t\treturn done(null, user.id);\n\t\t});\n\t\n\t\tpassport.deserializeUser(function (id, done) {\n\t\t\tUser.findOne({\n\t\t\t\t_id: id\n\t\t\t}, \"-password\", function (err, user) {\n\t\t\t\treturn done(err, user);\n\t\t\t});\n\t\t});\n\t\n\t\tlogger.info(\"\");\n\t\tlogger.info(chalk.bold(\"Search passport strategies...\"));\n\t\n\t\tfunction requireAll(r) {\n\t\t\treturn r.keys().map(function (module) {\n\t\t\t\tlogger.info(\"  Loading passport strategy file \" + path.basename(module) + \"...\");\n\t\t\t\tvar strategy = r(module);\n\t\t\t\tstrategy();\n\t\n\t\t\t\treturn strategy;\n\t\t\t});\n\t\t}\n\t\tvar modules = requireAll(__webpack_require__(62));\n\t};\n\n/***/ },\n/* 61 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"passport\");\n\n/***/ },\n/* 62 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar map = {\n\t\t\"./apikey.js\": 63,\n\t\t\"./facebook.js\": 65,\n\t\t\"./github.js\": 68,\n\t\t\"./google.js\": 70,\n\t\t\"./local.js\": 72,\n\t\t\"./twitter.js\": 74\n\t};\n\tfunction webpackContext(req) {\n\t\treturn __webpack_require__(webpackContextResolve(req));\n\t};\n\tfunction webpackContextResolve(req) {\n\t\treturn map[req] || (function() { throw new Error(\"Cannot find module '\" + req + \"'.\") }());\n\t};\n\twebpackContext.keys = function webpackContextKeys() {\n\t\treturn Object.keys(map);\n\t};\n\twebpackContext.resolve = webpackContextResolve;\n\tmodule.exports = webpackContext;\n\twebpackContext.id = 62;\n\n\n/***/ },\n/* 63 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar passport = __webpack_require__(61);\n\tvar LocalAPIKeyStrategy = __webpack_require__(64).Strategy;\n\tvar User = __webpack_require__(30);\n\t\n\tmodule.exports = function () {\n\t\tpassport.use(new LocalAPIKeyStrategy({\n\t\t\tpassReqToCallback: true\n\t\t}, function (req, apiKey, done) {\n\t\t\treturn User.findOne({\n\t\t\t\t\"apiKey\": apiKey\n\t\t\t}, function (err, user) {\n\t\t\t\tif (err) return done(err);\n\t\n\t\t\t\tif (!user) return done(null, false, {\n\t\t\t\t\tmessage: req.t(\"UnknowAPIKey\")\n\t\t\t\t});\n\t\n\t\t\t\tif (!user.verified) return done(null, false, {\n\t\t\t\t\tmessage: req.t(\"PleaseActivateAccount\")\n\t\t\t\t});\n\t\n\t\t\t\treturn done(null, user);\n\t\t\t});\n\t\t}));\n\t};\n\n/***/ },\n/* 64 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"passport-localapikey-update\");\n\n/***/ },\n/* 65 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar logger = __webpack_require__(12);\n\tvar config = __webpack_require__(1);\n\tvar secrets = __webpack_require__(8);\n\tvar helper = __webpack_require__(66);\n\t\n\tvar passport = __webpack_require__(61);\n\tvar FacebookStrategy = __webpack_require__(67).Strategy;\n\tvar User = __webpack_require__(30);\n\t\n\tmodule.exports = function () {\n\t\tif (secrets.apiKeys && secrets.apiKeys.facebook && secrets.apiKeys.facebook.clientID) {\n\t\n\t\t\tpassport.use(\"facebook\", new FacebookStrategy({\n\t\t\t\tclientID: secrets.apiKeys.facebook.clientID,\n\t\t\t\tclientSecret: secrets.apiKeys.facebook.clientSecret,\n\t\t\t\tcallbackURL: \"/auth/facebook/callback\",\n\t\t\t\tprofileFields: [\"name\", \"email\", \"link\", \"locale\", \"timezone\"],\n\t\t\t\tpassReqToCallback: true\n\t\t\t}, function (req, accessToken, refreshToken, profile, done) {\n\t\n\t\t\t\thelper.linkToSocialAccount({\n\t\t\t\t\treq: req,\n\t\t\t\t\taccessToken: accessToken,\n\t\t\t\t\trefreshToken: refreshToken,\n\t\t\t\t\tprofile: profile,\n\t\t\t\t\tdone: done,\n\t\n\t\t\t\t\tprovider: \"facebook\",\n\t\t\t\t\temail: profile._json.email,\n\t\t\t\t\tuserData: {\n\t\t\t\t\t\tname: profile.name.givenName + \" \" + profile.name.familyName,\n\t\t\t\t\t\tgender: profile._json.gender,\n\t\t\t\t\t\tpicture: \"https://graph.facebook.com/\" + profile.id + \"/picture?type=large\",\n\t\t\t\t\t\tlocation: profile._json.location ? profile._json.location.name : null\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}));\n\t\t}\n\t};\n\n/***/ },\n/* 66 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol ? \"symbol\" : typeof obj; };\n\t\n\tvar logger = __webpack_require__(12);\n\tvar config = __webpack_require__(1);\n\tvar passport = __webpack_require__(61);\n\t\n\tvar User = __webpack_require__(30);\n\t\n\tmodule.exports.isAuthenticated = function isAuthenticated(req, res, next) {\n\t\tif (req.isAuthenticated()) return next();else {\n\t\t\treturn res.sendStatus(401);\n\t\t}\n\t};\n\t\n\tmodule.exports.isAuthenticatedOrApiKey = function isAuthenticated(req, res, next) {\n\t\tif (req.isAuthenticated()) return next();else {\n\t\t\tif (req.headers.apikey || req.query.apikey || req.body.apikey) {\n\t\t\t\tpassport.authenticate(\"localapikey\", function (err, user, info) {\n\t\t\t\t\tif (err) return res.sendStatus(500);\n\t\n\t\t\t\t\tif (!user) return res.status(401).send(info.message || \"\");\n\t\n\t\t\t\t\treq.login(user, function (err) {\n\t\t\t\t\t\tif (err) return res.sendStatus(500);\n\t\n\t\t\t\t\t\treturn next();\n\t\t\t\t\t});\n\t\t\t\t})(req, res, next);\n\t\t\t} else return res.sendStatus(401);\n\t\t}\n\t};\n\t\n\tmodule.exports.hasRole = function hasRole(roleRequired) {\n\t\tif (!roleRequired) throw new Error(\"Required role needs to be set\");\n\t\n\t\treturn function (req, res, next) {\n\t\t\treturn module.exports.isAuthenticated(req, res, function () {\n\t\t\t\tif (req.user && req.user.roles && req.user.roles.indexOf(roleRequired) !== -1) next();else res.sendStatus(403);\n\t\t\t});\n\t\t};\n\t};\n\t\n\tmodule.exports.hasAdminRole = function hasAdminRole() {\n\t\treturn module.exports.hasRole(\"admin\");\n\t};\n\t\n\tmodule.exports.linkToSocialAccount = function linkToSocialAccount(opts) {\n\t\n\t\tvar req = opts.req;\n\t\tvar accessToken = opts.accessToken;\n\t\tvar refreshToken = opts.refreshToken;\n\t\tvar profile = opts.profile;\n\t\tvar done = opts.done;\n\t\tvar provider = opts.provider;\n\t\tvar email = opts.email;\n\t\tvar userData = opts.userData;\n\t\n\t\tif (req.user) {\n\t\t\tvar search = {};\n\t\t\tsearch[\"socialLinks.\" + provider] = profile.id;\n\t\t\tUser.findOne(search, function (err, existingUser) {\n\t\t\t\tif (existingUser) {\n\t\t\t\t\tif (existingUser._id != req.user._id) {\n\t\t\t\t\t\treq.flash(\"error\", { msg: req.t(\"SocialIDLinkedToOtherAccount\") });\n\t\t\t\t\t\treturn done(err);\n\t\t\t\t\t} else return done(err, existingUser);\n\t\t\t\t} else {\n\t\t\t\t\tUser.findById(req.user.id, function (err, user) {\n\t\t\t\t\t\tuser.socialLinks = user.socialLinks || {};\n\t\t\t\t\t\tuser.socialLinks[provider] = profile.id;\n\t\n\t\t\t\t\t\tuser.profile = user.profile || {};\n\t\t\t\t\t\tuser.profile.name = user.profile.name || userData.name;\n\t\t\t\t\t\tuser.profile.gender = user.profile.gender || userData.gender;\n\t\t\t\t\t\tuser.profile.picture = user.profile.picture || userData.picture;\n\t\t\t\t\t\tuser.profile.location = user.profile.location || userData.location;\n\t\n\t\t\t\t\t\tuser.save(function (err) {\n\t\t\t\t\t\t\treq.flash(\"info\", { msg: req.t(\"AccountHasBeenLinked\") });\n\t\t\t\t\t\t\tdone(err, user);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tvar _search = {};\n\t\t\t_search[\"socialLinks.\" + provider] = profile.id;\n\t\t\tUser.findOne(_search, function (err, existingUser) {\n\t\n\t\t\t\tif (existingUser) {\n\t\t\t\t\treturn done(err, existingUser);\n\t\t\t\t}\n\t\n\t\t\t\tif (!email) {\n\t\t\t\t\treq.flash(\"error\", { msg: req.t(\"SocialMissingEmailAddress\") });\n\t\t\t\t\treturn done();\n\t\t\t\t}\n\t\n\t\t\t\tUser.findOne({ email: email }, function (err, existingEmailUser) {\n\t\t\t\t\tif (existingEmailUser) {\n\t\t\t\t\t\tvar _ret = function () {\n\t\t\t\t\t\t\tvar user = existingEmailUser;\n\t\t\t\t\t\t\tuser.socialLinks = user.socialLinks || {};\n\t\t\t\t\t\t\tuser.socialLinks[provider] = profile.id;\n\t\n\t\t\t\t\t\t\tuser.profile = user.profile || {};\n\t\t\t\t\t\t\tuser.profile.name = user.profile.name || userData.name;\n\t\t\t\t\t\t\tuser.profile.gender = user.profile.gender || userData.gender;\n\t\t\t\t\t\t\tuser.profile.picture = user.profile.picture || userData.picture;\n\t\t\t\t\t\t\tuser.profile.location = user.profile.location || userData.location;\n\t\n\t\t\t\t\t\t\tuser.save(function (err) {\n\t\t\t\t\t\t\t\treq.flash(\"info\", { msg: req.t(\"AccountHasBeenLinked\") });\n\t\t\t\t\t\t\t\tdone(err, user);\n\t\t\t\t\t\t\t});\n\t\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tv: void 0\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}();\n\t\n\t\t\t\t\t\tif ((typeof _ret === \"undefined\" ? \"undefined\" : _typeof(_ret)) === \"object\") return _ret.v;\n\t\t\t\t\t}\n\t\n\t\t\t\t\tif (config.disableSignUp === true) {\n\t\t\t\t\t\treq.flash(\"error\", { msg: req.t(\"SignUpDisabledPleaseLogin\") });\n\t\t\t\t\t\treturn done();\n\t\t\t\t\t}\n\t\n\t\t\t\t\tvar user = new User();\n\t\t\t\t\tuser.fullName = userData.name;\n\t\t\t\t\tuser.email = email;\n\t\t\t\t\tuser.username = email;\n\t\t\t\t\tuser.provider = provider;\n\t\t\t\t\tuser.verified = true;\n\t\t\t\t\tuser.passwordLess = true;\n\t\n\t\t\t\t\tuser.socialLinks = {};\n\t\t\t\t\tuser.socialLinks[provider] = profile.id;\n\t\n\t\t\t\t\tuser.profile = userData;\n\t\n\t\t\t\t\tuser.save(function (err) {\n\t\t\t\t\t\tdone(err, user);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t};\n\n/***/ },\n/* 67 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"passport-facebook\");\n\n/***/ },\n/* 68 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar logger = __webpack_require__(12);\n\tvar config = __webpack_require__(1);\n\tvar secrets = __webpack_require__(8);\n\tvar helper = __webpack_require__(66);\n\t\n\tvar passport = __webpack_require__(61);\n\tvar GoogleStrategy = __webpack_require__(69).Strategy;\n\tvar User = __webpack_require__(30);\n\t\n\tmodule.exports = function () {\n\t\tif (secrets.apiKeys && secrets.apiKeys.github && secrets.apiKeys.github.clientID) {\n\t\n\t\t\tpassport.use(\"github\", new GoogleStrategy({\n\t\t\t\tclientID: secrets.apiKeys.github.clientID,\n\t\t\t\tclientSecret: secrets.apiKeys.github.clientSecret,\n\t\t\t\tcallbackURL: \"/auth/github/callback\",\n\t\t\t\tpassReqToCallback: true\n\t\t\t}, function (req, accessToken, refreshToken, profile, done) {\n\t\n\t\t\t\thelper.linkToSocialAccount({\n\t\t\t\t\treq: req,\n\t\t\t\t\taccessToken: accessToken,\n\t\t\t\t\trefreshToken: refreshToken,\n\t\t\t\t\tprofile: profile,\n\t\t\t\t\tdone: done,\n\t\n\t\t\t\t\tprovider: \"github\",\n\t\t\t\t\temail: profile._json.email,\n\t\t\t\t\tuserData: {\n\t\t\t\t\t\tname: profile.displayName,\n\t\t\t\t\t\tgender: null,\n\t\t\t\t\t\tpicture: profile._json.avatar_url,\n\t\t\t\t\t\tlocation: profile._json.location\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}));\n\t\t}\n\t};\n\n/***/ },\n/* 69 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"passport-github\");\n\n/***/ },\n/* 70 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar logger = __webpack_require__(12);\n\tvar config = __webpack_require__(1);\n\tvar secrets = __webpack_require__(8);\n\tvar helper = __webpack_require__(66);\n\t\n\tvar passport = __webpack_require__(61);\n\tvar GoogleStrategy = __webpack_require__(71).OAuth2Strategy;\n\tvar User = __webpack_require__(30);\n\t\n\tmodule.exports = function () {\n\t\tif (secrets.apiKeys && secrets.apiKeys.google && secrets.apiKeys.google.clientID) {\n\t\n\t\t\tpassport.use(\"google\", new GoogleStrategy({\n\t\t\t\tclientID: secrets.apiKeys.google.clientID,\n\t\t\t\tclientSecret: secrets.apiKeys.google.clientSecret,\n\t\t\t\tcallbackURL: \"/auth/google/callback\",\n\t\t\t\tpassReqToCallback: true\n\t\t\t}, function (req, accessToken, refreshToken, profile, done) {\n\t\n\t\t\t\thelper.linkToSocialAccount({\n\t\t\t\t\treq: req,\n\t\t\t\t\taccessToken: accessToken,\n\t\t\t\t\trefreshToken: refreshToken,\n\t\t\t\t\tprofile: profile,\n\t\t\t\t\tdone: done,\n\t\n\t\t\t\t\tprovider: \"google\",\n\t\t\t\t\temail: profile.emails[0].value,\n\t\t\t\t\tuserData: {\n\t\t\t\t\t\tname: profile.displayName,\n\t\t\t\t\t\tgender: profile._json.gender,\n\t\t\t\t\t\tpicture: profile._json.image.url,\n\t\t\t\t\t\tlocation: null\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}));\n\t\t}\n\t};\n\n/***/ },\n/* 71 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"passport-google-oauth\");\n\n/***/ },\n/* 72 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar passport = __webpack_require__(61);\n\tvar LocalStrategy = __webpack_require__(73).Strategy;\n\tvar User = __webpack_require__(30);\n\t\n\tmodule.exports = function () {\n\t\tpassport.use(new LocalStrategy({\n\t\t\tusernameField: \"username\",\n\t\t\tpasswordField: \"password\",\n\t\t\tpassReqToCallback: true\n\t\t}, function (req, username, password, done) {\n\t\t\treturn User.findOne({\n\t\t\t\t$or: [{ \"username\": username }, { \"email\": username }]\n\t\t\t}, function (err, user) {\n\t\t\t\tif (err) return done(err);\n\t\n\t\t\t\tif (!user) return done(null, false, {\n\t\t\t\t\tmessage: req.t(\"UnknowUsernameOrEmail\")\n\t\t\t\t});\n\t\n\t\t\t\tif (!user.verified) return done(null, false, {\n\t\t\t\t\tmessage: req.t(\"PleaseActivateAccount\")\n\t\t\t\t});\n\t\n\t\t\t\tif (user.passwordLess) return done(null, false, {\n\t\t\t\t\tmessage: req.t(\"PasswordlessAccountLeaveEmpty\")\n\t\t\t\t});\n\t\n\t\t\t\tuser.comparePassword(password, function (err, isMatch) {\n\t\t\t\t\tif (err) return done(err);\n\t\n\t\t\t\t\tif (isMatch !== true) return done(null, false, {\n\t\t\t\t\t\tmessage: req.t(\"InvalidPassword\")\n\t\t\t\t\t});else return done(null, user);\n\t\t\t\t});\n\t\t\t});\n\t\t}));\n\t};\n\n/***/ },\n/* 73 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"passport-local\");\n\n/***/ },\n/* 74 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar logger = __webpack_require__(12);\n\tvar config = __webpack_require__(1);\n\tvar secrets = __webpack_require__(8);\n\tvar helper = __webpack_require__(66);\n\t\n\tvar passport = __webpack_require__(61);\n\tvar GoogleStrategy = __webpack_require__(75).Strategy;\n\tvar User = __webpack_require__(30);\n\t\n\tmodule.exports = function () {\n\t\tif (secrets.apiKeys && secrets.apiKeys.twitter && secrets.apiKeys.twitter.clientID) {\n\t\n\t\t\tpassport.use(\"twitter\", new GoogleStrategy({\n\t\t\t\tconsumerKey: secrets.apiKeys.twitter.clientID,\n\t\t\t\tconsumerSecret: secrets.apiKeys.twitter.clientSecret,\n\t\t\t\tcallbackURL: \"/auth/twitter/callback\",\n\t\t\t\tpassReqToCallback: true\n\t\t\t}, function (req, accessToken, refreshToken, profile, done) {\n\t\n\t\t\t\thelper.linkToSocialAccount({\n\t\t\t\t\treq: req,\n\t\t\t\t\taccessToken: accessToken,\n\t\t\t\t\trefreshToken: refreshToken,\n\t\t\t\t\tprofile: profile,\n\t\t\t\t\tdone: done,\n\t\n\t\t\t\t\tprovider: \"twitter\",\n\t\t\t\t\temail: profile.username + \"@twitter.com\",\n\t\t\t\t\tuserData: {\n\t\t\t\t\t\tname: profile.displayName,\n\t\t\t\t\t\tgender: null,\n\t\t\t\t\t\tpicture: profile._json.profile_image_url_https,\n\t\t\t\t\t\tlocation: profile._json.location\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}));\n\t\t}\n\t};\n\n/***/ },\n/* 75 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"passport-twitter\");\n\n/***/ },\n/* 76 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"webpack\");\n\n/***/ },\n/* 77 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t/* WEBPACK VAR INJECTION */(function(__dirname) {\"use strict\";\n\t\n\tvar path = __webpack_require__(7);\n\tvar glob = __webpack_require__(78);\n\tvar webpack = __webpack_require__(76);\n\t\n\tvar precss = __webpack_require__(79);\n\tvar autoprefixer = __webpack_require__(80);\n\t\n\tmodule.exports = {\n\t\tdevtool: 'eval-source-map',\n\t\tentry: {\n\t\t\tapp: ['webpack-hot-middleware/client', \"./client/app/main.js\"],\n\t\t\tfrontend: ['webpack-hot-middleware/client', \"./client/frontend/main.js\"]\n\t\t},\n\t\toutput: {\n\t\t\tpath: path.resolve(__dirname, \"server\", \"public\", \"app\"),\n\t\t\tpublicPath: \"/app/\",\n\t\t\tfilename: \"[name].js\",\n\t\t\tchunkFilename: \"[chunkhash].js\"\n\t\t},\n\t\tmodule: {\n\t\t\tloaders: [{ test: /\\.css$/, loader: \"style!css\" }, { test: /\\.scss$/, loaders: [\"style\", \"css\", \"postcss\", \"sass\"] }, { test: /\\.json$/, loader: \"json-loader\" }, { test: /\\.js$/, loader: 'babel', exclude: [/node_modules/, /vendor/], query: {\n\t\t\t\t\tpresets: ['es2015', 'stage-0']\n\t\t\t\t}\n\t\t\t}, { test: /\\.vue$/, loader: \"vue\" }, { test: /\\.gif$/, loader: \"url-loader?name=images/[name]-[hash:6].[ext]&limit=100000\" }, { test: /\\.png$/, loader: \"url-loader?name=images/[name]-[hash:6].[ext]&limit=100000\" }, { test: /\\.jpg$/, loader: \"file-loader?name=images/[name]-[hash:6].[ext]\" }, { test: /\\.woff$/, loader: \"url-loader?prefix=font/&limit=5000&mimetype=application/font-woff\" }, { test: /\\.ttf$/, loader: \"file-loader?prefix=font/\" }, { test: /\\.eot$/, loader: \"file-loader?prefix=font/\" }, { test: /\\.svg$/, loader: \"file-loader?prefix=font/\" }]\n\t\t},\n\t\tresolve: {\n\t\t\textensions: ['', '.vue', '.js', '.json'],\n\t\t\talias: {\n\t\t\t\t'images': path.resolve(__dirname, 'client', 'images')\n\t\t\t}\n\t\t},\n\t\tplugins: [new webpack.HotModuleReplacementPlugin(), new webpack.NoErrorsPlugin()],\n\t\n\t\tpostcss: function postcss() {\n\t\t\treturn [autoprefixer({ browsers: ['last 2 versions'] }), precss];\n\t\t},\n\t\n\t\tvue: {\n\t\t\tautoprefixer: {\n\t\t\t\tbrowsers: ['last 2 versions']\n\t\t\t}\n\t\t}\n\t};\n\t/* WEBPACK VAR INJECTION */}.call(exports, \"\"))\n\n/***/ },\n/* 78 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"glob\");\n\n/***/ },\n/* 79 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"precss\");\n\n/***/ },\n/* 80 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"autoprefixer\");\n\n/***/ },\n/* 81 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"webpack-dev-middleware\");\n\n/***/ },\n/* 82 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"webpack-hot-middleware\");\n\n/***/ },\n/* 83 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar config = __webpack_require__(1);\n\tvar logger = __webpack_require__(12);\n\tvar path = __webpack_require__(7);\n\t\n\tmodule.exports = function (app, db) {\n\t\tapp.get(\"/\", function (req, res) {\n\t\t\tif (req.user != null) res.render(\"main\", {\n\t\t\t\tuser: req.user\n\t\t\t});else res.render(\"index\");\n\t\t});\n\t\n\t\t__webpack_require__(84)(app, db);\n\t\n\t\t__webpack_require__(92)(app, db);\n\t\n\t\t__webpack_require__(93)(app, db);\n\t\n\t\t__webpack_require__(108)(app, db);\n\t\n\t\t__webpack_require__(118)(app, db);\n\t};\n\n/***/ },\n/* 84 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar config = __webpack_require__(1);\n\tvar logger = __webpack_require__(12);\n\t\n\tvar secrets = __webpack_require__(8);\n\tvar tokgen = __webpack_require__(27);\n\t\n\tvar crypto = __webpack_require__(32);\n\tvar async = __webpack_require__(85);\n\tvar passport = __webpack_require__(61);\n\tvar express = __webpack_require__(40);\n\t\n\tvar response = __webpack_require__(86);\n\tvar mailer = __webpack_require__(87);\n\t\n\tvar User = __webpack_require__(30);\n\t\n\tfunction checkAvailableSocialAuth() {\n\t\tvar social = {};\n\t\n\t\tif (secrets.apiKeys) {\n\t\t\tif (secrets.apiKeys.google && secrets.apiKeys.google.clientID) social.google = true;\n\t\n\t\t\tif (secrets.apiKeys.facebook && secrets.apiKeys.facebook.clientID) social.facebook = true;\n\t\n\t\t\tif (secrets.apiKeys.github && secrets.apiKeys.github.clientID) social.github = true;\n\t\n\t\t\tif (secrets.apiKeys.twitter && secrets.apiKeys.twitter.clientID) social.twitter = true;\n\t\t}\n\t\n\t\tif (Object.keys(social).length > 0) return social;\n\t\n\t\treturn null;\n\t}\n\t\n\tmodule.exports = function (app, db) {\n\t\tapp.get(\"/login\", function (req, res) {\n\t\t\tif (req.user != null) {\n\t\t\t\treturn res.redirect(\"/\");\n\t\t\t}\n\t\n\t\t\tres.render(\"account/login\", {\n\t\t\t\tsocialAuth: checkAvailableSocialAuth()\n\t\t\t});\n\t\t});\n\t\n\t\tapp.get(\"/logout\", function (req, res) {\n\t\t\treq.logout();\n\t\t\tres.redirect(\"/\");\n\t\t});\n\t\n\t\tapp.get(\"/signup\", function (req, res) {\n\t\t\tif (config.disableSignUp === true) return res.redirect(\"/login\");\n\t\n\t\t\tres.render(\"account/signup\", {\n\t\t\t\tsocialAuth: checkAvailableSocialAuth()\n\t\t\t});\n\t\t});\n\t\n\t\tapp.post(\"/signup\", function (req, res) {\n\t\t\tif (config.disableSignUp === true) return res.redirect(\"/\");\n\t\n\t\t\treq.assert(\"name\", req.t(\"NameCannotBeEmpty\")).notEmpty();\n\t\t\treq.assert(\"email\", req.t(\"EmailCannotBeEmpty\")).notEmpty();\n\t\t\treq.assert(\"email\", req.t(\"EmailIsNotValid\")).isEmail();\n\t\t\treq.sanitize(\"email\").normalizeEmail({ remove_dots: false });\n\t\n\t\t\tif (!req.body.username) req.body.username = req.body.email;\n\t\n\t\t\treq.sanitize(\"passwordless\").toBoolean();\n\t\t\tvar passwordless = req.body.passwordless === true;\n\t\t\tif (!passwordless) {\n\t\t\t\treq.assert(\"password\", req.t(\"PasswordCannotBeEmpty\")).notEmpty();\n\t\t\t\treq.assert(\"password\", req.t(\"PasswordTooShort\")).len(6);\n\t\t\t}\n\t\n\t\t\tvar errors = req.validationErrors();\n\t\n\t\t\tif (errors) {\n\t\t\t\treq.flash(\"error\", errors);\n\t\t\t\treturn res.redirect(\"/signup\");\n\t\t\t}\n\t\n\t\t\tasync.waterfall([function generateVerificationToken(done) {\n\t\t\t\tif (config.verificationRequired) {\n\t\t\t\t\tcrypto.randomBytes(25, function (err, buf) {\n\t\t\t\t\t\tdone(err, err ? null : buf.toString(\"hex\"));\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tdone(null, null);\n\t\t\t\t}\n\t\t\t}, function passwordless(token, done) {\n\t\t\t\tif (passwordless) {\n\t\t\t\t\tcrypto.randomBytes(25, function (err, buf) {\n\t\t\t\t\t\tdone(err, token, err ? null : buf.toString(\"hex\"));\n\t\t\t\t\t});\n\t\t\t\t} else done(null, token, req.body.password);\n\t\t\t}, function createUser(token, password, done) {\n\t\n\t\t\t\tvar user = new User({\n\t\t\t\t\tfullName: req.body.name,\n\t\t\t\t\temail: req.body.email,\n\t\t\t\t\tusername: req.body.username,\n\t\t\t\t\tpassword: password,\n\t\t\t\t\troles: [\"user\"],\n\t\t\t\t\tprovider: \"local\"\n\t\t\t\t});\n\t\n\t\t\t\tif (token) {\n\t\t\t\t\tuser.verified = false;\n\t\t\t\t\tuser.verifyToken = token;\n\t\t\t\t} else {\n\t\t\t\t\tuser.verified = true;\n\t\t\t\t}\n\t\n\t\t\t\tuser.save(function (err, user) {\n\t\t\t\t\tif (err && err.code === 11000) {\n\t\t\t\t\t\tvar field = err.message.split(\".$\")[1];\n\t\t\t\t\t\tfield = field.split(\" dup key\")[0];\n\t\t\t\t\t\tfield = field.substring(0, field.lastIndexOf(\"_\"));\n\t\t\t\t\t\tif (field == \"email\") req.flash(\"error\", { msg: req.t(\"EmailIsExists\") });else req.flash(\"error\", { msg: req.t(\"UsernameIsExists\") });\n\t\t\t\t\t}\n\t\t\t\t\tdone(err, user);\n\t\t\t\t});\n\t\t\t}, function sendEmail(user, done) {\n\t\t\t\tif (user.verified) {\n\t\t\t\t\t(function () {\n\t\t\t\t\t\tvar subject = req.t(\"mailSubjectWelcome\", config);\n\t\n\t\t\t\t\t\tres.render(\"mail/welcome\", {\n\t\t\t\t\t\t\tname: user.fullName\n\t\t\t\t\t\t}, function (err, html) {\n\t\t\t\t\t\t\tif (err) return done(err);\n\t\n\t\t\t\t\t\t\tmailer.send(user.email, subject, html, function (err, info) {\n\t\n\t\t\t\t\t\t\t\tdone(null, user);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t})();\n\t\t\t\t} else {\n\t\t\t\t\t(function () {\n\t\t\t\t\t\tvar subject = req.t(\"mailSubjectActivate\", config);\n\t\n\t\t\t\t\t\tres.render(\"mail/accountVerify\", {\n\t\t\t\t\t\t\tname: user.fullName,\n\t\t\t\t\t\t\tvalidateLink: \"http://\" + req.headers.host + \"/verify/\" + user.verifyToken\n\t\t\t\t\t\t}, function (err, html) {\n\t\t\t\t\t\t\tif (err) return done(err);\n\t\n\t\t\t\t\t\t\tmailer.send(user.email, subject, html, function (err, info) {\n\t\t\t\t\t\t\t\tif (err) req.flash(\"error\", { msg: req.t(\"UnableToSendEmail\", user) });else req.flash(\"info\", { msg: req.t(\"emailSentVerifyLink\") });\n\t\n\t\t\t\t\t\t\t\tdone(err, user);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t})();\n\t\t\t\t}\n\t\t\t}], function (err, user) {\n\t\t\t\tif (err) {\n\t\t\t\t\tlogger.error(err);\n\t\t\t\t\treturn res.redirect(\"back\");\n\t\t\t\t}\n\t\n\t\t\t\tif (user.verified) {\n\t\t\t\t\treq.login(user, function (err) {\n\t\t\t\t\t\tif (err) logger.error(err);\n\t\n\t\t\t\t\t\treturn res.redirect(\"/\");\n\t\t\t\t\t});\n\t\t\t\t} else res.redirect(\"/login\");\n\t\t\t});\n\t\t});\n\t\n\t\tapp.get(\"/verify/:token\", function (req, res) {\n\t\t\tif (req.isAuthenticated()) return res.redirect(\"/\");\n\t\n\t\t\tasync.waterfall([function checkToken(done) {\n\t\t\t\tUser.findOne({ verifyToken: req.params.token }).exec(function (err, user) {\n\t\t\t\t\tif (err) return done(err);\n\t\n\t\t\t\t\tif (!user) {\n\t\t\t\t\t\treq.flash(\"error\", { msg: req.t(\"AccountVerificationExpired\") });\n\t\t\t\t\t\treturn done(\"Verification is invalid!\");\n\t\t\t\t\t}\n\t\n\t\t\t\t\tuser.verified = true;\n\t\t\t\t\tuser.verifyToken = undefined;\n\t\t\t\t\tuser.lastLogin = Date.now();\n\t\n\t\t\t\t\tuser.save(function (err) {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\treq.flash(\"error\", { msg: req.t(\"UnableModifyAccountDetails\") });\n\t\t\t\t\t\t\treturn done(err);\n\t\t\t\t\t\t}\n\t\n\t\t\t\t\t\tdone(null, user);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}, function sendWelcomeEmailToUser(user, done) {\n\t\t\t\tvar subject = req.t(\"mailSubjectWelcome\", config);\n\t\n\t\t\t\tres.render(\"mail/welcome\", {\n\t\t\t\t\tname: user.fullName\n\t\t\t\t}, function (err, html) {\n\t\t\t\t\tif (err) return done(err);\n\t\n\t\t\t\t\tmailer.send(user.email, subject, html, function (err, info) {\n\t\n\t\t\t\t\t\tdone(null, user);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}, function loginUser(user, done) {\n\t\t\t\treq.login(user, function (err) {\n\t\t\t\t\tdone(err, user);\n\t\t\t\t});\n\t\t\t}], function (err) {\n\t\t\t\tif (err) {\n\t\t\t\t\tlogger.error(err);\n\t\t\t\t\treturn res.redirect(\"/signup\");\n\t\t\t\t}\n\t\n\t\t\t\tres.redirect(\"/\");\n\t\t\t});\n\t\t});\n\t\n\t\tapp.get(\"/passwordless/:token\", function (req, res) {\n\t\t\tif (req.isAuthenticated()) return res.redirect(\"/\");\n\t\n\t\t\tasync.waterfall([function checkToken(done) {\n\t\t\t\tUser.findOne({ passwordLessToken: req.params.token }).exec(function (err, user) {\n\t\t\t\t\tif (err) return done(err);\n\t\n\t\t\t\t\tif (!user) {\n\t\t\t\t\t\treq.flash(\"error\", { msg: req.t(\"PasswordlessTokenExpired\") });\n\t\t\t\t\t\treturn done(\"Token is invalid!\");\n\t\t\t\t\t}\n\t\n\t\t\t\t\tuser.passwordLessToken = undefined;\n\t\t\t\t\tif (!user.verified) {\n\t\t\t\t\t\tuser.verified = true;\n\t\t\t\t\t\tuser.verifyToken = undefined;\n\t\t\t\t\t}\n\t\t\t\t\tuser.lastLogin = Date.now();\n\t\n\t\t\t\t\tuser.save(function (err) {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\treq.flash(\"error\", { msg: req.t(\"UnableModifyAccountDetails\") });\n\t\t\t\t\t\t\treturn done(err);\n\t\t\t\t\t\t}\n\t\n\t\t\t\t\t\tdone(null, user);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}, function loginUser(user, done) {\n\t\t\t\treq.login(user, function (err) {\n\t\t\t\t\tdone(err, user);\n\t\t\t\t});\n\t\t\t}], function (err) {\n\t\t\t\tif (err) {\n\t\t\t\t\tlogger.error(err);\n\t\t\t\t\treturn res.redirect(\"/login\");\n\t\t\t\t}\n\t\n\t\t\t\tres.redirect(\"/\");\n\t\t\t});\n\t\t});\n\t\n\t\tapp.get(\"/forgot\", function (req, res) {\n\t\t\tif (req.isAuthenticated()) return res.redirect(\"/\");\n\t\n\t\t\tres.render(\"account/forgot\");\n\t\t});\n\t\n\t\tapp.post(\"/forgot\", function (req, res) {\n\t\t\treq.assert(\"email\", req.t(\"EmailIsNotValid\")).isEmail();\n\t\t\treq.assert(\"email\", req.t(\"EmailCannotBeEmpty\")).notEmpty();\n\t\t\treq.sanitize(\"email\").normalizeEmail({ remove_dots: false });\n\t\n\t\t\tvar errors = req.validationErrors();\n\t\t\tif (errors) {\n\t\t\t\treq.flash(\"error\", errors);\n\t\t\t\treturn res.redirect(\"back\");\n\t\t\t}\n\t\n\t\t\tasync.waterfall([function generateToken(done) {\n\t\t\t\tcrypto.randomBytes(25, function (err, buf) {\n\t\t\t\t\tdone(err, err ? null : buf.toString(\"hex\"));\n\t\t\t\t});\n\t\t\t}, function getUserAndSaveToken(token, done) {\n\t\t\t\tUser.findOne({ email: req.body.email }, function (err, user) {\n\t\t\t\t\tif (!user) {\n\t\t\t\t\t\treq.flash(\"error\", { msg: req.t(\"EmailNotAssociatedToAccount\", req.body) });\n\t\t\t\t\t\treturn done(\"Email address \" + req.body.email + \" is not registered!\");\n\t\t\t\t\t}\n\t\n\t\t\t\t\tuser.resetPasswordToken = token;\n\t\t\t\t\tuser.resetPasswordExpires = Date.now() + 3600000;\n\t\t\t\t\tuser.save(function (err) {\n\t\t\t\t\t\tdone(err, token, user);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}, function sendResetEmailToUser(token, user, done) {\n\t\t\t\tvar subject = req.t(\"mailSubjectResetPassword\", config);\n\t\n\t\t\t\tres.render(\"mail/passwordReset\", {\n\t\t\t\t\tname: user.fullName,\n\t\t\t\t\tresetLink: \"http://\" + req.headers.host + \"/reset/\" + token\n\t\t\t\t}, function (err, html) {\n\t\t\t\t\tif (err) return done(err);\n\t\n\t\t\t\t\tmailer.send(user.email, subject, html, function (err, info) {\n\t\t\t\t\t\tif (err) req.flash(\"error\", { msg: req.t(\"UnableToSendEmail\", user) });else req.flash(\"info\", { msg: req.t(\"emailSentPasswordResetLink\", user) });\n\t\n\t\t\t\t\t\tdone(err);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}], function (err) {\n\t\t\t\tif (err) logger.error(err);\n\t\n\t\t\t\tres.redirect(\"back\");\n\t\t\t});\n\t\t});\n\t\n\t\tapp.get(\"/reset/:token\", function (req, res, next) {\n\t\t\tif (req.isAuthenticated()) return res.redirect(\"/\");\n\t\n\t\t\tUser.findOne({ resetPasswordToken: req.params.token }).where(\"resetPasswordExpires\").gt(Date.now()).exec(function (err, user) {\n\t\t\t\tif (err) return next(err);\n\t\n\t\t\t\tif (!user) {\n\t\t\t\t\treq.flash(\"error\", { msg: req.t(\"PasswordResetTokenExpired\") });\n\t\t\t\t\treturn res.redirect(\"/forgot\");\n\t\t\t\t}\n\t\n\t\t\t\tres.render(\"account/reset\");\n\t\t\t});\n\t\t});\n\t\n\t\tapp.post(\"/reset/:token\", function (req, res, next) {\n\t\t\treq.assert(\"password\", req.t(\"PasswordTooShort\")).len(6);\n\t\t\treq.assert(\"confirm\", req.t(\"PasswordNotMatched\")).equals(req.body.password);\n\t\n\t\t\tvar errors = req.validationErrors();\n\t\t\tif (errors) {\n\t\t\t\treq.flash(\"error\", errors);\n\t\t\t\treturn res.redirect(\"back\");\n\t\t\t}\n\t\n\t\t\tasync.waterfall([function checkTokenAndExpires(done) {\n\t\t\t\tUser.findOne({ resetPasswordToken: req.params.token }).where(\"resetPasswordExpires\").gt(Date.now()).exec(function (err, user) {\n\t\t\t\t\tif (err) return done(err);\n\t\n\t\t\t\t\tif (!user) {\n\t\t\t\t\t\treq.flash(\"error\", { msg: req.t(\"PasswordResetTokenExpired\") });\n\t\t\t\t\t\treturn done(\"Password reset token is invalid or has expired.\");\n\t\t\t\t\t}\n\t\n\t\t\t\t\tif (user.passwordLess) user.passwordLess = false;\n\t\n\t\t\t\t\tuser.password = req.body.password;\n\t\t\t\t\tuser.resetPasswordToken = undefined;\n\t\t\t\t\tuser.resetPasswordExpires = undefined;\n\t\t\t\t\tuser.lastLogin = Date.now();\n\t\n\t\t\t\t\tuser.save(function (err) {\n\t\t\t\t\t\tif (err) return done(err);\n\t\n\t\t\t\t\t\treq.login(user, function (err) {\n\t\t\t\t\t\t\tdone(err, user);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}, function sendPasswordChangeEmailToUser(user, done) {\n\t\t\t\tvar subject = req.t(\"mailSubjectPasswordChanged\", config);\n\t\n\t\t\t\tres.render(\"mail/passwordChange\", {\n\t\t\t\t\tname: user.fullName\n\t\t\t\t}, function (err, html) {\n\t\t\t\t\tif (err) return done(err);\n\t\n\t\t\t\t\tmailer.send(user.email, subject, html, function (err, info) {\n\t\t\t\t\t\tif (err) req.flash(\"error\", { msg: req.t(\"UnableToSendEmail\", user) });else req.flash(\"info\", { msg: req.t(\"PasswordChanged\") });\n\t\n\t\t\t\t\t\tdone(err);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}], function (err) {\n\t\t\t\tif (err) {\n\t\t\t\t\tlogger.error(err);\n\t\t\t\t\treturn res.redirect(\"back\");\n\t\t\t\t}\n\t\n\t\t\t\tres.redirect(\"/\");\n\t\t\t});\n\t\t});\n\t\n\t\tapp.get(\"/generateAPIKey\", function (req, res) {\n\t\t\tif (!req.isAuthenticated()) return response.json(res, null, response.UNAUTHORIZED);\n\t\n\t\t\tUser.findById(req.user.id).exec(function (err, user) {\n\t\t\t\tif (err) return response.json(res, null, response.SERVER_ERROR);\n\t\n\t\t\t\tif (!user) {\n\t\t\t\t\treturn response.json(res, null, response.NOT_FOUND, req.t(\"InvalidUser\"));\n\t\t\t\t}\n\t\n\t\t\t\tuser.apiKey = tokgen();\n\t\n\t\t\t\tuser.save(function (err) {\n\t\t\t\t\tif (err) return response.json(res, null, response.SERVER_ERROR);\n\t\n\t\t\t\t\treturn response.json(res, user);\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t};\n\n/***/ },\n/* 85 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"async\");\n\n/***/ },\n/* 86 */\n/***/ function(module, exports) {\n\n\t\"use strict\";\n\t\n\tmodule.exports = {\n\t\n\t\tBAD_REQUEST: {\n\t\t\tstatus: 400,\n\t\t\ttype: \"BAD_REQUEST\",\n\t\t\tmessage: \"Invalid request\"\n\t\t},\n\t\n\t\tUNAUTHORIZED: {\n\t\t\tstatus: 401,\n\t\t\ttype: \"UNAUTHORIZED\",\n\t\t\tmessage: \"Unauthorized. Please login first!\"\n\t\t},\n\t\n\t\tREQUEST_FAILED: {\n\t\t\tstatus: 402,\n\t\t\ttype: \"REQUEST_FAILED\",\n\t\t\tmessage: \"Request failed!\"\n\t\t},\n\t\n\t\tFORBIDDEN: {\n\t\t\tstatus: 403,\n\t\t\ttype: \"FORBIDDEN\",\n\t\t\tmessage: \"You have no permission for this resource!\"\n\t\t},\n\t\n\t\tNOT_FOUND: {\n\t\t\tstatus: 404,\n\t\t\ttype: \"NOT_FOUND\",\n\t\t\tmessage: \"Not found!\"\n\t\t},\n\t\n\t\tTOO_MANY_REQUEST: {\n\t\t\tstatus: 429,\n\t\t\ttype: \"TOO_MANY_REQUEST\",\n\t\t\tmessage: \"Too many request!\"\n\t\t},\n\t\n\t\tSERVER_ERROR: {\n\t\t\tstatus: 500,\n\t\t\ttype: \"SERVER_ERROR\",\n\t\t\tmessage: \"Server error\"\n\t\t},\n\t\n\t\tNOT_IMPLEMENTED: {\n\t\t\tstatus: 501,\n\t\t\ttype: \"NOT_IMPLEMENTED\",\n\t\t\tmessage: \"This resource is not implemented!\"\n\t\t},\n\t\n\t\tjson: function json(res, data, err, errMessage) {\n\t\t\tvar response = {};\n\t\n\t\t\tif (err) {\n\t\t\t\tresponse.error = err;\n\t\t\t\tresponse.status = err.status || 500;\n\t\t\t\tif (errMessage) response.error.message = errMessage;\n\t\n\t\t\t\tresponse.data = data;\n\t\n\t\t\t\treturn res.status(response.status).json(response);\n\t\t\t}\n\t\n\t\t\tresponse.status = 200;\n\t\t\tresponse.data = data;\n\t\n\t\t\treturn res.json(response);\n\t\t}\n\t};\n\n/***/ },\n/* 87 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar config = __webpack_require__(1);\n\tvar logger = __webpack_require__(12);\n\tvar nodemailer = __webpack_require__(88);\n\tvar htmlToText = __webpack_require__(89).htmlToText;\n\t\n\tmodule.exports = {\n\t\tsend: function send(recipients, subject, body, cb) {\n\t\t\tlogger.info(\"Sending email to \" + recipients + \" with subject \" + subject + \"...\");\n\t\n\t\t\tvar mailOptions = {\n\t\t\t\tfrom: config.mailer.from,\n\t\t\t\tto: recipients,\n\t\t\t\tsubject: subject,\n\t\t\t\thtml: body\n\t\t\t};\n\t\n\t\t\tvar transporter = void 0;\n\t\t\tif (config.mailer.transport == \"smtp\") {\n\t\t\t\ttransporter = nodemailer.createTransport(config.mailer.smtp);\n\t\t\t} else if (config.mailer.transport == \"mailgun\") {\n\t\t\t\tvar mg = __webpack_require__(90);\n\t\t\t\ttransporter = nodemailer.createTransport(mg({\n\t\t\t\t\tauth: {\n\t\t\t\t\t\tapi_key: config.mailer.mailgun.apiKey,\n\t\t\t\t\t\tdomain: config.mailer.mailgun.domain\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t} else if (config.mailer.transport == \"sendgrid\") {\n\t\t\t\tvar sgTransport = __webpack_require__(91);\n\t\t\t\ttransporter = nodemailer.createTransport(sgTransport({\n\t\t\t\t\tauth: {\n\t\t\t\t\t\tapi_key: config.mailer.sendgrid.apiKey\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t}\n\t\n\t\t\tif (transporter) {\n\t\t\t\ttransporter.use(\"compile\", htmlToText());\n\t\t\t\ttransporter.sendMail(mailOptions, function (err, info) {\n\t\t\t\t\tif (err) logger.warn(\"Unable to send email: \", err);else logger.info(\"Email message sent.\", info.response);\n\t\n\t\t\t\t\tif (cb) cb(err, info);\n\t\t\t\t});\n\t\t\t} else logger.warn(\"Unable to send email! Invalid mailer transport: \" + config.mailer.transport);\n\t\t}\n\t};\n\n/***/ },\n/* 88 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"nodemailer\");\n\n/***/ },\n/* 89 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"nodemailer-html-to-text\");\n\n/***/ },\n/* 90 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"nodemailer-mailgun-transport\");\n\n/***/ },\n/* 91 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"nodemailer-sendgrid-transport\");\n\n/***/ },\n/* 92 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar config = __webpack_require__(1);\n\tvar logger = __webpack_require__(12);\n\t\n\tvar crypto = __webpack_require__(32);\n\tvar async = __webpack_require__(85);\n\t\n\tvar passport = __webpack_require__(61);\n\tvar express = __webpack_require__(40);\n\t\n\tvar mailer = __webpack_require__(87);\n\tvar User = __webpack_require__(30);\n\tvar Response = __webpack_require__(86);\n\t\n\tfunction response(req, res, redirect, err) {\n\t\tif (req.accepts(\"json\") && !req.accepts(\"html\")) {\n\t\n\t\t\tvar flash = req.flash();\n\t\n\t\t\tif (flash && flash.error && flash.error.length > 0) {\n\t\n\t\t\t\tvar errMessage = flash.error[0].msg;\n\t\t\t\tResponse.json(res, null, err || Response.REQUEST_FAILED, errMessage);\n\t\t\t} else {\n\t\t\t\tvar successData = \"OK\";\n\t\t\t\tif (flash && flash.info && flash.info.length > 0) successData = flash.info[0].msg;\n\t\t\t\tResponse.json(res, successData);\n\t\t\t}\n\t\t} else if (redirect) res.redirect(redirect);\n\t}\n\t\n\tmodule.exports = function (app, db) {\n\t\n\t\tvar authRouter = express.Router();\n\t\n\t\tauthRouter.post(\"/local\", function (req, res, next) {\n\t\n\t\t\treq.assert(\"username\", req.t(\"UsernameCannotBeEmpty\")).notEmpty();\n\t\n\t\n\t\t\tvar errors = req.validationErrors();\n\t\t\tif (errors) {\n\t\t\t\treq.flash(\"error\", errors);\n\t\t\t\treturn response(req, res, \"/login\", Response.BAD_REQUEST);\n\t\t\t}\n\t\n\t\t\tif (req.body.password) {\n\t\t\t\tpassport.authenticate(\"local\", function (err, user, info) {\n\t\t\t\t\tif (!user) {\n\t\t\t\t\t\treq.flash(\"error\", { msg: info.message });\n\t\t\t\t\t\treturn response(req, res, \"/login\");\n\t\t\t\t\t}\n\t\n\t\t\t\t\treq.login(user, function (err) {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\treq.flash(\"error\", { msg: err });\n\t\t\t\t\t\t\treturn response(req, res, \"/login\");\n\t\t\t\t\t\t}\n\t\n\t\t\t\t\t\treq.user.lastLogin = Date.now();\n\t\t\t\t\t\treq.user.save(function () {\n\t\t\t\t\t\t\treq.user.password = undefined;\n\t\t\t\t\t\t\treq.user.salt = undefined;\n\t\t\t\t\t\t\tresponse(req, res, \"/\");\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t})(req, res, next);\n\t\t\t} else {\n\t\t\t\tasync.waterfall([function generateToken(done) {\n\t\t\t\t\tcrypto.randomBytes(25, function (err, buf) {\n\t\t\t\t\t\tdone(err, err ? null : buf.toString(\"hex\"));\n\t\t\t\t\t});\n\t\t\t\t}, function getUser(token, done) {\n\t\t\t\t\tvar username = req.body.username;\n\t\t\t\t\tUser.findOne({ username: username }, function (err, user) {\n\t\t\t\t\t\tif (!user) {\n\t\t\t\t\t\t\treq.flash(\"error\", { msg: req.t(\"UsernameIsNotAssociated\", { username: username }) });\n\t\t\t\t\t\t\treturn done(\"Invalid username \" + username);\n\t\t\t\t\t\t}\n\t\n\t\t\t\t\t\tuser.passwordLessToken = token;\n\t\n\t\t\t\t\t\tuser.save(function (err) {\n\t\t\t\t\t\t\tdone(err, token, user);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}, function sendResetEmailToUser(token, user, done) {\n\t\t\t\t\tvar subject = req.t(\"mailSubjectLogin\", config);\n\t\n\t\t\t\t\tres.render(\"mail/passwordLessLogin\", {\n\t\t\t\t\t\tname: user.fullName,\n\t\t\t\t\t\tloginLink: \"http://\" + req.headers.host + \"/passwordless/\" + token\n\t\t\t\t\t}, function (err, html) {\n\t\t\t\t\t\tif (err) return done(err);\n\t\n\t\t\t\t\t\tmailer.send(user.email, subject, html, function (err, info) {\n\t\t\t\t\t\t\tif (err) req.flash(\"error\", { msg: req.t(\"UnableToSendEmail\", user) });else req.flash(\"info\", { msg: req.t(\"emailSentWithMagicLink\", user) });\n\t\n\t\t\t\t\t\t\tdone(err);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}], function (err, user) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\tlogger.error(err);\n\t\t\t\t\t}\n\t\n\t\t\t\t\tresponse(req, res, \"back\");\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\n\t\tauthRouter.get(\"/google\", passport.authenticate(\"google\", {\n\t\t\tscope: \"profile email\"\n\t\t}));\n\t\n\t\tauthRouter.get(\"/google/callback\", passport.authenticate(\"google\", {\n\t\t\tfailureRedirect: \"/login\"\n\t\t}), function (req, res) {\n\t\t\tres.redirect(\"/\");\n\t\t});\n\t\n\t\tauthRouter.get(\"/facebook\", passport.authenticate(\"facebook\", {\n\t\t\tscope: [\"email\", \"user_location\"]\n\t\t}));\n\t\n\t\tauthRouter.get(\"/facebook/callback\", passport.authenticate(\"facebook\", {\n\t\t\tfailureRedirect: \"/login\"\n\t\t}), function (req, res) {\n\t\t\tres.redirect(\"/\");\n\t\t});\n\t\n\t\tauthRouter.get(\"/twitter\", passport.authenticate(\"twitter\"));\n\t\n\t\tauthRouter.get(\"/twitter/callback\", passport.authenticate(\"twitter\", {\n\t\t\tfailureRedirect: \"/login\"\n\t\t}), function (req, res) {\n\t\t\tres.redirect(\"/\");\n\t\t});\n\t\n\t\tauthRouter.get(\"/github\", passport.authenticate(\"github\", {\n\t\t\tscope: \"user:email\"\n\t\t}));\n\t\n\t\tauthRouter.get(\"/github/callback\", passport.authenticate(\"github\", {\n\t\t\tfailureRedirect: \"/login\"\n\t\t}), function (req, res) {\n\t\t\tres.redirect(\"/\");\n\t\t});\n\t\n\t\tapp.use(\"/auth\", authRouter);\n\t};\n\n/***/ },\n/* 93 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t/* WEBPACK VAR INJECTION */(function(__dirname) {\n\t\"use strict\";\n\t\n\tvar logger = __webpack_require__(12);\n\tvar config = __webpack_require__(1);\n\t\n\tvar path = __webpack_require__(7);\n\tvar chalk = __webpack_require__(9);\n\t\n\tif (false) require('require-webpack-compat')(module, require);\n\t\n\tmodule.exports = function (app, db) {\n\t\tlogger.info(\"\");\n\t\tlogger.info(chalk.bold(\"Search routes...\"));\n\t\n\t\tfunction requireAll(r) {\n\t\t\treturn r.keys().map(function (module) {\n\t\t\t\tlogger.info(\"  Load\", path.relative(path.join(__dirname, \"modules\"), module), \"route...\");\n\t\t\t\tvar router = r(module);\n\t\t\t\trouter(app, db);\n\t\n\t\t\t\treturn router;\n\t\t\t});\n\t\t}\n\t\tvar modules = requireAll(__webpack_require__(94));\n\t};\n\t/* WEBPACK VAR INJECTION */}.call(exports, \"server\\\\applogic\"))\n\n/***/ },\n/* 94 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar map = {\n\t\t\"./counter/routes.js\": 95,\n\t\t\"./devices/routes.js\": 97,\n\t\t\"./posts/routes.js\": 106,\n\t\t\"./session/routes.js\": 107\n\t};\n\tfunction webpackContext(req) {\n\t\treturn __webpack_require__(webpackContextResolve(req));\n\t};\n\tfunction webpackContextResolve(req) {\n\t\treturn map[req] || (function() { throw new Error(\"Cannot find module '\" + req + \"'.\") }());\n\t};\n\twebpackContext.keys = function webpackContextKeys() {\n\t\treturn Object.keys(map);\n\t};\n\twebpackContext.resolve = webpackContextResolve;\n\tmodule.exports = webpackContext;\n\twebpackContext.id = 94;\n\n\n/***/ },\n/* 95 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar logger = __webpack_require__(12);\n\tvar config = __webpack_require__(1);\n\t\n\tvar auth = __webpack_require__(66);\n\tvar store = __webpack_require__(96);\n\t\n\tmodule.exports = function (app, db) {\n\t\tapp.get(\"/counter\", auth.isAuthenticated, function (req, res) {\n\t\t\tres.send(\"Hello Counter! \" + store.counter);\n\t\t});\n\t};\n\n/***/ },\n/* 96 */\n/***/ function(module, exports) {\n\n\t\"use strict\";\n\t\n\tmodule.exports = {\n\t\tcounter: 0\n\t};\n\n/***/ },\n/* 97 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar logger = __webpack_require__(12);\n\tvar config = __webpack_require__(1);\n\t\n\tvar express = __webpack_require__(40);\n\t\n\tvar auth = __webpack_require__(66);\n\tvar response = __webpack_require__(86);\n\tvar Device = __webpack_require__(37);\n\t\n\tvar io = __webpack_require__(98);\n\t\n\tvar namespace = \"/devices\";\n\t\n\tmodule.exports = function (app, db) {\n\t\n\t\tvar router = express.Router();\n\t\n\t\trouter.use(auth.isAuthenticatedOrApiKey);\n\t\n\t\trouter.route(\"/\").get(function (req, res) {\n\t\n\t\t\tDevice.find({}).exec(function (err, docs) {\n\t\t\t\treturn res.format({\n\t\t\t\t\tjson: function json() {\n\t\t\t\t\t\tif (docs.length == 0) return response.json(res, []);\n\t\n\t\t\t\t\t\tvar items = docs.map(function (item) {\n\t\t\t\t\t\t\treturn item.toJSON();\n\t\t\t\t\t\t});\n\t\n\t\t\t\t\t\treturn response.json(res, items);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}).post(function (req, res) {\n\t\n\t\t\treq.assert(\"name\", \"Device name cannot be blank!\").notEmpty();\n\t\n\t\t\tvar errors = req.validationErrors();\n\t\t\tif (errors) return response.json(res, null, response.BAD_REQUEST, errors);\n\t\n\t\t\tvar device = new Device({\n\t\t\t\taddress: req.body.address,\n\t\t\t\ttype: req.body.type,\n\t\t\t\tname: req.body.name,\n\t\t\t\tdescription: req.body.description,\n\t\t\t\tstatus: req.body.status\n\t\t\t});\n\t\n\t\t\tdevice.save(function (err) {\n\t\t\t\tif (err) return response.json(res, null, response.SERVER_ERROR, err);\n\t\n\t\t\t\tvar json = device.toJSON();\n\t\n\t\t\t\tif (io.namespaces[namespace]) io.namespaces[namespace].emit(\"new\", json);\n\t\n\t\t\t\treturn response.json(res, json);\n\t\t\t});\n\t\t});\n\t\n\t\trouter.param(\"deviceID\", function (req, res, next, deviceID) {\n\t\t\tvar id = Device.schema.methods.decodeID(deviceID);\n\t\t\tif (id == null || id == \"\") return response.json(res, null, response.BAD_REQUEST, \"Invalid Device ID!\");\n\t\n\t\t\tDevice.findById(id, function (err, doc) {\n\t\t\t\tif (err) return response.json(res, null, response.BAD_REQUEST, err);\n\t\n\t\t\t\tif (!doc) return response.json(res, null, response.NOT_FOUND, \"Device not found!\");\n\t\n\t\t\t\treq.device = doc;\n\t\t\t\tnext();\n\t\t\t});\n\t\t});\n\t\n\t\trouter.route(\"/:deviceID\").all(function (req, res, next) {\n\t\n\t\t\tnext();\n\t\t}).get(function (req, res) {\n\t\t\treturn response.json(res, req.device.toJSON());\n\t\t}).put(function (req, res) {\n\t\t\tif (req.body.address != null) req.device.address = req.body.address;\n\t\n\t\t\tif (req.body.type != null) req.device.type = req.body.type;\n\t\n\t\t\tif (req.body.name != null) req.device.name = req.body.name;\n\t\n\t\t\tif (req.body.description != null) req.device.description = req.body.description;\n\t\n\t\t\tif (req.body.status != null) req.device.status = req.body.status;\n\t\n\t\t\treq.device.save(function (err) {\n\t\t\t\tif (err) return response.json(res, null, response.BAD_REQUEST, err);\n\t\n\t\t\t\tvar json = req.device.toJSON();\n\t\n\t\t\t\tif (io.namespaces[namespace]) io.namespaces[namespace].emit(\"update\", json);\n\t\n\t\t\t\treturn response.json(res, json);\n\t\t\t});\n\t\t}).delete(function (req, res) {\n\t\t\tDevice.remove({ _id: req.device.id }, function (err) {\n\t\t\t\tif (err) return response.json(res, null, response.BAD_REQUEST, err);\n\t\n\t\t\t\tif (io.namespaces[namespace]) io.namespaces[namespace].emit(\"remove\", req.device.toJSON());\n\t\n\t\t\t\treturn response.json(res);\n\t\t\t});\n\t\t});\n\t\n\t\tapp.use(\"/v1\" + namespace, router);\n\t\n\t\tapp.use(namespace, router);\n\t};\n\n/***/ },\n/* 98 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar logger = __webpack_require__(12);\n\tvar config = __webpack_require__(1);\n\tvar secrets = __webpack_require__(8);\n\t\n\tvar path = __webpack_require__(7);\n\tvar fs = __webpack_require__(10);\n\tvar http = __webpack_require__(41);\n\tvar _ = __webpack_require__(2);\n\t\n\tvar cookieParser = __webpack_require__(46);\n\tvar passport = __webpack_require__(61);\n\tvar socketio = __webpack_require__(99);\n\tvar session = __webpack_require__(50);\n\tvar MongoStore = __webpack_require__(55)(session);\n\t\n\tvar socketHandlers = __webpack_require__(100);\n\t\n\tvar self = {\n\t\tnamespaces: {},\n\t\n\t\tonlineUsers: [],\n\t\n\t\tinit: function init(app, db) {\n\t\t\tvar server = http.createServer(app);\n\t\n\t\t\tvar mongoStore = new MongoStore({\n\t\t\t\tmongooseConnection: db.connection,\n\t\t\t\tcollection: config.sessions.collection,\n\t\t\t\tautoReconnect: true\n\t\t\t});\n\t\n\t\t\tvar IO = socketio(server);\n\t\n\t\t\tself.initNameSpace(\"/\", IO, mongoStore);\n\t\t\tIO.on(\"connection\", function (socket) {\n\t\t\t\tsocket.on(\"welcome\", function (msg) {\n\t\t\t\t\tlogger.info(\"Incoming welcome message from \" + socket.request.user.username + \":\", msg);\n\t\t\t\t});\n\t\t\t});\n\t\n\t\t\tsocketHandlers.handlers.forEach(function (Handler) {\n\t\t\t\tif (!Handler || !Handler.namespace) return;\n\t\n\t\t\t\tvar io = self.namespaces[Handler.namespace];\n\t\t\t\tif (io == null) {\n\t\t\t\t\tio = IO.of(Handler.namespace);\n\t\t\t\t\tself.initNameSpace(Handler.namespace, io, mongoStore, Handler.role);\n\t\n\t\t\t\t\tif (_.isFunction(Handler.init)) Handler.init(io);\n\t\t\t\t}\n\t\t\t});\n\t\n\t\t\tapp.io = self;\n\t\n\t\t\treturn server;\n\t\t},\n\t\tinitNameSpace: function initNameSpace(ns, io, mongoStore, roleRequired) {\n\t\t\tio.use(function (socket, next) {\n\t\t\t\tcookieParser(secrets.sessionSecret)(socket.request, {}, function (err) {\n\t\t\t\t\tvar sessionId = socket.request.signedCookies ? socket.request.signedCookies[config.sessions.name] : undefined;\n\t\n\t\t\t\t\tif (!sessionId) {\n\t\t\t\t\t\tlogger.warn(\"sessionId was not found in socket.request\");\n\t\t\t\t\t\treturn next(new Error(\"sessionId was not found in socket.request\"), false);\n\t\t\t\t\t}\n\t\n\t\t\t\t\tmongoStore.get(sessionId, function (err, session) {\n\t\t\t\t\t\tif (err) return next(err, false);\n\t\t\t\t\t\tif (!session) return next(new Error(\"session was not found for \" + sessionId), false);\n\t\n\t\t\t\t\t\tsocket.request.session = session;\n\t\n\t\t\t\t\t\tsession.socket = socket.id;\n\t\t\t\t\t\tmongoStore.set(sessionId, session);\n\t\n\t\t\t\t\t\tpassport.initialize()(socket.request, {}, function () {\n\t\t\t\t\t\t\tpassport.session()(socket.request, {}, function () {\n\t\t\t\t\t\t\t\tif (socket.request.user) {\n\t\t\t\t\t\t\t\t\tvar user = socket.request.user;\n\t\n\t\t\t\t\t\t\t\t\tif (roleRequired) {\n\t\t\t\t\t\t\t\t\t\tif (user.roles && user.roles.indexOf(roleRequired) !== -1) next(null, true);else {\n\t\t\t\t\t\t\t\t\t\t\tlogger.warn(\"Websocket user has no access to this namespace '\" + ns + \"'!\");\n\t\t\t\t\t\t\t\t\t\t\tnext(new Error(\"You have NO access to this namespace '\" + ns + \"'!\"), false);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} else next(null, true);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tlogger.warn(\"Websocket user is not authenticated!\");\n\t\t\t\t\t\t\t\t\tnext(new Error(\"User is not authenticated! Please login first!\"), false);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\n\t\t\tio.on(\"connection\", function (socket) {\n\t\t\t\tself.addOnlineUser(socket.request.user);\n\t\t\t\tlogger.debug(\"WS client connected to namespace \" + (io.name || \"root\") + \"! User: \" + socket.request.user.username);\n\t\n\t\t\t\tsocket.on(\"disconnect\", function () {\n\t\t\t\t\tself.removeOnlineUser(socket.request.user);\n\t\t\t\t\tlogger.debug(\"WS client disconnected from namespace \" + (io.name || \"root\") + \"!\");\n\t\t\t\t});\n\t\t\t});\n\t\n\t\t\tself.namespaces[ns] = io;\n\t\t},\n\t\tnsEmit: function nsEmit(namespace, command, data) {\n\t\t\tif (self.namespaces[namespace]) {\n\t\t\t\tself.namespaces[namespace].emit(command, data);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t},\n\t\taddOnlineUser: function addOnlineUser(user) {\n\t\t\tself.removeOnlineUser(user);\n\t\t\tself.onlineUsers.push(user);\n\t\t},\n\t\tremoveOnlineUser: function removeOnlineUser(user) {\n\t\t\t_.remove(self.onlineUsers, function (u) {\n\t\t\t\treturn u._id == user._id;\n\t\t\t});\n\t\t}\n\t};\n\t\n\tmodule.exports = self;\n\n/***/ },\n/* 99 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"socket.io\");\n\n/***/ },\n/* 100 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t/* WEBPACK VAR INJECTION */(function(__dirname) {\"use strict\";\n\t\n\tvar logger = __webpack_require__(12);\n\tvar config = __webpack_require__(1);\n\t\n\tvar path = __webpack_require__(7);\n\tvar chalk = __webpack_require__(9);\n\t\n\tif (false) require('require-webpack-compat')(module, require);\n\t\n\tlogger.info(\"\");\n\tlogger.info(chalk.bold(\"Search socket handlers...\"));\n\t\n\tfunction requireAll(r) {\n\t\treturn r.keys().map(function (module) {\n\t\t\tlogger.info(\"  Load\", path.relative(path.join(__dirname, \"modules\"), module), \"handler...\");\n\t\t\treturn r(module);\n\t\t});\n\t}\n\t\n\tmodule.exports.handlers = requireAll(__webpack_require__(101));\n\t/* WEBPACK VAR INJECTION */}.call(exports, \"server\\\\applogic\"))\n\n/***/ },\n/* 101 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar map = {\n\t\t\"./counter/socket.js\": 102,\n\t\t\"./devices/socket.js\": 103,\n\t\t\"./posts/socket.js\": 104\n\t};\n\tfunction webpackContext(req) {\n\t\treturn __webpack_require__(webpackContextResolve(req));\n\t};\n\tfunction webpackContextResolve(req) {\n\t\treturn map[req] || (function() { throw new Error(\"Cannot find module '\" + req + \"'.\") }());\n\t};\n\twebpackContext.keys = function webpackContextKeys() {\n\t\treturn Object.keys(map);\n\t};\n\twebpackContext.resolve = webpackContextResolve;\n\tmodule.exports = webpackContext;\n\twebpackContext.id = 101;\n\n\n/***/ },\n/* 102 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar logger = __webpack_require__(12);\n\tvar config = __webpack_require__(1);\n\t\n\tvar store = __webpack_require__(96);\n\t\n\tmodule.exports = {\n\t\n\t\tnamespace: \"/counter\",\n\t\n\t\tinit: function init(io) {\n\t\t\tio.on(\"connection\", function (socket) {\n\t\n\t\t\t\tsocket.on(\"changed\", function (msg) {\n\t\t\t\t\tstore.counter = msg;\n\t\t\t\t\tlogger.info(socket.request.user.username + \" increment the counter to \", store.counter);\n\t\t\t\t\tsocket.broadcast.emit(\"changed\", store.counter);\n\t\t\t\t});\n\t\n\t\t\t\tsocket.emit(\"changed\", store.counter);\n\t\t\t});\n\t\t}\n\t};\n\n/***/ },\n/* 103 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar logger = __webpack_require__(12);\n\tvar config = __webpack_require__(1);\n\t\n\tmodule.exports = {\n\t\n\t\tnamespace: \"/devices\",\n\t\tinit: function init(io) {\n\t\t\tio.on(\"connection\", function (socket) {});\n\t\t}\n\t};\n\n/***/ },\n/* 104 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar logger = __webpack_require__(12);\n\tvar config = __webpack_require__(1);\n\tvar moduleConfig = __webpack_require__(105);\n\t\n\tmodule.exports = {\n\t\n\t\tnamespace: moduleConfig.namespace,\n\t\tinit: function init(io) {\n\t\t\tio.on(\"connection\", function (socket) {});\n\t\t}\n\t};\n\n/***/ },\n/* 105 */\n/***/ function(module, exports) {\n\n\tmodule.exports = {\n\t\t\"namespace\": \"/posts\"\n\t};\n\n/***/ },\n/* 106 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar logger = __webpack_require__(12);\n\tvar config = __webpack_require__(1);\n\t\n\tvar moduleConfig = __webpack_require__(105);\n\t\n\tvar express = __webpack_require__(40);\n\tvar async = __webpack_require__(85);\n\t\n\tvar auth = __webpack_require__(66);\n\tvar response = __webpack_require__(86);\n\tvar Post = __webpack_require__(38);\n\t\n\tvar io = __webpack_require__(98);\n\t\n\tmodule.exports = function (app, db) {\n\t\n\t\tvar router = express.Router();\n\t\n\t\trouter.use(auth.isAuthenticatedOrApiKey);\n\t\n\t\trouter.use(auth.hasRole(\"user\"));\n\t\n\t\trouter.get(\"/upvote/:postID\", function (req, res) {\n\t\n\t\t\tasync.waterfall([function checkUserInIsUpVoters(done) {\n\t\t\t\tif (req.post.upVoters.indexOf(req.user.id) !== -1) done(req.t(\"YouHaveAlreadyVotedThisPost\"));else done();\n\t\t\t}, function removeUserFromDownVoters(done) {\n\t\t\t\tif (req.post.downVoters.indexOf(req.user.id) !== -1) Post.findByIdAndUpdate(req.post.id, { $pull: { downVoters: req.user.id }, $inc: { votes: 1 } }, { \"new\": true }, done);else done(null, null);\n\t\t\t}, function addUserToUpVoters(doc, done) {\n\t\t\t\tPost.findByIdAndUpdate(req.post.id, { $addToSet: { upVoters: req.user.id }, $inc: { votes: 1 } }, { \"new\": true }, done);\n\t\t\t}, function populateAuthorOfPost(doc, done) {\n\t\t\t\tdoc.populate(\"author\", \"fullName code email gravatar\", done);\n\t\t\t}], function (err, doc) {\n\t\t\t\tif (err) return response.json(res, null, response.BAD_REQUEST, err);\n\t\n\t\t\t\tvar json = doc.toJSON();\n\t\n\t\t\t\tif (io.namespaces[moduleConfig.namespace]) io.namespaces[moduleConfig.namespace].emit(\"update\", json);\n\t\n\t\t\t\treturn response.json(res, json);\n\t\t\t});\n\t\t});\n\t\n\t\trouter.get(\"/downvote/:postID\", function (req, res) {\n\t\t\tPromise.resolve().then(function () {\n\t\t\t\tif (req.post.downVoters.indexOf(req.user.id) !== -1) throw new Error(req.t(\"YouHaveAlreadyVotedThisPost\"));\n\t\t\t}).then(function () {\n\t\t\t\tif (req.post.upVoters.indexOf(req.user.id) !== -1) return Post.findByIdAndUpdate(req.post.id, { $pull: { upVoters: req.user.id }, $inc: { votes: -1 } }, { \"new\": true });\n\t\t\t}).then(function () {\n\t\t\t\treturn Post.findByIdAndUpdate(req.post.id, { $addToSet: { downVoters: req.user.id }, $inc: { votes: -1 } }, { \"new\": true });\n\t\t\t}).then(function (doc) {\n\t\t\t\treturn Post.populate(doc, { path: \"author\", select: \"fullName code email gravatar\" });\n\t\t\t}).then(function (doc) {\n\t\t\t\tvar json = doc.toJSON();\n\t\n\t\t\t\tif (io.namespaces[moduleConfig.namespace]) io.namespaces[moduleConfig.namespace].emit(\"update\", json);\n\t\n\t\t\t\tresponse.json(res, json);\n\t\t\t}).catch(function (err) {\n\t\t\t\tresponse.json(res, null, response.BAD_REQUEST, err.message);\n\t\t\t});\n\t\t});\n\t\n\t\trouter.get(\"/:viewMode/:sort\", function (req, res) {\n\t\n\t\t\tvar filter = {};\n\t\n\t\t\tif (req.params.viewMode == \"my\") filter.author = req.user.id;\n\t\n\t\t\tvar query = Post.find(filter);\n\t\n\t\t\tswitch (req.params.sort) {\n\t\t\t\tcase \"hot\":\n\t\t\t\t\tquery.sort({ votes: -1 });break;\n\t\t\t\tcase \"mostviewed\":\n\t\t\t\t\tquery.sort({ views: -1 });break;\n\t\t\t\tdefault:\n\t\t\t\t\tquery.sort({ createdAt: -1 });\n\t\t\t}\n\t\n\t\t\tif (req.query.limit) query.limit(req.query.limit || 20);\n\t\n\t\t\tquery.populate(\"author\", \"fullName code email gravatar\");\n\t\n\t\t\tquery.exec(function (err, docs) {\n\t\t\t\tif (!docs || docs.length == 0) return response.json(res, []);\n\t\n\t\t\t\tvar items = docs.map(function (item) {\n\t\t\t\t\treturn item.toJSON();\n\t\t\t\t});\n\t\t\t\treturn response.json(res, items);\n\t\t\t});\n\t\t});\n\t\n\t\trouter.post(\"/\", function (req, res) {\n\t\n\t\t\treq.assert(\"title\", req.t(\"PostTitleCannotBeEmpty\")).notEmpty();\n\t\t\treq.assert(\"content\", req.t(\"PostContentCannotBeEmpty\")).notEmpty();\n\t\n\t\t\tvar errors = req.validationErrors();\n\t\t\tif (errors) return response.json(res, null, response.BAD_REQUEST, errors);\n\t\n\t\t\tvar post = new Post({\n\t\t\t\ttitle: req.body.title,\n\t\t\t\tcontent: req.body.content,\n\t\t\t\tauthor: req.user.id\n\t\t\t});\n\t\n\t\t\tpost.save(function (err) {\n\t\t\t\tif (err) return response.json(res, null, response.SERVER_ERROR, err);\n\t\n\t\t\t\tpost.populate(\"author\", \"fullName code email gravatar\", function (err) {\n\t\n\t\t\t\t\tvar json = post.toJSON();\n\t\n\t\t\t\t\tif (io.namespaces[moduleConfig.namespace]) io.namespaces[moduleConfig.namespace].emit(\"new\", json);\n\t\n\t\t\t\t\treturn response.json(res, json);\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t\n\t\trouter.param(\"postID\", function (req, res, next, postID) {\n\t\t\tvar id = Post.schema.methods.decodeID(postID);\n\t\t\tif (id == null || id == \"\") return response.json(res, null, response.BAD_REQUEST, req.t(\"InvalidPostID\"));\n\t\n\t\t\tPost.findById(id, function (err, doc) {\n\t\t\t\tif (err) return response.json(res, null, response.BAD_REQUEST, err);\n\t\n\t\t\t\tif (!doc) return response.json(res, null, response.NOT_FOUND, req.t(\"PostNotFound\"));\n\t\n\t\t\t\tdoc.populate(\"author\", \"fullName code email gravatar\", function (err) {\n\t\n\t\t\t\t\treq.post = doc;\n\t\t\t\t\tnext();\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t\n\t\trouter.route(\"/:postID\").all(function (req, res, next) {\n\t\n\t\t\tnext();\n\t\t}).get(function (req, res) {\n\t\t\tPost.findByIdAndUpdate(req.post.id, { $inc: { views: 1 } }).exec();\n\t\n\t\t\treturn response.json(res, req.post.toJSON());\n\t\t}).put(function (req, res) {\n\t\t\treq.assert(\"title\", req.t(\"PostTitleCannotBeEmpty\")).notEmpty();\n\t\t\treq.assert(\"content\", req.t(\"PostContentCannotBeEmpty\")).notEmpty();\n\t\n\t\t\tvar errors = req.validationErrors();\n\t\t\tif (errors) return response.json(res, null, response.BAD_REQUEST, errors);\n\t\n\t\t\tif (req.post.author.id != req.user.id) {\n\t\t\t\treturn response.json(res, null, response.BAD_REQUEST, req.t(\"OnlyAuthorEditPost\"));\n\t\t\t}\n\t\n\t\t\treq.post.title = req.body.title;\n\t\t\treq.post.content = req.body.content;\n\t\n\t\t\treq.post.save(function (err) {\n\t\t\t\tif (err) return response.json(res, null, response.BAD_REQUEST, err);\n\t\n\t\t\t\tvar json = req.post.toJSON();\n\t\n\t\t\t\tif (io.namespaces[moduleConfig.namespace]) io.namespaces[moduleConfig.namespace].emit(\"update\", json);\n\t\n\t\t\t\treturn response.json(res, json);\n\t\t\t});\n\t\t}).delete(function (req, res) {\n\t\n\t\t\tif (req.post.author.id != req.user.id) {\n\t\t\t\treturn response.json(res, null, response.BAD_REQUEST, req.t(\"OnlyAuthorDeletePost\"));\n\t\t\t}\n\t\n\t\t\tPost.remove({ _id: req.post.id }, function (err) {\n\t\t\t\tif (err) return response.json(res, null, response.BAD_REQUEST, err);\n\t\n\t\t\t\tif (io.namespaces[moduleConfig.namespace]) io.namespaces[moduleConfig.namespace].emit(\"remove\", req.post.toJSON());\n\t\n\t\t\t\treturn response.json(res);\n\t\t\t});\n\t\t});\n\t\n\t\tapp.use(\"/v1/posts\", router);\n\t\n\t\tapp.use(\"/posts\", router);\n\t};\n\n/***/ },\n/* 107 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar logger = __webpack_require__(12);\n\tvar config = __webpack_require__(1);\n\t\n\tvar _ = __webpack_require__(2);\n\tvar express = __webpack_require__(40);\n\t\n\tvar auth = __webpack_require__(66);\n\tvar response = __webpack_require__(86);\n\t\n\tvar io = __webpack_require__(98);\n\tvar User = __webpack_require__(30);\n\t\n\tvar namespace = \"/session\";\n\t\n\tfunction pickUserProps(user) {\n\t\treturn _.pick(user, [\"fullName\", \"email\", \"username\", \"roles\", \"lastLogin\"]);\n\t}\n\t\n\tmodule.exports = function (app, db) {\n\t\n\t\tvar router = express.Router();\n\t\n\t\trouter.use(auth.isAuthenticatedOrApiKey);\n\t\n\t\trouter.get(\"/me\", function (req, res) {\n\t\t\tresponse.json(res, req.user.pick([\"code\", \"fullName\", \"email\", \"username\", \"roles\", \"lastLogin\", \"gravatar\", \"provider\", \"profile\", \"socialLinks\", \"apiKey\", \"passwordLess\"]));\n\t\t});\n\t\n\t\trouter.get(\"/onlineUsers\", function (req, res) {\n\t\t\tvar users = _.map(io.onlineUsers, function (user) {\n\t\t\t\treturn user.pick();\n\t\t\t});\n\t\n\t\t\tresponse.json(res, users);\n\t\t});\n\t\n\t\tapp.use(\"/v1\" + namespace, router);\n\t\n\t\tapp.use(namespace, router);\n\t};\n\n/***/ },\n/* 108 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar config = __webpack_require__(1);\n\tvar logger = __webpack_require__(12);\n\tvar auth = __webpack_require__(66);\n\tvar ApolloServer = __webpack_require__(109).apolloServer;\n\tvar graphqlTools = __webpack_require__(110);\n\tvar Schema = __webpack_require__(111).schema;\n\tvar Resolvers = __webpack_require__(111).resolvers;\n\t\n\tmodule.exports = function (app, db) {\n\t\n\t\tvar schema = graphqlTools.makeExecutableSchema({ typeDefs: Schema, resolvers: Resolvers });\n\t\n\t\tapp.use(\"/graphql\", auth.isAuthenticatedOrApiKey, ApolloServer(function (req) {\n\t\t\tvar query = req.query.query || req.body.query;\n\t\t\tif (query && query.length > 2000) {\n\t\t\t\tthrow new Error(\"Query too large.\");\n\t\t\t}\n\t\t\tlogger.debug(\"GraphQL query:\", query);\n\t\n\t\t\treturn {\n\t\t\t\tgraphiql: config.isDevMode(),\n\t\t\t\tpretty: config.isDevMode(),\n\t\t\t\tprintErrors: config.isDevMode(),\n\t\t\t\tschema: schema,\n\t\n\t\t\t\tcontext: {\n\t\t\t\t\treq: req,\n\t\t\t\t\tt: req.t,\n\t\t\t\t\tuser: req.user,\n\t\t\t\t\tsession: req.session\n\t\t\t\t}\n\t\t\t};\n\t\t}));\n\t};\n\n/***/ },\n/* 109 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"apollo-server\");\n\n/***/ },\n/* 110 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"graphql-tools\");\n\n/***/ },\n/* 111 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t/* WEBPACK VAR INJECTION */(function(__dirname) {\"use strict\";\n\t\n\tvar logger = __webpack_require__(12);\n\tvar config = __webpack_require__(1);\n\tvar graphqlTools = __webpack_require__(110);\n\tvar path = __webpack_require__(7);\n\tvar chalk = __webpack_require__(9);\n\tvar _ = __webpack_require__(2);\n\t\n\tif (false) require('require-webpack-compat')(module, require);\n\t\n\tvar moduleQueries = [];\n\tvar moduleTypeDefinitions = [];\n\tvar moduleMutations = [];\n\tvar moduleResolvers = [];\n\t\n\tlogger.info(\"\");\n\tlogger.info(chalk.bold(\"Search GraphQL schemas...\"));\n\t\n\tfunction requireAll(r) {\n\t\treturn r.keys().map(function (module) {\n\t\t\tlogger.info(\"  Load\", path.relative(path.join(__dirname, \"..\", \"applogic\", \"modules\"), module), \"schema...\");\n\t\t\treturn r(module);\n\t\t});\n\t}\n\tvar schemas = requireAll(__webpack_require__(112));\n\tschemas = schemas.concat(requireAll(__webpack_require__(115)));\n\t\n\tschemas.forEach(function (moduleSchema) {\n\t\tmoduleQueries.push(moduleSchema.schema.query);\n\t\tmoduleTypeDefinitions.push(moduleSchema.schema.typeDefinitions);\n\t\tmoduleMutations.push(moduleSchema.schema.mutation);\n\t\n\t\tmoduleResolvers.push(moduleSchema.resolvers);\n\t});\n\t\n\tvar schema = \"\\n\\nscalar Timestamp\\n\\ntype Query {\\n\\t\" + moduleQueries.join(\"\\n\") + \"\\n}\\n\\n\" + moduleTypeDefinitions.join(\"\\n\") + \"\\n\\ntype Mutation {\\n\\t\" + moduleMutations.join(\"\\n\") + \"\\n}\\n\\nschema {\\n  query: Query\\n  mutation: Mutation\\n}\\n\";\n\t\n\tfunction mergeModuleResolvers(baseResolvers) {\n\t\tmoduleResolvers.forEach(function (module) {\n\t\t\tbaseResolvers = _.merge(baseResolvers, module);\n\t\t});\n\t\n\t\treturn baseResolvers;\n\t}\n\t\n\tmodule.exports = {\n\t\tschema: [schema],\n\t\tresolvers: mergeModuleResolvers({\n\t\n\t\t\tTimestamp: {\n\t\t\t\t__parseValue: function __parseValue(value) {\n\t\t\t\t\treturn new Date(value);\n\t\t\t\t},\n\t\t\t\t__serialize: function __serialize(value) {\n\t\t\t\t\treturn value.getTime();\n\t\t\t\t},\n\t\t\t\t__parseLiteral: function __parseLiteral(ast) {\n\t\t\t\t\tconsole.log(ast);\n\t\t\t\t}\n\t\t\t}\n\t\n\t\t})\n\t};\n\t/* WEBPACK VAR INJECTION */}.call(exports, \"server\\\\schema\"))\n\n/***/ },\n/* 112 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar map = {\n\t\t\"./user.schema.js\": 113\n\t};\n\tfunction webpackContext(req) {\n\t\treturn __webpack_require__(webpackContextResolve(req));\n\t};\n\tfunction webpackContextResolve(req) {\n\t\treturn map[req] || (function() { throw new Error(\"Cannot find module '\" + req + \"'.\") }());\n\t};\n\twebpackContext.keys = function webpackContextKeys() {\n\t\treturn Object.keys(map);\n\t};\n\twebpackContext.resolve = webpackContextResolve;\n\tmodule.exports = webpackContext;\n\twebpackContext.id = 112;\n\n\n/***/ },\n/* 113 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar logger = __webpack_require__(12);\n\tvar config = __webpack_require__(1);\n\t\n\tvar _ = __webpack_require__(2);\n\tvar C = __webpack_require__(31);\n\t\n\tvar Post = __webpack_require__(38);\n\tvar User = __webpack_require__(30);\n\t\n\tvar helper = __webpack_require__(114);\n\t\n\tvar io = __webpack_require__(98);\n\t\n\tvar query = \"\\n\\tusers(limit: Int, offset: Int, sort: String): [User]\\n\\tuser(id: Int, code: String): User\\n\";\n\t\n\tvar typeDefinitions = \"\\ntype User {\\n\\tid: Int!\\n\\tcode: String!\\n\\tfullName: String\\n\\temail: String\\n\\tusername: String\\n\\tprovider: String\\n\\troles: [String]\\n\\tverified: Boolean\\n\\tgravatar: String\\n\\tlastLogin: Timestamp\\n\\tposts(limit: Int, offset: Int, sort: String): [Post]\\n}\\n\";\n\t\n\tvar mutation = \"\\n\";\n\t\n\tvar resolvers = {\n\t\tQuery: {\n\t\t\tusers: function users(root, args, context) {\n\t\t\t\tif (!helper.hasRole(context, C.ROLE_ADMIN)) return null;\n\t\n\t\t\t\treturn helper.applyLimitOffsetSort(User.find({}), args).exec();\n\t\t\t},\n\t\t\tuser: function user(root, args, context) {\n\t\t\t\tif (!helper.hasRole(context, C.ROLE_ADMIN)) return null;\n\t\n\t\t\t\tvar id = args.id;\n\t\n\t\t\t\tif (args.code) id = User.schema.methods.decodeID(args.code);\n\t\n\t\t\t\tif (id) return User.findById(id).exec();\n\t\t\t}\n\t\t},\n\t\n\t\tUser: {\n\t\t\tposts: function posts(author, args, context) {\n\t\t\t\tif (!helper.hasRole(context, C.ROLE_USER)) return null;\n\t\n\t\t\t\treturn helper.applyLimitOffsetSort(Post.find({ author: author.id }), args).exec();\n\t\t\t}\n\t\t},\n\t\n\t\tMutation: {}\n\t\n\t};\n\t\n\tmodule.exports = {\n\t\tschema: {\n\t\t\tquery: query,\n\t\t\ttypeDefinitions: typeDefinitions,\n\t\t\tmutation: mutation\n\t\t},\n\t\tresolvers: resolvers\n\t};\n\n/***/ },\n/* 114 */\n/***/ function(module, exports) {\n\n\t\"use strict\";\n\t\n\tfunction applyLimitOffsetSort(query, args) {\n\t\tif (args.limit) query.limit(args.limit);\n\t\n\t\tif (args.offset) query.skip(args.offset);\n\t\n\t\tif (args.sort) query.sort(args.sort);\n\t\n\t\treturn query;\n\t}\n\t\n\tfunction hasRole(context, role) {\n\t\treturn context.user.roles.indexOf(role) != -1;\n\t}\n\t\n\tmodule.exports = {\n\t\tapplyLimitOffsetSort: applyLimitOffsetSort,\n\t\thasRole: hasRole\n\t};\n\n/***/ },\n/* 115 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar map = {\n\t\t\"./devices/schema.js\": 116,\n\t\t\"./posts/schema.js\": 117\n\t};\n\tfunction webpackContext(req) {\n\t\treturn __webpack_require__(webpackContextResolve(req));\n\t};\n\tfunction webpackContextResolve(req) {\n\t\treturn map[req] || (function() { throw new Error(\"Cannot find module '\" + req + \"'.\") }());\n\t};\n\twebpackContext.keys = function webpackContextKeys() {\n\t\treturn Object.keys(map);\n\t};\n\twebpackContext.resolve = webpackContextResolve;\n\tmodule.exports = webpackContext;\n\twebpackContext.id = 115;\n\n\n/***/ },\n/* 116 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar logger = __webpack_require__(12);\n\tvar config = __webpack_require__(1);\n\t\n\tvar _ = __webpack_require__(2);\n\tvar async = __webpack_require__(85);\n\tvar C = __webpack_require__(31);\n\t\n\tvar Device = __webpack_require__(37);\n\t\n\tvar helper = __webpack_require__(114);\n\t\n\tvar query = \"\\n\\tdevices(limit: Int, offset: Int, sort: String): [Device]\\n\\tdevice(id: Int, code: String): Device\\n\";\n\t\n\tvar typeDefinitions = \"\\ntype Device {\\n\\tid: Int!\\n\\tcode: String!\\n\\taddress: String\\n\\ttype: String\\n\\tname: String\\n\\tdescription: String\\n\\tstatus: Int\\n\\tlastCommunication: Timestamp\\n}\\n\";\n\t\n\tvar mutation = \"\";\n\t\n\tvar resolvers = {\n\t\tQuery: {\n\t\t\tdevices: function devices(root, args, context) {\n\t\t\t\tif (!helper.hasRole(context, C.ROLE_USER)) return null;\n\t\n\t\t\t\treturn helper.applyLimitOffsetSort(Device.find({}), args).exec();\n\t\t\t},\n\t\t\tdevice: function device(root, args, context) {\n\t\t\t\tif (!helper.hasRole(context, C.ROLE_USER)) return null;\n\t\n\t\t\t\tvar id = args.id;\n\t\n\t\t\t\tif (args.code) id = Device.schema.methods.decodeID(args.code);\n\t\n\t\t\t\tif (id) return Device.findById(id).exec();\n\t\t\t}\n\t\t},\n\t\n\t\tMutation: {}\n\t\n\t};\n\t\n\tmodule.exports = {\n\t\tschema: {\n\t\t\tquery: query,\n\t\t\ttypeDefinitions: typeDefinitions,\n\t\t\tmutation: mutation\n\t\t},\n\t\tresolvers: resolvers\n\t};\n\n/***/ },\n/* 117 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar logger = __webpack_require__(12);\n\tvar config = __webpack_require__(1);\n\t\n\tvar moduleConfig = __webpack_require__(105);\n\t\n\tvar _ = __webpack_require__(2);\n\tvar async = __webpack_require__(85);\n\tvar C = __webpack_require__(31);\n\t\n\tvar Post = __webpack_require__(38);\n\tvar User = __webpack_require__(30);\n\t\n\tvar io = __webpack_require__(98);\n\t\n\tvar helper = __webpack_require__(114);\n\t\n\tvar query = \"\\n\\tposts(limit: Int, offset: Int, sort: String): [Post]\\n\\tpost(id: Int, code: String): Post\\n\";\n\t\n\tvar typeDefinitions = \"\\ntype Post {\\n\\tid: Int!\\n\\tcode: String!\\n\\ttitle: String\\n\\tcontent: String\\n\\tauthor: User!\\n\\tviews: Int\\n\\tvoters(limit: Int, offset: Int, sort: String): [User]\\n\\tupVoters(limit: Int, offset: Int, sort: String): [User]\\n\\tdownVoters(limit: Int, offset: Int, sort: String): [User]\\n\\tvotes: Int,\\n\\tcreatedAt: Timestamp\\n\\tupdatedAt: Timestamp\\n}\\n\";\n\t\n\tvar mutation = \"\\n\\tupVote(postID: Int!): Post\\n\\tdownVote(postID: Int!): Post\\n\";\n\t\n\tvar resolvers = {\n\t\tQuery: {\n\t\t\tposts: function posts(root, args, context) {\n\t\t\t\tif (!helper.hasRole(context, C.ROLE_USER)) return null;\n\t\n\t\t\t\treturn helper.applyLimitOffsetSort(Post.find({}), args).exec();\n\t\t\t},\n\t\t\tpost: function post(root, args, context) {\n\t\t\t\tif (!helper.hasRole(context, C.ROLE_USER)) return null;\n\t\n\t\t\t\tvar id = args.id;\n\t\n\t\t\t\tif (args.code) id = Post.schema.methods.decodeID(args.code);\n\t\n\t\t\t\tif (id) return Post.findById(id).exec();\n\t\t\t}\n\t\t},\n\t\n\t\tPost: {\n\t\t\tauthor: function author(post, args, context) {\n\t\t\t\tif (!helper.hasRole(context, C.ROLE_USER)) return null;\n\t\n\t\t\t\treturn User.findById(post.author).exec();\n\t\t\t},\n\t\t\tupVoters: function upVoters(post, args, context) {\n\t\t\t\tif (!helper.hasRole(context, C.ROLE_USER)) return null;\n\t\n\t\t\t\treturn helper.applyLimitOffsetSort(User.find({ _id: { $in: post.upVoters } }), args).exec();\n\t\t\t},\n\t\t\tdownVoters: function downVoters(post, args, context) {\n\t\t\t\tif (!helper.hasRole(context, C.ROLE_USER)) return null;\n\t\n\t\t\t\treturn helper.applyLimitOffsetSort(User.find({ _id: { $in: post.downVoters } }), args).exec();\n\t\t\t},\n\t\t\tvoters: function voters(post, args, context) {\n\t\t\t\tif (!helper.hasRole(context, C.ROLE_USER)) return null;\n\t\n\t\t\t\treturn helper.applyLimitOffsetSort(User.find({ _id: { $in: post.upVoters.concat(post.downVoters) } }), args).exec();\n\t\t\t}\n\t\t},\n\t\n\t\tMutation: {\n\t\t\tupVote: function upVote(root, args, context) {\n\t\t\t\tvar user = context.user;\n\t\t\t\tvar postID = args.postID;\n\t\n\t\t\t\tif (!helper.hasRole(context, C.ROLE_USER)) return Promise.reject(\"Must has 'user' role for this function!\");\n\t\n\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\tasync.waterfall([function getPostById(done) {\n\t\t\t\t\t\tPost.findById(postID, done);\n\t\t\t\t\t}, function checkUserInIsUpVoters(post, done) {\n\t\t\t\t\t\tif (post.upVoters.indexOf(user.id) !== -1) done(context.t(\"YouHaveAlreadyVotedThisPost\"));else done(null, post);\n\t\t\t\t\t}, function removeUserFromDownVoters(post, done) {\n\t\t\t\t\t\tif (post.downVoters.indexOf(user.id) !== -1) Post.findByIdAndUpdate(postID, { $pull: { downVoters: user.id }, $inc: { votes: 1 } }, { \"new\": true }, done);else done(null, null);\n\t\t\t\t\t}, function addUserToUpVoters(doc, done) {\n\t\t\t\t\t\tPost.findByIdAndUpdate(postID, { $addToSet: { upVoters: user.id }, $inc: { votes: 1 } }, { \"new\": true }, done);\n\t\t\t\t\t}, function populateAuthorOfPost(doc, done) {\n\t\t\t\t\t\tdoc.populate(\"author\", \"fullName code email gravatar\", done);\n\t\t\t\t\t}], function (err, doc) {\n\t\t\t\t\t\tif (err) return reject(err);\n\t\n\t\t\t\t\t\tvar json = doc.toJSON();\n\t\n\t\t\t\t\t\tio.nsemit(\"update\", json);\n\t\n\t\t\t\t\t\tresolve(doc);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t},\n\t\t\tdownVote: function downVote(root, args, context) {\n\t\t\t\tvar user = context.user;\n\t\t\t\tvar postID = args.postID;\n\t\n\t\t\t\treturn Promise.resolve().then(function () {\n\t\t\t\t\tif (!helper.hasRole(context, C.ROLE_USER)) throw new Error(\"Must has 'user' role for this function!\");\n\t\t\t\t}).then(function () {\n\t\t\t\t\treturn Post.findById(postID);\n\t\t\t\t}).then(function (post) {\n\t\t\t\t\tif (post.downVoters.indexOf(user.id) !== -1) throw new Error(context.t(\"YouHaveAlreadyVotedThisPost\"));else return post;\n\t\t\t\t}).then(function (post) {\n\t\t\t\t\tif (post.upVoters.indexOf(user.id) !== -1) return Post.findByIdAndUpdate(post.id, { $pull: { upVoters: user.id }, $inc: { votes: -1 } }, { \"new\": true });\n\t\t\t\t}).then(function (post) {\n\t\t\t\t\treturn Post.findByIdAndUpdate(post.id, { $addToSet: { downVoters: user.id }, $inc: { votes: -1 } }, { \"new\": true });\n\t\t\t\t}).then(function (doc) {\n\t\t\t\t\treturn Post.populate(doc, { path: \"author\", select: \"fullName code email gravatar\" });\n\t\t\t\t}).then(function (doc) {\n\t\t\t\t\tvar json = doc.toJSON();\n\t\n\t\t\t\t\tio.nsemit(\"update\", json);\n\t\n\t\t\t\t\treturn doc;\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t};\n\t\n\tmodule.exports = {\n\t\tschema: {\n\t\t\tquery: query,\n\t\t\ttypeDefinitions: typeDefinitions,\n\t\t\tmutation: mutation\n\t\t},\n\t\tresolvers: resolvers\n\t};\n\n/***/ },\n/* 118 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar config = __webpack_require__(1);\n\tvar logger = __webpack_require__(12);\n\t\n\tvar response = __webpack_require__(86);\n\t\n\tmodule.exports = function (app, db) {\n\t\n\t\tapp.use(function (err, req, res, next) {\n\t\t\tif (!err) {\n\t\t\t\treturn next();\n\t\t\t}\n\t\n\t\t\tlogger.error(err.stack);\n\t\t\tres.status(err.status || 500);\n\t\n\t\t\tif (req.accepts(\"html\")) {\n\t\t\t\treturn res.render(\"500\", {\n\t\t\t\t\turl: req.originalUrl,\n\t\t\t\t\terror: err\n\t\t\t\t});\n\t\t\t}\n\t\n\t\t\tif (req.accepts(\"json\")) {\n\t\t\t\treturn response.json(res, null, response.SERVER_ERROR);\n\t\t\t}\n\t\t});\n\t\n\t\tapp.use(function (req, res) {\n\t\t\tres.status(404);\n\t\t\tif (!config.isTestMode()) logger.warn(\"404 error! URL:\", req.url);\n\t\n\t\t\tif (req.accepts(\"html\")) {\n\t\t\t\tvar err = new Error(\"404 Page Not Found\");\n\t\t\t\terr.status = 404;\n\t\t\t\treturn res.render(\"404\", {\n\t\t\t\t\turl: req.originalUrl,\n\t\t\t\t\terror: err\n\t\t\t\t});\n\t\t\t}\n\t\n\t\t\tif (req.accepts(\"json\")) {\n\t\t\t\treturn response.json(res, null, response.NOT_FOUND);\n\t\t\t}\n\t\t});\n\t};\n\n/***/ },\n/* 119 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar logger = __webpack_require__(12);\n\tvar config = __webpack_require__(1);\n\t\n\tvar moment = __webpack_require__(21);\n\tvar chalk = __webpack_require__(9);\n\tvar Agenda = __webpack_require__(120);\n\t\n\tvar User = __webpack_require__(30);\n\t\n\tvar agenda = new Agenda({\n\t\tdb: {\n\t\t\taddress: config.db.uri,\n\t\t\tcollection: \"agendaJobs\"\n\t\t},\n\t\tprocessEvery: config.agendaTimer || \"one minute\"\n\t});\n\t\n\tagenda.on(\"fail\", function (err, job) {\n\t\treturn logger.error(\"Job failed with error: \" + err.message);\n\t});\n\t\n\tagenda.define(\"removeUnverifiedAccounts\", function (job, done) {\n\t\tlogger.debug(\"Running 'removeUnverifiedAccounts' process...\");\n\t\ttry {\n\t\n\t\t\tUser.remove({\n\t\t\t\tcreatedAt: {\n\t\t\t\t\t$lte: moment().subtract(1, \"day\").toDate()\n\t\t\t\t},\n\t\t\t\tverified: false\n\t\t\t}, function (err, count) {\n\t\t\t\tif (count > 0) logger.warn(chalk.bold.red(count + \" unverified and expired account removed!\"));\n\t\n\t\t\t\tdone();\n\t\t\t});\n\t\t} catch (error) {\n\t\t\tlogger.error(\"Job running exception!\");\n\t\t\tlogger.error(error);\n\t\t\treturn done(error);\n\t\t}\n\t});\n\t\n\tagenda.on(\"ready\", function () {\n\t\tif (config.isTestMode()) return;\n\t\n\t\tagenda.every(\"8 hours\", \"removeUnverifiedAccounts\");\n\t\tagenda.start();\n\t\tlogger.info(chalk.yellow(\"Agenda started!\"));\n\t});\n\t\n\tmodule.exports = agenda;\n\n/***/ },\n/* 120 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"agenda\");\n\n/***/ },\n/* 121 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar config = __webpack_require__(1);\n\tvar logger = __webpack_require__(12);\n\tvar chalk = __webpack_require__(9);\n\tvar moment = __webpack_require__(21);\n\tvar mongoose = __webpack_require__(24);\n\tvar agenda = __webpack_require__(119);\n\t\n\tvar gracefulExit = function gracefulExit() {\n\t\tif (mongoose.connection.readyState === 0) {\n\t\t\treturn process.exit(0);\n\t\t}\n\t\tmongoose.connection.close(function () {\n\t\t\treturn agenda.stop(function () {\n\t\t\t\tlogger.info();\n\t\t\t\tlogger.info(chalk.bold(\"---------------------[ Server stopped at %s Uptime: %s ]---------------------------\"), moment().format(\"YYYY-MM-DD HH:mm:ss.SSS\"), moment.duration(process.uptime() * 1000).humanize());\n\t\t\t\treturn process.exit(0);\n\t\t\t});\n\t\t});\n\t};\n\t\n\tprocess.on(\"SIGINT\", gracefulExit).on(\"SIGTERM\", gracefulExit);\n\n/***/ },\n/* 122 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar os = __webpack_require__(123);\n\tvar clui = __webpack_require__(124);\n\tvar pretty = __webpack_require__(125);\n\tvar logger = __webpack_require__(12);\n\t\n\tmodule.exports = function () {\n\t\tvar Gauge = clui.Gauge;\n\t\tvar total = os.totalmem();\n\t\tvar free = os.freemem();\n\t\tvar used = total - free;\n\t\tvar human = pretty(free);\n\t\n\t\tlogger.info(\"CPU:\\t\\tArch: \" + os.arch() + \", Cores: \" + os.cpus().length);\n\t\tlogger.info(\"Memory:\\t\\t\" + Gauge(used, total, 20, total * 0.8, human + \" free\"));\n\t\tlogger.info(\"OS:\\t\\t\" + os.platform() + \" (\" + os.type() + \")\");\n\t};\n\n/***/ },\n/* 123 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"os\");\n\n/***/ },\n/* 124 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"clui\");\n\n/***/ },\n/* 125 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"pretty-bytes\");\n\n/***/ }\n/******/ ]);\n\n\n/** WEBPACK FOOTER **\n ** bundle.js\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 23409b1d95160a6d8db8\n **/","\"use strict\";\r\n\r\nglobal.WEBPACK_BUNDLE = false;\r\n\r\nlet config\t\t= require(\"./config\");\r\nlet logger \t\t= require(\"./core/logger\");\r\nlet moment \t\t= require(\"moment\");\r\nlet chalk \t\t= require(\"chalk\");\r\n\r\nlogger.info();\r\nlogger.info(chalk.bold(\"---------------------[ Server starting at %s ]---------------------------\"), moment().format(\"YYYY-MM-DD HH:mm:ss.SSS\"));\r\n\r\nlet init\t\t= require(\"./core/init\");\r\nlet db \t\t\t= require(\"./core/mongo\")();\r\nlet app \t\t= require(\"./core/express\")(db);\r\nlet agenda \t\t= require(\"./core/agenda\");\r\n\r\nrequire(\"./libs/gracefulExit\");\r\n\r\napp.listen(config.port, function() {\r\n\r\n\tlogger.info(\"\");\r\n\tlogger.info(config.app.title + \" v\" + config.app.version + \" application started!\");\r\n\tlogger.info(\"----------------------------------------------\");\r\n\tlogger.info(\"Environment:\\t\" + chalk.underline.bold(process.env.NODE_ENV));\r\n\tlogger.info(\"IP:\\t\\t\" + config.ip);\r\n\tlogger.info(\"Port:\\t\\t\" + config.port);\r\n\tlogger.info(\"Database:\\t\\t\" + config.db.uri);\r\n\tlogger.info(\"\");\r\n\r\n\trequire(\"./libs/sysinfo\")();\r\n\r\n\tlogger.info(\"----------------------------------------------\");\r\n\r\n});\r\n\r\n\r\nexports = module.exports = app;\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./server/index.js\n **/","\"use strict\";\r\n\r\nlet _ \t\t= require(\"lodash\");\r\n\r\nmodule.exports = {\r\n\r\n\tisDevMode() {\r\n\t\treturn !process.env.NODE_ENV || process.env.NODE_ENV === \"development\";\r\n\t}, \r\n\r\n\tisProductionMode() {\r\n\t\treturn process.env.NODE_ENV === \"production\";\r\n\t},\r\n\r\n\tisTestMode() {\r\n\t\treturn process.env.NODE_ENV === \"test\";\r\n\t}\r\n};\r\n\r\nlet config = {};\r\nif (module.exports.isTestMode()) {\r\n\tconsole.log(\"Load test config...\");\r\n\tconfig = require(\"./test\");\r\n}\r\nelse if (module.exports.isProductionMode()) {\r\n\tconsole.log(\"Load production config...\");\r\n\tconfig = require(\"./prod\");\r\n}\r\n\r\nmodule.exports = _.defaultsDeep(module.exports, config, require(\"./default\"));\r\n\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./server/config/index.js\n **/","module.exports = require(\"lodash\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"lodash\"\n ** module id = 2\n ** module chunks = 0\n **/","\"use strict\";\r\n\r\nlet pkg = require(\"../../package.json\");\r\n\r\nmodule.exports = {\r\n\tapp: {\r\n\t\ttitle: pkg.name + \" [Test mode]\"\r\n\t},\r\n\t\r\n\ttest: true,\r\n\r\n\tdb: {\r\n\t\turi: process.env.MONGO_URI || \"mongodb://localhost/\" + pkg.config.dbName + \"-test\",\r\n\t\toptions: {\r\n\t\t\tuser: \"\",\r\n\t\t\tpass: \"\"\r\n\t\t}\r\n\t}\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./server/config/test.js\n **/","module.exports = require(\"../package.json\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"../package.json\"\n ** module id = 4\n ** module chunks = 0\n **/","\"use strict\";\r\n\r\nlet pkg = require(\"../../package.json\");\r\n\r\nmodule.exports = {\r\n\tapp: {},\r\n\t\r\n\tip: process.env.SERVER_IP || \"127.0.0.1\",\r\n\r\n\tdb: {\r\n\t\turi: process.env.MONGO_URI || \"mongodb://localhost/\" + pkg.config.dbName,\r\n\t\toptions: {\r\n\t\t\tuser: \"\",\r\n\t\t\tpass: \"\"\r\n\t\t}\r\n\t}\r\n\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./server/config/prod.js\n **/","\"use strict\";\r\n\r\nlet path = require(\"path\");\r\nlet pkg = require(\"../../package.json\");\r\nlet secrets = require(\"../core/secrets\");\r\n\r\nlet rootPath = path.normalize(path.join(__dirname, \"..\", \"..\"));\r\n\r\nif (WEBPACK_BUNDLE) {\r\n\tlet bundleFullPath = process.argv[1];\r\n\trootPath = path.normalize(path.join(path.dirname(bundleFullPath), \"..\"));\r\n}\r\n\r\nmodule.exports = {\r\n\tapp: {\r\n\t\ttitle: pkg.title,\r\n\t\tversion: pkg.version,\r\n\t\tdescription: pkg.description,\r\n\t\tkeywords: pkg.keywords.join(\",\"),\r\n\t\turl: \"http://localhost:\" + (process.env.PORT || 3000) + \"/\",\r\n\t\t//googleAnalyticsID: 'UA-xxxxx-x',\r\n\t\tcontactEmail: \"hello@boilerplate-app.com\"\r\n\t},\r\n\r\n\tip: \"0.0.0.0\",\r\n\tport: process.env.PORT || 3000,\r\n\trootPath: rootPath,\r\n\tdataFolder: path.join(rootPath, \"data\"),\r\n\tuploadLimit: 2 * 1024 * 1024, // 2MB\r\n\r\n\tsessions: {\r\n\t\tcookie: {\r\n\t\t\t// session expiration is set by default to one week\r\n\t\t\tmaxAge: 7 * 24 * (60 * 60 * 1000),\r\n\r\n\t\t\t// httpOnly flag makes sure the cookie is only accessed\r\n\t\t\t// through the HTTP protocol and not JS/browser\r\n\t\t\thttpOnly: true,\r\n\r\n\t\t\t// secure cookie should be turned to true to provide additional\r\n\t\t\t// layer of security so that the cookie is set only when working\r\n\t\t\t// in HTTPS mode.\r\n\t\t\tsecure: false\r\n\t\t},\r\n\r\n\t\t// Cookie key name\r\n\t\tname: \"sessionId\",\r\n\r\n\t\t// Mongo store collection name\r\n\t\tcollection: \"sessions\"\r\n\t},\r\n\r\n\ttest: false,\r\n\r\n\tmailer: {\r\n\t\tfrom: \"noreply@bolierplate-app.com\",\r\n\r\n\t\ttransport: \"smtp\",\r\n\t\tsmtp: {\r\n\t\t\thost: \"mailtrap.io\",\r\n\t\t\tport: 2525,\r\n\t\t\tauth: {\r\n\t\t\t\tuser: \"367335eaa82697636\",\r\n\t\t\t\tpass: \"e5a76af9b056d0\"\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/*transport: \"smtp\",\r\n\t\tsmtp: {\r\n\t\t\thost: \"smtp.gmail.com\",\r\n\t\t\tport: 465,\r\n\t\t\tsecure: true,\r\n\t\t\tauth: {\r\n\t\t\t\tuser: \"\",\r\n\t\t\t\tpass: \"\"\r\n\t\t\t}\r\n\t\t}*/\r\n\r\n\t\t/*\r\n\t\ttransport: \"mailgun\",\r\n\t\tmailgun: {\r\n\t\t\tapiKey: '',\r\n\t\t\tdomain: ''\r\n\t\t}*/\r\n\r\n\t\t/*\r\n\t\ttransport: \"sendgrid\",\r\n\t\tsendgrid: {\r\n\t\t\tapiKey: \"\"\r\n\t\t}*/\r\n\t},\r\n\r\n\tdb: {\r\n\t\turi: process.env.MONGO_URI || \"mongodb://localhost/\" + pkg.config.dbName + \"-dev\",\r\n\t\toptions: {\r\n\t\t\tuser: \"\",\r\n\t\t\tpass: \"\",\r\n\t\t\tserver: {\r\n\t\t\t\tsocketOptions: {\r\n\t\t\t\t\tkeepAlive: 1\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tlogging: {\r\n\r\n\t\tgraylog: {\r\n\t\t\tenabled: true,\r\n\t\t\tservers: [ { host: \"192.168.0.174\", port: 12201 } ]\r\n\t\t},\r\n\r\n\t\tpapertrail: {\r\n\t\t\tenabled: secrets.papertrail != null,\r\n\t\t\thost: secrets.papertrail != null ? secrets.papertrail.host : null,\r\n\t\t\tport: secrets.papertrail != null ? secrets.papertrail.port : null,\r\n\t\t\tlevel: 'debug',\r\n\t\t\tprogram: 'vem'\r\n\t\t},\r\n\r\n\t\tlogentries: {\r\n\t\t\tenabled: secrets.logentries != null,\r\n\t\t\ttoken: secrets.logentries != null ? secrets.logentries.token : null\r\n\t\t},\r\n\r\n\t\tloggly: {\r\n\t\t\tenabled: secrets.loggly != null,\r\n\t\t\ttoken: secrets.loggly != null ? secrets.loggly.token : null,\r\n\t\t\tsubdomain: secrets.loggly != null ? secrets.loggly.subdomain : null\r\n\t\t},\r\n\t\t\r\n\t\tlogsene: {\r\n\t\t\tenabled: secrets.logsene != null,\r\n\t\t\ttoken: secrets.logsene != null ? secrets.logsene.token : null\r\n\t\t},\r\n\t\t\r\n\t\tlogzio: {\r\n\t\t\tenabled: secrets.logzio != null,\r\n\t\t\ttoken: secrets.logzio != null ? secrets.logzio.token : null\r\n\t\t},\r\n\t\t\r\n\t},\r\n\r\n\tdisableSignUp: false,\r\n\tverificationRequired: true,\r\n\r\n\tagendaTimer: \"one minute\"\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./server/config/default.js\n **/","module.exports = require(\"path\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"path\"\n ** module id = 7\n ** module chunks = 0\n **/","\"use strict\";\r\n\r\nlet chalk \t\t\t= require(\"chalk\");\r\nlet fs\t\t\t\t= require(\"fs\");\r\nlet path\t\t\t= require(\"path\");\r\nlet secretUtils\t\t= require(\"secret-utils\");\r\n\r\nlet fName = path.join(__dirname, \"..\", \"..\", \"secrets.json\");\r\nif (!fs.existsSync(fName)) {\r\n\r\n\tlet json = {\r\n\t\thashSecret: secretUtils.url64(32),\r\n\t\tsessionSecret: secretUtils.url64(32)\r\n\t};\r\n\tfs.writeFileSync(fName, JSON.stringify(json, null, 2));\r\n\t\r\n\tconsole.warn(chalk.green.bold(\"Secret file created!\"));\r\n}\r\n\r\nmodule.exports = JSON.parse(fs.readFileSync(fName));\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./server/core/secrets.js\n **/","module.exports = require(\"chalk\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"chalk\"\n ** module id = 9\n ** module chunks = 0\n **/","module.exports = require(\"fs\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"fs\"\n ** module id = 10\n ** module chunks = 0\n **/","module.exports = require(\"secret-utils\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"secret-utils\"\n ** module id = 11\n ** module chunks = 0\n **/","\"use strict\";\r\n\r\nlet winston = require(\"winston\");\r\nlet path = require(\"path\");\r\nlet fs = require(\"fs\");\r\n\r\nlet config = require(\"../config\");\r\nlet secrets = require(\"./secrets\");\r\n\r\n// Create logs directory\r\nlet logDir = path.join(config.rootPath, \"logs\");\r\nif (!fs.existsSync(logDir)) {\r\n\tfs.mkdir(logDir, (err) => {\r\n\t\tif (err)\r\n\t\t\tthrow err;\r\n\t});\r\n}\r\n\r\nlet\ttransports = [\r\n\tnew winston.transports.Console({\r\n\t\tlevel: \"debug\",\r\n\t\tcolorize: true,\r\n\t\tprettyPrint: true,\r\n\t\thandleExceptions: process.env.NODE_ENV === \"production\"\r\n\t})\r\n];\r\n\r\nif (config.logging.logentries.enabled && config.logging.logentries.token) {\r\n\tconsole.log(\"Logentries log transport enabled!\");\r\n\tlet Logentries = require('le_node');\r\n\ttransports.push(new winston.transports.Logentries({\r\n\t\tlevel: \"debug\",\r\n\t\ttoken: config.logging.logentries.token\r\n\t}));\r\n}\r\n\r\nif (config.logging.papertrail.enabled) {\r\n\tconsole.log(\"Papertrail log transport enabled!\");\r\n\trequire(\"winston-papertrail\").Papertrail;\r\n\r\n\tlet ptTransport = new winston.transports.Papertrail(config.logging.papertrail);\r\n\r\n\t/*ptTransport.on(\"error\", function(err) {\r\n\t\tconsole.error(err);\r\n\t});\r\n\r\n\tptTransport.on(\"connect\", function(msg) {\r\n\t\tconsole.warn(msg);\r\n\t});\r\n\t*/\r\n\r\n\ttransports.push(ptTransport);\r\n}\r\n\r\nif (process.env.NODE_ENV === \"production\") {\r\n\ttransports.push(\r\n\t\tnew (require(\"winston-daily-rotate-file\"))({\r\n\t\t\tfilename: path.join(logDir, \"server.log\"),\r\n\t\t\tlevel: \"info\",\r\n\t\t\ttimestamp: true,\r\n\t\t\tjson: true,\r\n\t\t\thandleExceptions: true\r\n\t\t}), new winston.transports.File({\r\n\t\t\tfilename: path.join(logDir, \"exceptions.log\"),\r\n\t\t\tlevel: \"error\",\r\n\t\t\ttimestamp: true,\r\n\t\t\tjson: false,\r\n\t\t\tprettyPrint: true,\r\n\t\t\thandleExceptions: true,\r\n\t\t\thumanReadableUnhandledException: true\r\n\t\t})\r\n\t);\t\r\n}\r\n\r\nlet logger = new winston.Logger({\r\n\tlevel: \"debug\",\r\n\ttransports: transports,\r\n\texitOnError: false\r\n});\r\n\r\nif (config.logging.loggly.enabled && config.logging.loggly.token) {\r\n\tconsole.log(\"Loggly log transport enabled!\");\r\n\tlet loggly = require(\"winston-loggly-bulk\");\r\n\tlogger.add(winston.transports.Loggly, {\r\n\t\tinputToken: config.logging.loggly.token,\r\n\t\tsubdomain: config.logging.loggly.subdomain,\r\n\t\ttags: [\"vem-server\"],\r\n\t\tjson:true\r\n\t});\r\n}\r\n\r\nif (config.logging.logsene.enabled && config.logging.logsene.token) {\r\n\tconsole.log(\"Logsene log transport enabled!\");\r\n\tlet logsene = require('winston-logsene');\r\n\tlogger.add(logsene, {\r\n\t\ttype: \"vem-server\",\r\n\t\ttoken: config.logging.logsene.token\r\n\t});\r\n}\r\n\r\nif (config.logging.logzio.enabled && config.logging.logzio.token) {\r\n\tconsole.log(\"Logz.io log transport enabled!\");\r\n\tlet logzio = require('winston-logzio');\r\n\tlogger.add(logzio, {\r\n\t\ttoken: config.logging.logzio.token\r\n\t});\r\n}\r\n\r\nif (config.logging.graylog.enabled) {\r\n\tconsole.log(\"Graylog log transport enabled! Servers: \" + JSON.stringify(config.logging.graylog.servers));\r\n\tlet graylog = require(\"winston-graylog2\");\r\n\tlogger.add(graylog, {\r\n\t\tname: \"Graylog\",\r\n\t\tlevel: 'debug',\r\n\t\tgraylog: {\r\n\t\t\tservers: config.logging.graylog.servers,\r\n\t\t\tfacility: \"vem\"\r\n\t\t}\r\n\t});\r\n}\r\n\r\n\r\nmodule.exports = logger;\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./server/core/logger.js\n **/","module.exports = require(\"winston\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"winston\"\n ** module id = 13\n ** module chunks = 0\n **/","module.exports = require(\"le_node\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"le_node\"\n ** module id = 14\n ** module chunks = 0\n **/","module.exports = require(\"winston-papertrail\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"winston-papertrail\"\n ** module id = 15\n ** module chunks = 0\n **/","module.exports = require(\"winston-daily-rotate-file\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"winston-daily-rotate-file\"\n ** module id = 16\n ** module chunks = 0\n **/","module.exports = require(\"winston-loggly-bulk\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"winston-loggly-bulk\"\n ** module id = 17\n ** module chunks = 0\n **/","module.exports = require(\"winston-logsene\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"winston-logsene\"\n ** module id = 18\n ** module chunks = 0\n **/","module.exports = require(\"winston-logzio\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"winston-logzio\"\n ** module id = 19\n ** module chunks = 0\n **/","module.exports = require(\"winston-graylog2\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"winston-graylog2\"\n ** module id = 20\n ** module chunks = 0\n **/","module.exports = require(\"moment\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"moment\"\n ** module id = 21\n ** module chunks = 0\n **/","\"use strict\";\r\n\r\nlet logger \t= require(\"../core/logger\");\r\nlet config\t= require(\"../config\");\r\nlet fs\t\t= require(\"fs\");\r\n\r\n// Create data folder if not exist\r\nif (!fs.existsSync(config.dataFolder)) {\r\n\tfs.mkdir(config.dataFolder, (err) => {\r\n\t\tif (err)\r\n\t\t\tthrow err;\r\n\t});\r\n}\r\n\r\n// Show config in dev mode\r\nif (config.isDevMode()) {\r\n\tlogger.info(\"Loaded configuration:\");\r\n\tlogger.info(config);\r\n\tlogger.info();\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./server/core/init.js\n **/","\"use strict\";\r\n\r\nlet logger \t\t\t= require(\"./logger\");\r\nlet config \t\t\t= require(\"../config\");\r\n\r\nlet chalk \t\t\t= require(\"chalk\");\r\nlet mongoose \t\t= require(\"mongoose\");\r\nlet autoIncrement \t= require(\"mongoose-auto-increment\");\r\n\r\nmodule.exports = function() {\r\n\tlet db;\r\n\r\n\tlogger.info();\r\n\r\n\tmongoose.Promise = global.Promise;\r\n\r\n\tif (mongoose.connection.readyState !== 1) {\r\n\t\tlogger.info(\"Connecting to Mongo \" + config.db.uri + \"...\");\r\n\t\tdb = mongoose.connect(config.db.uri, config.db.options, function mongoAfterConnect(err) {\r\n\t\t\tif (err) {\r\n\t\t\t\tlogger.error(\"Could not connect to MongoDB!\");\r\n\t\t\t\treturn logger.error(err);\r\n\t\t\t}\r\n\t\t\r\n\t\t\tmongoose.set(\"debug\", config.isDevMode());\r\n\t\t});\r\n\r\n\t\tmongoose.connection.on(\"error\", function mongoConnectionError(err) {\r\n\t\t\tlogger.error(\"Could not connect to MongoDB!\");\r\n\t\t\treturn logger.error(err);\r\n\t\t});\r\n\r\n\t\tautoIncrement.initialize(db);\t\t\r\n\r\n\t\tmongoose.connection.once(\"open\", function mongoAfterOpen() {\r\n\t\t\tlogger.info(chalk.yellow.bold(\"Mongo DB connected.\"));\r\n\t\t\tlogger.info();\r\n\r\n\t\t\tif (config.isTestMode()) {\r\n\t\t\t\tlogger.warn(\"Drop test database...\");\r\n\t\t\t\tmongoose.connection.db.dropDatabase();\r\n\t\t\t\t//autoIncrement.initialize(db);\t\t\r\n\t\t\t}\r\n\r\n\r\n\t\t\tif (!config.isProduction) {\r\n\t\t\t\trequire(\"./seed-db\")();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t\r\n\t} else {\r\n\t\tlogger.info(\"Mongo already connected.\");\r\n\t\tdb = mongoose;\r\n\t}\r\n\t\r\n\treturn db;\r\n};\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./server/core/mongo.js\n **/","module.exports = require(\"mongoose\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"mongoose\"\n ** module id = 24\n ** module chunks = 0\n **/","module.exports = require(\"mongoose-auto-increment\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"mongoose-auto-increment\"\n ** module id = 25\n ** module chunks = 0\n **/","\"use strict\";\r\n\r\nlet logger \t\t\t= require(\"./logger\");\r\nlet config \t\t\t= require(\"../config\");\r\n\r\nlet _ \t\t\t\t= require(\"lodash\");\r\nlet tokgen \t\t\t= require(\"../libs/tokgen\");\r\nlet fakerator\t\t= require(\"fakerator\")();\r\n\r\nlet User \t\t\t= require(\"../models/user\");\r\n\r\nmodule.exports = function() {\r\n\tUser.find({}).exec(function(err, docs) {\r\n\t\tlet admin, test;\r\n\t\tif (docs.length === 0) {\r\n\t\t\tlogger.warn(\"Load default Users to DB...\");\r\n\r\n\t\t\tlet admin = new User({\r\n\t\t\t\tfullName: \"Administrator\",\r\n\t\t\t\temail: \"admin@boilerplate-app.com\",\r\n\t\t\t\tusername: \"admin\",\r\n\t\t\t\tpassword: \"admin1234\",\r\n\t\t\t\tprovider: \"local\",\r\n\t\t\t\troles: [\"admin\", \"user\"],\r\n\t\t\t\tverified: true\r\n\t\t\t});\r\n\r\n\t\t\tadmin.save(function(err) {\r\n\t\t\t\tif (err) \r\n\t\t\t\t\treturn logger.warn(\"Unable to create default admin user!\");\r\n\r\n\t\t\t\tlet test = new User({\r\n\t\t\t\t\tfullName: \"Test User\",\r\n\t\t\t\t\temail: \"test@boilerplate-app.com\",\r\n\t\t\t\t\tusername: \"test\",\r\n\t\t\t\t\tpassword: \"test1234\",\r\n\t\t\t\t\tprovider: \"local\",\r\n\t\t\t\t\troles: [\"user\"],\r\n\t\t\t\t\tverified: true,\r\n\t\t\t\t\tapiKey: tokgen()\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\ttest.save(function() {\r\n\t\t\t\t\tif (err) \r\n\t\t\t\t\t\treturn logger.warn(\"Unable to create default admin user!\");\r\n\t\t\t\t\t\r\n\t\t\t\t\tlogger.info(\"Default users created!\");\r\n\t\t\t\t});\r\n\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n\trequire(\"../applogic/libs/seed-db\")();\r\n};\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./server/core/seed-db.js\n **/","\"use strict\";\r\n\r\nlet TokenGenerator = require(\"uuid-token-generator\");\r\nlet tokgen = new TokenGenerator(256, TokenGenerator.BASE62);\r\n\r\nmodule.exports = function() {\r\n\treturn tokgen.generate();\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./server/libs/tokgen.js\n **/","module.exports = require(\"uuid-token-generator\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"uuid-token-generator\"\n ** module id = 28\n ** module chunks = 0\n **/","module.exports = require(\"fakerator\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"fakerator\"\n ** module id = 29\n ** module chunks = 0\n **/","\"use strict\";\r\n\r\nlet config    \t\t= require(\"../config\");\r\nlet logger    \t\t= require(\"../core/logger\");\r\nlet C \t\t\t\t= require(\"../core/constants\");\r\nlet fs \t\t\t\t= require(\"fs\");\r\nlet path \t\t\t= require(\"path\");\r\n\r\nlet _ \t\t\t\t= require(\"lodash\");\r\nlet crypto \t\t\t= require(\"crypto\");\r\nlet bcrypt \t\t\t= require(\"bcrypt-nodejs\");\r\n\r\nlet db\t    \t\t= require(\"../core/mongo\");\r\nlet mongoose \t\t= require(\"mongoose\");\r\nlet Schema \t\t\t= mongoose.Schema;\r\nlet hashids \t\t= require(\"../libs/hashids\")(\"users\");\r\nlet autoIncrement \t= require(\"mongoose-auto-increment\");\r\n\r\nlet schemaOptions = {\r\n\ttimestamps: true,\r\n\ttoObject: {\r\n\t\tvirtuals: true\r\n\t},\r\n\ttoJSON: {\r\n\t\tvirtuals: true\r\n\t}\r\n};\r\n\r\nlet validateLocalStrategyProperty = function(property) {\r\n\treturn (this.provider !== \"local\" && !this.updated) || property.length;\r\n};\r\n\r\nlet validateLocalStrategyPassword = function(password) {\r\n\treturn this.provider !== \"local\" || (password && password.length >= 6);\r\n};\r\n\r\nlet UserSchema = new Schema({\r\n\tfullName: {\r\n\t\ttype: String,\r\n\t\ttrim: true,\r\n\t\t\"default\": \"\",\r\n\t\tvalidate: [validateLocalStrategyProperty, \"Please fill in your full name\"]\r\n\t},\r\n\temail: {\r\n\t\ttype: String,\r\n\t\ttrim: true,\r\n\t\tunique: true,\r\n\t\tindex: true,\r\n\t\tlowercase: true,\r\n\t\t\"default\": \"\",\r\n\t\tvalidate: [validateLocalStrategyProperty, \"Please fill in your email\"],\r\n\t\tmatch: [/.+\\@.+\\..+/, \"Please fill a valid email address\"]\r\n\t},\r\n\tusername: {\r\n\t\ttype: String,\r\n\t\tunique: true,\r\n\t\tindex: true,\r\n\t\trequired: \"Please fill in a username\",\r\n\t\ttrim: true\r\n\t},\r\n\tpassword: {\r\n\t\ttype: String,\r\n\t\t\"default\": \"\",\r\n\t\tvalidate: [validateLocalStrategyPassword, \"Password should be longer\"]\r\n\t},\r\n\tpasswordLess: {\r\n\t\ttype: Boolean,\r\n\t\tdefault: false\r\n\t},\r\n\tpasswordLessToken: {\r\n\t\ttype: String\r\n\t},\r\n\tprovider: {\r\n\t\ttype: String,\r\n\t\t\"default\": \"local\"\r\n\t},\r\n\tprofile: {},\r\n\tsocialLinks: {\r\n\t\tfacebook: { type: String, unique: true, sparse: true },\r\n\t\ttwitter: { type: String, unique: true, sparse: true },\r\n\t\tgoogle: { type: String, unique: true, sparse: true },\r\n\t\tgithub: { type: String, unique: true, sparse: true }\r\n\t},\r\n\troles: {\r\n\t\ttype: [\r\n\t\t\t{\r\n\t\t\t\ttype: String,\r\n\t\t\t\t\"enum\": [\r\n\t\t\t\t\tC.ROLE_ADMIN,\r\n\t\t\t\t\tC.ROLE_USER,\r\n\t\t\t\t\tC.ROLE_GUEST\r\n\t\t\t\t]\r\n\t\t\t}\r\n\t\t],\r\n\t\t\"default\": [C.ROLE_USER]\r\n\t},\r\n\tresetPasswordToken: String,\r\n\tresetPasswordExpires: Date,\r\n\t\r\n\tverified: { \r\n\t\ttype: Boolean, \r\n\t\tdefault: false \r\n\t},\r\n\r\n\tverifyToken: { \r\n\t\ttype: String \r\n\t},\r\n\r\n\tapiKey: {\r\n\t\ttype: String,\r\n\t\tunique: true,\r\n\t\tindex: true,\r\n\t\tsparse: true\r\n\t},\r\n\r\n\tlastLogin: {\r\n\t\ttype: Date\r\n\t},\r\n\t\r\n\tmetadata: {}\r\n\r\n}, schemaOptions);\r\n\r\nUserSchema.virtual(\"code\").get(function() {\r\n\treturn this.encodeID();\r\n});\r\n\r\nUserSchema.plugin(autoIncrement.plugin, {\r\n\tmodel: \"User\",\r\n\tstartAt: 1\r\n});\r\n\r\nUserSchema.pre(\"save\", function(next) {\r\n\tlet user = this;\r\n\tif (!user.isModified(\"password\")) \r\n\t\treturn next();\r\n\t\r\n\tbcrypt.genSalt(10, function(err, salt) {\r\n\t\tbcrypt.hash(user.password, salt, null, function(err, hash) {\r\n\t\t\tuser.password = hash;\r\n\t\t\tnext();\r\n\t\t});\r\n\t});\r\n});\r\n\r\nUserSchema.methods.comparePassword = function(password, cb) {\r\n\tbcrypt.compare(password, this.password, function(err, isMatch) {\r\n\t\tcb(err, isMatch);\r\n\t});\r\n};\r\n\r\nUserSchema.virtual(\"gravatar\").get(function() {\r\n\tif (!this.email) {\r\n\t\treturn \"https://gravatar.com/avatar/?s=64&d=wavatar\";\r\n\t}\r\n\tlet md5 = crypto.createHash(\"md5\").update(this.email).digest(\"hex\");\r\n\treturn \"https://gravatar.com/avatar/\" + md5 + \"?s=64&d=wavatar\";\r\n});\r\n\r\nUserSchema.methods.encodeID = function() {\r\n\treturn hashids.encodeHex(this._id);\r\n}\r\n\r\nUserSchema.methods.decodeID = function(code) {\r\n\treturn hashids.decodeHex(code);\r\n}\r\n\r\nUserSchema.methods.pick = function(props, model) {\r\n\treturn _.pick(model || this.toJSON(), props || [\r\n\t\t\"code\",\r\n\t\t\"fullName\",\r\n\t\t\"email\",\r\n\t\t\"username\",\r\n\t\t\"roles\",\r\n\t\t\"lastLogin\",\r\n\t\t\"gravatar\"\r\n\t]);\t\r\n}\r\n\r\n/*\r\nUserSchema.methods.gravatar = function (size, defaults) {\r\n\tif (!size)\r\n\t\tsize = 200;\r\n\r\n\tif (!defaults)\r\n\t\tdefaults = 'wavatar';\r\n\r\n\tif (!this.email)\r\n\t\treturn `https://gravatar.com/avatar/?s=${size}&d=${defaults}`;\r\n\r\n\tlet md5 = crypto.createHash('md5').update(this.email).digest(\"hex\");\r\n\treturn `https://gravatar.com/avatar/${md5}?s=${size}&d=${defaults}`;\r\n};*/\r\n\r\nlet User = mongoose.model(\"User\", UserSchema);\r\n\r\nmodule.exports = User;\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./server/models/user.js\n **/","\"use strict\";\r\n\r\nmodule.exports = {\r\n\r\n\t/**\r\n\t * User role constants\r\n\t */\r\n\tROLE_ADMIN \t\t: \"admin\",\r\n\tROLE_USER \t\t: \"user\",\r\n\tROLE_GUEST \t\t: \"guest\"\r\n\r\n\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./server/core/constants.js\n **/","module.exports = require(\"crypto\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"crypto\"\n ** module id = 32\n ** module chunks = 0\n **/","module.exports = require(\"bcrypt-nodejs\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"bcrypt-nodejs\"\n ** module id = 33\n ** module chunks = 0\n **/","\"use strict\";\r\n\r\nlet Hashids = require(\"hashids\");\r\nlet secrets = require(\"../core/secrets\");\r\n\r\nmodule.exports = function(module, length) {\r\n\treturn new Hashids(module + secrets.hashSecret, length || 10);\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./server/libs/hashids.js\n **/","module.exports = require(\"hashids\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"hashids\"\n ** module id = 35\n ** module chunks = 0\n **/","\"use strict\";\r\n\r\n// let ROOT \t\t\t= \"../../\";\r\nlet logger \t\t\t= require(\"../../core/logger\");\r\nlet config \t\t\t= require(\"../../config\");\r\n\r\nlet _ \t\t\t\t= require(\"lodash\");\r\nlet tokgen \t\t\t= require(\"../../libs/tokgen\");\r\nlet fakerator\t\t= require(\"fakerator\")();\r\n\r\nlet User \t\t\t= require(\"../.././models/user\");\r\nlet Device \t\t\t= require(\"../modules/devices/models/device\");\r\nlet Post \t\t\t= require(\"../modules/posts/models/post\");\r\n\r\nmodule.exports = function() {\r\n\tDevice.find({}).exec(function(err, docs) {\r\n\t\tif (docs.length === 0) {\r\n\t\t\tlogger.warn(\"Load default Devices to DB...\");\r\n\r\n\t\t\t_.times(5, () => {\r\n\r\n\t\t\t\tlet device = new Device({\r\n\t\t\t\t\taddress: fakerator.internet.ip(),\r\n\t\t\t\t\ttype: fakerator.random.arrayElement([\"rasperry\", \"odroid\", \"nanopi\", \"pc\"]),\r\n\t\t\t\t\tname: fakerator.populate(\"#{names.firstName}'s device\"),\r\n\t\t\t\t\tdescription: fakerator.lorem.sentence(),\r\n\t\t\t\t\tstatus: fakerator.random.boolean(\"80\") ? 1 : 0,\r\n\t\t\t\t\tlastCommunication: Date.now()\r\n\t\t\t\t});\r\n\r\n\t\t\t\tdevice.save(function(err) {\r\n\t\t\t\t\tif (err) \r\n\t\t\t\t\t\treturn logger.warn(\"Unable to create default devices!\", err);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n\tPost.find({}).exec(function(err, docs) {\r\n\t\tif (docs.length === 0) {\r\n\t\t\tlogger.warn(\"Load default Posts to DB...\");\r\n\r\n\t\t\tUser.find({}).lean().select(\"_id\").exec((err, users) => {\r\n\r\n\t\t\t\t_.times(10, () => {\r\n\r\n\t\t\t\t\tlet fakePost = fakerator.entity.post();\r\n\r\n\t\t\t\t\tlet post = new Post({\r\n\t\t\t\t\t\ttitle: fakePost.title,\r\n\t\t\t\t\t\tcontent: fakePost.content,\r\n\t\t\t\t\t\tauthor: fakerator.random.arrayElement(users)._id\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tpost.save(function(err) {\r\n\t\t\t\t\t\tif (err) \r\n\t\t\t\t\t\t\treturn logger.warn(\"Unable to create default posts!\", err);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\r\n\t\t\t});\r\n\r\n\t\t}\r\n\t});\r\n\r\n};\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./server/applogic/libs/seed-db.js\n **/","\"use strict\";\r\n\r\n// let ROOT \t\t\t= \"../../../../\";\r\nlet config    \t\t= require(\"../../../../config\");\r\nlet logger    \t\t= require(\"../../../../core/logger\");\r\n\r\nlet db\t    \t\t= require(\"../../../../core/mongo\");\r\nlet mongoose \t\t= require(\"mongoose\");\r\nlet Schema \t\t\t= mongoose.Schema;\r\nlet hashids \t\t= require(\"../../../../libs/hashids\")(\"devices\");\r\nlet autoIncrement \t= require(\"mongoose-auto-increment\");\r\n\r\nlet schemaOptions = {\r\n\ttimestamps: true,\r\n\ttoObject: {\r\n\t\tvirtuals: true\r\n\t},\r\n\ttoJSON: {\r\n\t\tvirtuals: true\r\n\t}\r\n};\r\n\r\nlet DeviceSchema = new Schema({\r\n\taddress: {\r\n\t\ttype: String,\r\n\t\ttrim: true\r\n\t},\r\n\ttype: {\r\n\t\ttype: String,\r\n\t\ttrim: true\r\n\t},\r\n\tname: {\r\n\t\ttype: String,\r\n\t\ttrim: true\r\n\t},\r\n\tdescription: {\r\n\t\ttype: String,\r\n\t\ttrim: true,\r\n\t\t\"default\": \"\"\r\n\t},\r\n\tstatus: {\r\n\t\ttype: Number,\r\n\t\t\"default\": 1\r\n\t},\r\n\tlastCommunication: {\r\n\t\ttype: Date,\t\r\n\t\t\"default\": Date.now\r\n\t},\r\n\tmetadata: {}\r\n\r\n}, schemaOptions);\r\n\r\nDeviceSchema.virtual(\"code\").get(function() {\r\n\treturn this.encodeID();\r\n});\r\n\r\nDeviceSchema.plugin(autoIncrement.plugin, {\r\n\tmodel: \"Device\",\r\n\tstartAt: 1\r\n});\r\n\r\nDeviceSchema.methods.encodeID = function() {\r\n\treturn hashids.encodeHex(this._id);\r\n}\r\n\r\nDeviceSchema.methods.decodeID = function(code) {\r\n\treturn hashids.decodeHex(code);\r\n}\r\n\r\nlet Device = mongoose.model(\"Device\", DeviceSchema);\r\n\r\nmodule.exports = Device;\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./server/applogic/modules/devices/models/device.js\n **/","\"use strict\";\r\n\r\n// let ROOT \t\t\t= \"../../../../\";\r\nlet config    \t\t= require(\"../../../../config\");\r\nlet logger    \t\t= require(\"../../../../core/logger\");\r\n\r\nlet db\t    \t\t= require(\"../../../../core/mongo\");\r\nlet mongoose \t\t= require(\"mongoose\");\r\nlet Schema \t\t\t= mongoose.Schema;\r\nlet hashids \t\t= require(\"../../../../libs/hashids\")(\"posts\");\r\nlet autoIncrement \t= require(\"mongoose-auto-increment\");\r\n\r\nlet schemaOptions = {\r\n\ttimestamps: true,\r\n\ttoObject: {\r\n\t\tvirtuals: true\r\n\t},\r\n\ttoJSON: {\r\n\t\tvirtuals: true\r\n\t}\r\n};\r\n\r\nlet PostSchema = new Schema({\r\n\ttitle: {\r\n\t\ttype: String,\r\n\t\ttrim: true\r\n\t},\r\n\tcontent: {\r\n\t\ttype: String,\r\n\t\ttrim: true\r\n\t},\r\n\tauthor: {\r\n\t\ttype: Number,\r\n\t\trequired: \"Please fill in an author ID\",\r\n\t\tref: \"User\"\r\n\t},\r\n\tviews: {\r\n\t\ttype: Number,\r\n\t\tdefault: 0\r\n\t},\r\n\tupVoters: {\r\n\t\ttype: [Number]\r\n\t},\r\n\tdownVoters: {\r\n\t\ttype: [Number]\r\n\t},\r\n\tvotes: {\r\n\t\ttype: Number,\r\n\t\tdefault: 0\r\n\t},\r\n\tmetadata: {}\r\n\r\n}, schemaOptions);\r\n\r\nPostSchema.virtual(\"code\").get(function() {\r\n\treturn this.encodeID();\r\n});\r\n\r\nPostSchema.plugin(autoIncrement.plugin, {\r\n\tmodel: \"Post\",\r\n\tstartAt: 1\r\n});\r\n\r\nPostSchema.methods.encodeID = function() {\r\n\treturn hashids.encodeHex(this._id);\r\n}\r\n\r\nPostSchema.methods.decodeID = function(code) {\r\n\treturn hashids.decodeHex(code);\r\n}\r\n\r\nlet Post = mongoose.model(\"Post\", PostSchema);\r\n\r\nmodule.exports = Post;\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./server/applogic/modules/posts/models/post.js\n **/","\"use strict\";\r\n\r\nlet logger \t\t\t= require(\"./logger\");\r\nlet config \t\t\t= require(\"../config\");\r\nlet secrets \t\t= require(\"./secrets\");\r\n\r\nlet express \t\t= require(\"express\");\r\nlet http \t\t\t= require(\"http\");\r\nlet path \t\t\t= require(\"path\");\r\n\r\nlet moment \t\t\t= require(\"moment\");\r\nlet flash \t\t\t= require(\"express-flash\");\r\nlet favicon \t\t= require(\"serve-favicon\");\r\nlet morgan \t\t\t= require(\"morgan\");\r\nlet bodyParser \t\t= require(\"body-parser\");\r\nlet cookieParser\t= require(\"cookie-parser\");\r\nlet validator \t\t= require(\"express-validator\");\r\nlet csrf \t\t\t= require(\"csurf\");\r\nlet netjet\t\t\t= require(\"netjet\");\r\n\r\nlet session \t\t= require(\"express-session\");\r\nlet compress \t\t= require(\"compression\");\r\nlet methodOverride \t= require(\"method-override\");\r\nlet helmet \t\t\t= require(\"helmet\");\r\nlet crossdomain \t= require(\"helmet-crossdomain\");\r\nlet mongoose \t\t= require(\"mongoose\");\r\nlet MongoStore \t\t= require(\"connect-mongo\")(session);\r\n\r\nlet i18next \t\t= require(\"i18next\");\r\nlet i18nextExpress \t= require(\"i18next-express-middleware\");\r\nlet i18nextFs \t\t= require(\"i18next-node-fs-backend\");\r\n\r\nlet serverFolder = path.normalize(path.join(config.rootPath, \"server\"));\r\n\r\nfunction initLocalVariables(app) {\r\n\t// Setting application local variables\r\n\tapp.locals.app = config.app;\r\n\r\n\t// Passing the request url to environment locals\r\n\tapp.use(function(req, res, next) {\r\n\t\tres.locals.url = req.protocol + \"://\" + req.headers.host + req.url;\r\n\t\treturn next();\r\n\t});\r\n\r\n\tapp.locals.year = moment().format(\"YYYY\");\r\n\tapp.locals.disableSignUp = config.disableSignUp || false;\r\n}\r\n\r\nfunction initMiddleware(app) {\r\n\t// Should be placed before express.static\r\n\tapp.use(compress({\r\n\t\tfilter: function(req, res) {\r\n\t\t\treturn /json|text|javascript|css/.test(res.getHeader(\"Content-Type\"));\r\n\t\t},\r\n\t\tlevel: 3\r\n\t}));\r\n\r\n\t// Configure express app\r\n\tapp.set(\"port\", config.port);\r\n\r\n\t// Request body parsing middleware should be above methodOverride\r\n\tapp.use(bodyParser.urlencoded({\r\n\t\textended: true,\r\n\t\tlimit: config.contentMaxLength * 2\r\n\t}));\r\n\tapp.use(validator());\r\n\tapp.use(bodyParser.json());\t\r\n\tapp.use(methodOverride());\r\n\r\n\tif (config.isProductionMode()) {\r\n\r\n\t\t// HTTP/2 Server Push support\r\n\t\tapp.use(netjet({\r\n\t\t\tcache: {\r\n\t\t\t\tmax: 100\r\n\t\t\t}\r\n\t\t}));\r\n\r\n\t\t// Setting up static folder\r\n\t\tapp.use(express[\"static\"](path.join(serverFolder, \"public\")));\r\n\t}\r\n\r\n\t// Favicon\r\n\tapp.use(favicon(path.join(serverFolder, \"public\", \"favicon.ico\")));\r\n\r\n\t// Cookie parser should be above session\r\n\tapp.use(cookieParser());\r\n\r\n\tapp.set(\"etag\", true); // other values 'weak', 'strong'\r\n\r\n\tapp.use(flash());\t\r\n\r\n\tif (config.isDevMode()) {\r\n\t\t// Init morgan\r\n\t\tlet stream = require(\"stream\");\r\n\t\tlet lmStream = new stream.Stream();\r\n\r\n\t\tlmStream.writable = true;\r\n\t\tlmStream.write = function(data) {\r\n\t\t\treturn logger.debug(data);\r\n\t\t};\t\r\n\r\n\t\tapp.use(morgan(\"dev\", {\r\n\t\t\tstream: lmStream\r\n\t\t}));\r\n\r\n\t\t// app.use(require('express-status-monitor')());\r\n\t}\r\n}\r\n\r\nfunction initI18N(app) {\r\n\r\n\tlet conf = {\r\n\t\t//debug: true,\r\n\t\tfallbackLng: \"en\",\r\n\t\twhitelist: [\"en\", \"hu\"],\r\n\t\tns: [\"app\", \"frontend\"],\r\n\t\tdefaultNS: \"frontend\",\r\n\t\tload: \"all\",\r\n\t\tsaveMissing: true, //config.isDevMode(),\r\n\t\tsaveMissingTo: \"all\", // \"fallback\", \"current\", \"all\"\r\n\r\n\t\tbackend: {\r\n\t\t\t// path where resources get loaded from\r\n\t\t\tloadPath: path.join(serverFolder, \"locales\", \"{{lng}}\", \"{{ns}}.json\"),\r\n\r\n\t\t\t// path to post missing resources\r\n\t\t\taddPath: path.join(serverFolder, \"locales\", \"{{lng}}\", \"{{ns}}.missing.json\"),\r\n\r\n\t\t\t// jsonIndent to use when storing json files\r\n\t\t\tjsonIndent: 4\r\n\t\t}\r\n\t};\r\n\r\n\t// In test mode only English enabled!\r\n\tif (config.isTestMode()) {\r\n\t\tconf.whitelist = [\"en\"];\r\n\t}\r\n\r\n\ti18next\r\n\t\t.use(i18nextFs)\r\n\t\t.use(i18nextExpress.LanguageDetector)\r\n\t\t.init(conf, function(err, t) {\r\n\t\t\tif (err)\r\n\t\t\t\tlogger.warn(err);\r\n\t\t});\r\n\r\n\t/*i18next.on(\"languageChanged\", function(lng) {\r\n\t\tconsole.log(\"languageChanged\", lng);\r\n\t});\r\n\r\n\ti18next.on(\"loaded\", function(loaded) {\r\n\t\tconsole.log(\"loaded\", loaded);\r\n\t});\t*/\r\n\r\n\ti18next.on(\"failedLoading\", function(lng, ns, msg) {\r\n\t\tconsole.log(\"failedLoading\", lng, ns, msg);\r\n\t});\r\n\r\n\tapp.use(i18nextExpress.handle(i18next));\r\n\r\n\t// multiload backend route\r\n\tapp.get(\"/locales/resources.json\", i18nextExpress.getResourcesHandler(i18next));\t\r\n\r\n\t// missing keys\r\n\tapp.post(\"/locales/add/:lng/:ns\", i18nextExpress.missingKeyHandler(i18next));\t\t\r\n}\r\n\r\nfunction initViewEngine(app) {\r\n\t// Set view folder\r\n\tapp.set(\"views\", path.join(serverFolder, \"views\"));\r\n\tapp.set(\"view engine\", \"jade\");\r\n\r\n\t// Environment dependent middleware\r\n\tif (config.isDevMode()) {\r\n\t\tapp.set(\"showStackError\", true);\r\n\r\n\t\t// Disable views cache\r\n\t\tapp.set(\"view cache\", false);\r\n\t\tapp.use(helmet.noCache());\r\n\r\n\t\t// Jade options: Don't minify html, debug intrumentation\r\n\t\tapp.locals.pretty = true;\r\n\t\t//app.locals.compileDebug = true;\r\n\r\n\t} else {\r\n\t\tapp.locals.cache = \"memory\";\r\n\t\tapp.set(\"view cache\", true);\r\n\t}\r\n}\r\n\r\nfunction initSession(app, db) {\r\n\t// Express MongoDB session storage\r\n\tapp.use(session({\r\n\t\tsaveUninitialized: true,\r\n\t\tresave: true,\r\n\t\tsecret: secrets.sessionSecret,\r\n\t\tstore: new MongoStore({\r\n\t\t\tmongooseConnection: db.connection,\r\n\t\t\tcollection: config.sessions.collection,\r\n\t\t\tautoReconnect: true\r\n\t\t}),\r\n\t\tcookie: config.sessions.cookie,\r\n\t\tname: config.sessions.name\r\n\t}));\r\n}\r\n\r\nfunction initHelmetHeaders(app) {\r\n\t// Use helmet to secure Express headers\r\n\tapp.use(helmet.xssFilter());\r\n\tapp.use(helmet.noSniff());\r\n\tapp.use(helmet.ieNoOpen());\r\n\tapp.use(crossdomain());\r\n\tapp.use(helmet.hidePoweredBy());\r\n}\r\n\r\nfunction initAuth(app) {\r\n\t// Init auth\r\n\trequire(\"./auth/passport\")(app);\r\n\r\n\tif (!config.isTestMode()) {\r\n/*\r\n\t\t// Handle CSRF\r\n\t\tapp.use(csrf());\r\n\r\n\t\t// Keep user, csrf token and config available\r\n\t\tapp.use(function(req, res, next) {\r\n\t\t\tlet token = req.csrfToken();\r\n\t\t\tres.locals._csrf = token;\r\n\t\t\tres.cookie('XSRF-TOKEN', token);\r\n\r\n\t\t\treturn next();\r\n\t\t});*/\r\n\t}\r\n}\r\n\r\nfunction initWebpack(app) {\r\n\t// Webpack middleware in development mode\r\n\tif (!config.isProductionMode()) {\r\n\t\tlet webpack\t = require(\"webpack\");\r\n\t\tlet wpConfig = require(\"../../webpack.dev.config\");\r\n\r\n\t\tlet compiler = webpack(wpConfig);\r\n\t\tlet devMiddleware = require('webpack-dev-middleware'); // eslint-disable-line\r\n\t\tapp.use(devMiddleware(compiler, {\r\n\t\t\tnoInfo: true,\r\n\t\t\tpublicPath: wpConfig.output.publicPath,\r\n\t\t\theaders: { \"Access-Control-Allow-Origin\": \"*\" },\r\n\t\t\t//stats: 'errors-only'\r\n\t\t\tstats: {colors: true}\r\n\t\t}));\r\n\r\n\t\tlet hotMiddleware = require('webpack-hot-middleware'); // eslint-disable-line\r\n\t\tapp.use(hotMiddleware(compiler, {\r\n\t\t\tlog: logger.info\r\n\t\t}));\r\n\t}\r\n}\r\n\r\nmodule.exports = function(db) {\r\n\r\n\t// Create express app\r\n\tlet app = express();\r\n\r\n\t// Init local variables\r\n\tinitLocalVariables(app);\r\n\r\n\t// Init middlewares\r\n\tinitMiddleware(app);\r\n\r\n\t// Init view engine\r\n\tinitViewEngine(app);\r\n\r\n\t// Init Helmet security headers\r\n\tinitHelmetHeaders(app);\r\n\r\n\t// Init internationalization module\r\n\tinitI18N(app);\r\n\r\n\t// Init session handler\r\n\tinitSession(app, db);\r\n\r\n\t// Init auth and CSRF module\r\n\tinitAuth(app);\r\n\r\n\t// Init webpack devserver & hot reload module\r\n\tinitWebpack(app);\r\n\r\n\t// Load routes\r\n\trequire(\"../routes\")(app, db);\r\n\r\n\t// Load socket.io server\r\n\tlet server = require(\"./socket\").init(app, db);\r\n\tserver._app = app;\r\n\r\n\treturn server;\r\n};\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./server/core/express.js\n **/","module.exports = require(\"express\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"express\"\n ** module id = 40\n ** module chunks = 0\n **/","module.exports = require(\"http\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"http\"\n ** module id = 41\n ** module chunks = 0\n **/","module.exports = require(\"express-flash\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"express-flash\"\n ** module id = 42\n ** module chunks = 0\n **/","module.exports = require(\"serve-favicon\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"serve-favicon\"\n ** module id = 43\n ** module chunks = 0\n **/","module.exports = require(\"morgan\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"morgan\"\n ** module id = 44\n ** module chunks = 0\n **/","module.exports = require(\"body-parser\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"body-parser\"\n ** module id = 45\n ** module chunks = 0\n **/","module.exports = require(\"cookie-parser\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"cookie-parser\"\n ** module id = 46\n ** module chunks = 0\n **/","module.exports = require(\"express-validator\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"express-validator\"\n ** module id = 47\n ** module chunks = 0\n **/","module.exports = require(\"csurf\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"csurf\"\n ** module id = 48\n ** module chunks = 0\n **/","module.exports = require(\"netjet\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"netjet\"\n ** module id = 49\n ** module chunks = 0\n **/","module.exports = require(\"express-session\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"express-session\"\n ** module id = 50\n ** module chunks = 0\n **/","module.exports = require(\"compression\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"compression\"\n ** module id = 51\n ** module chunks = 0\n **/","module.exports = require(\"method-override\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"method-override\"\n ** module id = 52\n ** module chunks = 0\n **/","module.exports = require(\"helmet\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"helmet\"\n ** module id = 53\n ** module chunks = 0\n **/","module.exports = require(\"helmet-crossdomain\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"helmet-crossdomain\"\n ** module id = 54\n ** module chunks = 0\n **/","module.exports = require(\"connect-mongo\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"connect-mongo\"\n ** module id = 55\n ** module chunks = 0\n **/","module.exports = require(\"i18next\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"i18next\"\n ** module id = 56\n ** module chunks = 0\n **/","module.exports = require(\"i18next-express-middleware\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"i18next-express-middleware\"\n ** module id = 57\n ** module chunks = 0\n **/","module.exports = require(\"i18next-node-fs-backend\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"i18next-node-fs-backend\"\n ** module id = 58\n ** module chunks = 0\n **/","module.exports = require(\"stream\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"stream\"\n ** module id = 59\n ** module chunks = 0\n **/","\"use strict\";\r\n\r\nlet logger \t\t\t= require(\"../logger\");\r\nlet config \t\t\t= require(\"../../config\");\r\n\r\nlet passport \t\t= require(\"passport\");\r\nlet path \t\t\t= require(\"path\");\r\nlet chalk \t\t\t= require(\"chalk\");\r\n\r\nif (!WEBPACK_BUNDLE) require('require-webpack-compat')(module, require);\r\n\r\nlet User \t\t\t= require(\"../../models/user\");\r\n\r\nmodule.exports = function(app) {\r\n\r\n\t// Use passport session\r\n\tapp.use(passport.initialize());\r\n\tapp.use(passport.session());\t\r\n\r\n\tpassport.serializeUser(function(user, done) {\r\n\t\treturn done(null, user.id);\r\n\t});\r\n\r\n\tpassport.deserializeUser(function(id, done) {\r\n\t\tUser.findOne({\r\n\t\t\t_id: id\r\n\t\t}, \"-password\", function(err, user) {\r\n\t\t\treturn done(err, user);\r\n\t\t});\r\n\t});\r\n\r\n\tlogger.info(\"\");\r\n\tlogger.info(chalk.bold(\"Search passport strategies...\"));\r\n\r\n\tfunction requireAll(r) { \r\n\t\treturn r.keys().map(function(module) {\r\n\t\t\tlogger.info(\"  Loading passport strategy file \" + path.basename(module) + \"...\");\r\n\t\t\tlet strategy = r(module);\r\n\t\t\tstrategy();\r\n\r\n\t\t\treturn strategy;\r\n\t\t})\r\n\t}\r\n\tvar modules = requireAll(require.context(\"./strategies\", true, /\\.js$/));\r\n};\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./server/core/auth/passport.js\n **/","module.exports = require(\"passport\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"passport\"\n ** module id = 61\n ** module chunks = 0\n **/","var map = {\n\t\"./apikey.js\": 63,\n\t\"./facebook.js\": 65,\n\t\"./github.js\": 68,\n\t\"./google.js\": 70,\n\t\"./local.js\": 72,\n\t\"./twitter.js\": 74\n};\nfunction webpackContext(req) {\n\treturn __webpack_require__(webpackContextResolve(req));\n};\nfunction webpackContextResolve(req) {\n\treturn map[req] || (function() { throw new Error(\"Cannot find module '\" + req + \"'.\") }());\n};\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 62;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/core/auth/strategies \\.js$\n ** module id = 62\n ** module chunks = 0\n **/","\"use strict\";\r\n\r\nlet passport = require(\"passport\");\r\nlet LocalAPIKeyStrategy = require(\"passport-localapikey-update\").Strategy;\r\nlet User = require(\"../../../models/user\");\r\n\r\nmodule.exports = function() {\r\n\tpassport.use(new LocalAPIKeyStrategy({\r\n\t\tpassReqToCallback : true\r\n\t}, function(req, apiKey, done) {\r\n\t\treturn User.findOne({\r\n\t\t\t\"apiKey\": apiKey\r\n\t\t}, function(err, user) {\r\n\t\t\tif (err)\r\n\t\t\t\treturn done(err);\r\n\t\t\t\r\n\t\t\tif (!user)\r\n\t\t\t\treturn done(null, false, {\r\n\t\t\t\t\tmessage: req.t(\"UnknowAPIKey\")\r\n\t\t\t\t});\r\n\r\n\t\t\tif (!user.verified)\r\n\t\t\t\treturn done(null, false, {\r\n\t\t\t\t\tmessage: req.t(\"PleaseActivateAccount\")\r\n\t\t\t\t});\r\n\r\n\t\t\treturn done(null, user);\t\t\r\n\t\t});\r\n\t}));\r\n};\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./server/core/auth/strategies/apikey.js\n **/","module.exports = require(\"passport-localapikey-update\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"passport-localapikey-update\"\n ** module id = 64\n ** module chunks = 0\n **/","\"use strict\";\r\n\r\nlet logger \t= require(\"../../logger\");\r\nlet config \t= require(\"../../../config\");\r\nlet secrets = require(\"../../secrets\");\r\nlet helper \t= require(\"../helper\");\r\n\r\nlet passport \t\t\t= require(\"passport\");\r\nlet FacebookStrategy  \t= require(\"passport-facebook\").Strategy;\r\nlet User \t\t\t\t= require(\"../../../models/user\");\r\n\r\n// https://developers.facebook.com/apps/\r\nmodule.exports = function() {\r\n\tif (secrets.apiKeys && secrets.apiKeys.facebook && secrets.apiKeys.facebook.clientID) {\r\n\r\n\t\tpassport.use(\"facebook\", new FacebookStrategy({\r\n\t\t\tclientID: secrets.apiKeys.facebook.clientID,\r\n\t\t\tclientSecret: secrets.apiKeys.facebook.clientSecret,\r\n\t\t\tcallbackURL: \"/auth/facebook/callback\",\r\n\t\t\tprofileFields: [\"name\", \"email\", \"link\", \"locale\", \"timezone\"],\r\n\t\t\tpassReqToCallback: true\r\n\t\t}, function(req, accessToken, refreshToken, profile, done) {\r\n\t\t\t//logger.info(\"Received profile: \", profile);\r\n\t\t\t\r\n\t\t\thelper.linkToSocialAccount({\r\n\t\t\t\treq, \r\n\t\t\t\taccessToken,\r\n\t\t\t\trefreshToken,\r\n\t\t\t\tprofile,\r\n\t\t\t\tdone,\r\n\r\n\t\t\t\tprovider: \"facebook\",\r\n\t\t\t\temail: profile._json.email,\r\n\t\t\t\tuserData: {\r\n\t\t\t\t\tname: profile.name.givenName + \" \" + profile.name.familyName,\r\n\t\t\t\t\tgender: profile._json.gender,\r\n\t\t\t\t\tpicture: `https://graph.facebook.com/${profile.id}/picture?type=large`,\r\n\t\t\t\t\tlocation: (profile._json.location) ? profile._json.location.name : null\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t}));\r\n\r\n\t}\r\n};\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./server/core/auth/strategies/facebook.js\n **/","\"use strict\";\r\n\r\nlet logger = require(\"../logger\");\r\nlet config = require(\"../../config\");\r\nlet passport = require(\"passport\");\r\n\r\nlet User \t= require(\"../../models/user\");\r\n\r\n// TODO response \r\n\r\nmodule.exports.isAuthenticated = function isAuthenticated(req, res, next) {\r\n\tif (req.isAuthenticated())\r\n\t\treturn next();\r\n\telse {\r\n\t\treturn res.sendStatus(401);\r\n\t}\r\n};\r\n\r\nmodule.exports.isAuthenticatedOrApiKey = function isAuthenticated(req, res, next) {\r\n\tif (req.isAuthenticated())\r\n\t\treturn next();\r\n\telse {\r\n\t\t// Try authenticate with API KEY\r\n\t\tif (req.headers.apikey || req.query.apikey || req.body.apikey) {\r\n\t\t\tpassport.authenticate(\"localapikey\", (err, user, info) => {\r\n\t\t\t\tif (err) \r\n\t\t\t\t\treturn res.sendStatus(500);\r\n\r\n\t\t\t\tif (!user)\r\n\t\t\t\t\treturn res.status(401).send(info.message || \"\");\r\n\r\n\t\t\t\treq.login(user, function(err) {\r\n\t\t\t\t\tif (err) \r\n\t\t\t\t\t\treturn res.sendStatus(500);\r\n\r\n\t\t\t\t\treturn next();\r\n\t\t\t\t});\r\n\r\n\t\t\t})(req, res, next);\r\n\t\t}\r\n\t\telse\r\n\t\t\treturn res.sendStatus(401);\r\n\t}\r\n};\r\n\r\nmodule.exports.hasRole = function hasRole(roleRequired) {\r\n\tif (!roleRequired)\r\n\t\tthrow new Error(\"Required role needs to be set\");\r\n\r\n\treturn function(req, res, next) {\r\n\t\treturn module.exports.isAuthenticated(req, res, function() {\r\n\t\t\tif (req.user && req.user.roles && req.user.roles.indexOf(roleRequired) !== -1)\r\n\t\t\t\tnext();\r\n\t\t\telse\r\n\t\t\t\tres.sendStatus(403);\r\n\t\t});\r\n\t};\r\n};\r\n\r\nmodule.exports.hasAdminRole = function hasAdminRole() {\r\n\treturn module.exports.hasRole(\"admin\");\r\n};\r\n\r\nmodule.exports.linkToSocialAccount = function linkToSocialAccount(opts) {\r\n\r\n\tlet req = opts.req;\r\n\tlet accessToken = opts.accessToken;\r\n\tlet refreshToken = opts.refreshToken;\r\n\tlet profile = opts.profile;\r\n\tlet done = opts.done;\r\n\tlet provider = opts.provider;\r\n\tlet email = opts.email;\r\n\tlet userData = opts.userData;\r\n\r\n\tif (req.user) {\r\n\t\t// There is logged in user. We only assign with this social account\r\n\t\tlet search = {};\r\n\t\tsearch[`socialLinks.${provider}`] = profile.id;\r\n\t\tUser.findOne( search, function(err, existingUser) {\r\n\t\t\tif (existingUser) {\r\n\t\t\t\tif (existingUser._id != req.user._id) {\r\n\t\t\t\t\t// It's linked to an other account!\r\n\t\t\t\t\treq.flash(\"error\", { msg: req.t(\"SocialIDLinkedToOtherAccount\") });\r\n\t\t\t\t\treturn done(err);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t\t// Same user same account\r\n\t\t\t\t\treturn done(err, existingUser);\r\n\r\n\t\t\t} else {\r\n\t\t\t\t// Not found linked account. We create the link\r\n\t\t\t\tUser.findById(req.user.id, function(err, user) {\r\n\t\t\t\t\tuser.socialLinks = user.socialLinks || {};\r\n\t\t\t\t\tuser.socialLinks[provider] = profile.id;\r\n\r\n\t\t\t\t\tuser.profile = user.profile || {};\r\n\t\t\t\t\tuser.profile.name = user.profile.name || userData.name;\r\n\t\t\t\t\tuser.profile.gender = user.profile.gender || userData.gender;\r\n\t\t\t\t\tuser.profile.picture = user.profile.picture || userData.picture;\r\n\t\t\t\t\tuser.profile.location = user.profile.location || userData.location;\r\n\r\n\t\t\t\t\tuser.save(function(err) {\r\n\t\t\t\t\t\treq.flash(\"info\", { msg: req.t(\"AccountHasBeenLinked\") });\r\n\t\t\t\t\t\tdone(err, user);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t} else {\r\n\t\t\r\n\t\t// No logged in user\r\n\t\tlet search = {};\r\n\t\tsearch[`socialLinks.${provider}`] = profile.id;\r\n\t\tUser.findOne(search, function(err, existingUser) {\r\n\r\n\t\t\tif (existingUser) {\r\n\t\t\t\treturn done(err, existingUser);\r\n\t\t\t}\r\n\r\n\t\t\tif (!email) {\r\n\t\t\t\t// Not provided email address\r\n\t\t\t\treq.flash(\"error\", { msg: req.t(\"SocialMissingEmailAddress\")});\r\n\t\t\t\treturn done();\t\t\t\t\r\n\t\t\t}\r\n\r\n\t\t\t// If come back email address from social provider, search user by email\r\n\t\t\tUser.findOne({email: email}, function(err, existingEmailUser) {\r\n\t\t\t\tif (existingEmailUser) {\r\n\t\t\t\t\tlet user = existingEmailUser;\r\n\t\t\t\t\tuser.socialLinks = user.socialLinks || {};\r\n\t\t\t\t\tuser.socialLinks[provider] = profile.id;\r\n\r\n\t\t\t\t\tuser.profile = user.profile || {};\r\n\t\t\t\t\tuser.profile.name = user.profile.name || userData.name;\r\n\t\t\t\t\tuser.profile.gender = user.profile.gender || userData.gender;\r\n\t\t\t\t\tuser.profile.picture = user.profile.picture || userData.picture;\r\n\t\t\t\t\tuser.profile.location = user.profile.location || userData.location;\r\n\r\n\t\t\t\t\tuser.save(function(err) {\r\n\t\t\t\t\t\treq.flash(\"info\", { msg: req.t(\"AccountHasBeenLinked\") });\r\n\t\t\t\t\t\tdone(err, user);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (config.disableSignUp === true) {\r\n\t\t\t\t\treq.flash(\"error\", { msg: req.t(\"SignUpDisabledPleaseLogin\") });\r\n\t\t\t\t\treturn done();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Create a new user by social profile\r\n\t\t\t\tlet user = new User();\r\n\t\t\t\tuser.fullName = userData.name;\r\n\t\t\t\tuser.email = email;\r\n\t\t\t\tuser.username = email;\r\n\t\t\t\tuser.provider = provider;\r\n\t\t\t\tuser.verified = true;\r\n\t\t\t\tuser.passwordLess = true;\r\n\r\n\t\t\t\tuser.socialLinks = {};\r\n\t\t\t\tuser.socialLinks[provider] = profile.id;\r\n\r\n\t\t\t\tuser.profile = userData;\r\n\r\n\t\t\t\tuser.save(function(err) {\r\n\t\t\t\t\tdone(err, user);\r\n\t\t\t\t});\r\n\r\n\t\t\t});\r\n\r\n\t\t});\r\n\t}\r\n\r\n\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./server/core/auth/helper.js\n **/","module.exports = require(\"passport-facebook\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"passport-facebook\"\n ** module id = 67\n ** module chunks = 0\n **/","\"use strict\";\r\n\r\nlet logger \t= require(\"../../logger\");\r\nlet config \t= require(\"../../../config\");\r\nlet secrets = require(\"../../secrets\");\r\nlet helper \t= require(\"../helper\");\r\n\r\nlet passport \t\t= require(\"passport\");\r\nlet GoogleStrategy  = require(\"passport-github\").Strategy;\r\nlet User \t\t\t= require(\"../../../models/user\");\r\n\r\n// https://github.com/settings/applications/new\r\nmodule.exports = function() {\r\n\tif (secrets.apiKeys && secrets.apiKeys.github && secrets.apiKeys.github.clientID) {\r\n\r\n\t\tpassport.use(\"github\", new GoogleStrategy({\r\n\t\t\tclientID: secrets.apiKeys.github.clientID,\r\n\t\t\tclientSecret: secrets.apiKeys.github.clientSecret,\r\n\t\t\tcallbackURL: \"/auth/github/callback\",\r\n\t\t\tpassReqToCallback: true\r\n\t\t}, function(req, accessToken, refreshToken, profile, done) {\r\n\t\t\t//logger.info(\"Received profile: \", profile);\r\n\r\n\t\t\thelper.linkToSocialAccount({\r\n\t\t\t\treq, \r\n\t\t\t\taccessToken,\r\n\t\t\t\trefreshToken,\r\n\t\t\t\tprofile,\r\n\t\t\t\tdone,\r\n\r\n\t\t\t\tprovider: \"github\",\r\n\t\t\t\temail: profile._json.email,\r\n\t\t\t\tuserData: {\r\n\t\t\t\t\tname: profile.displayName,\r\n\t\t\t\t\tgender: null,\r\n\t\t\t\t\tpicture: profile._json.avatar_url,\r\n\t\t\t\t\tlocation: profile._json.location\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t}));\r\n\r\n\t}\r\n};\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./server/core/auth/strategies/github.js\n **/","module.exports = require(\"passport-github\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"passport-github\"\n ** module id = 69\n ** module chunks = 0\n **/","\"use strict\";\r\n\r\nlet logger \t= require(\"../../logger\");\r\nlet config \t= require(\"../../../config\");\r\nlet secrets = require(\"../../secrets\");\r\nlet helper \t= require(\"../helper\");\r\n\r\nlet passport \t\t= require(\"passport\");\r\nlet GoogleStrategy  = require(\"passport-google-oauth\").OAuth2Strategy;\r\nlet User \t\t\t= require(\"../../../models/user\");\r\n\r\n// https://console.developers.google.com/project/express-mongo-boilerplate/apiui/consent\r\nmodule.exports = function() {\r\n\tif (secrets.apiKeys && secrets.apiKeys.google && secrets.apiKeys.google.clientID) {\r\n\r\n\t\tpassport.use(\"google\", new GoogleStrategy({\r\n\t\t\tclientID: secrets.apiKeys.google.clientID,\r\n\t\t\tclientSecret: secrets.apiKeys.google.clientSecret,\r\n\t\t\tcallbackURL: \"/auth/google/callback\",\r\n\t\t\tpassReqToCallback: true\r\n\t\t}, function(req, accessToken, refreshToken, profile, done) {\r\n\t\t\t//logger.info(\"Received profile: \", profile);\r\n\r\n\t\t\thelper.linkToSocialAccount({\r\n\t\t\t\treq, \r\n\t\t\t\taccessToken,\r\n\t\t\t\trefreshToken,\r\n\t\t\t\tprofile,\r\n\t\t\t\tdone,\r\n\r\n\t\t\t\tprovider: \"google\",\r\n\t\t\t\temail: profile.emails[0].value,\r\n\t\t\t\tuserData: {\r\n\t\t\t\t\tname: profile.displayName,\r\n\t\t\t\t\tgender: profile._json.gender,\r\n\t\t\t\t\tpicture: profile._json.image.url,\r\n\t\t\t\t\tlocation: null\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t}));\r\n\r\n\t}\r\n};\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./server/core/auth/strategies/google.js\n **/","module.exports = require(\"passport-google-oauth\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"passport-google-oauth\"\n ** module id = 71\n ** module chunks = 0\n **/","\"use strict\";\r\n\r\nlet passport = require(\"passport\");\r\nlet LocalStrategy = require(\"passport-local\").Strategy;\r\nlet User = require(\"../../../models/user\");\r\n\r\nmodule.exports = function() {\r\n\tpassport.use(new LocalStrategy({\r\n\t\tusernameField: \"username\",\r\n\t\tpasswordField: \"password\",\r\n\t\tpassReqToCallback : true\r\n\t}, function(req, username, password, done) {\r\n\t\treturn User.findOne({\r\n\t\t\t$or: [ \r\n\t\t\t\t{ \"username\": username}, \r\n\t\t\t\t{ \"email\": username}\r\n\t\t\t]\r\n\t\t}, function(err, user) {\r\n\t\t\tif (err)\r\n\t\t\t\treturn done(err);\r\n\t\t\t\r\n\t\t\tif (!user)\r\n\t\t\t\treturn done(null, false, {\r\n\t\t\t\t\tmessage: req.t(\"UnknowUsernameOrEmail\")\r\n\t\t\t\t});\r\n\r\n\t\t\tif (!user.verified)\r\n\t\t\t\treturn done(null, false, {\r\n\t\t\t\t\tmessage: req.t(\"PleaseActivateAccount\")\r\n\t\t\t\t});\r\n\r\n\t\t\tif (user.passwordLess)\r\n\t\t\t\treturn done(null, false, {\r\n\t\t\t\t\tmessage: req.t(\"PasswordlessAccountLeaveEmpty\")\r\n\t\t\t\t});\r\n\r\n\t\t\tuser.comparePassword(password, function(err, isMatch) {\r\n\t\t\t\tif (err)\r\n\t\t\t\t\treturn done(err);\r\n\r\n\t\t\t\tif (isMatch !== true)\r\n\t\t\t\t\treturn done(null, false, {\r\n\t\t\t\t\t\tmessage: req.t(\"InvalidPassword\")\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\telse\r\n\t\t\t\t\treturn done(null, user);\t\t\r\n\r\n\t\t\t});\r\n\t\t});\r\n\t}));\r\n};\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./server/core/auth/strategies/local.js\n **/","module.exports = require(\"passport-local\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"passport-local\"\n ** module id = 73\n ** module chunks = 0\n **/","\"use strict\";\r\n\r\nlet logger \t= require(\"../../logger\");\r\nlet config \t= require(\"../../../config\");\r\nlet secrets = require(\"../../secrets\");\r\nlet helper \t= require(\"../helper\");\r\n\r\nlet passport \t\t= require(\"passport\");\r\nlet GoogleStrategy  = require(\"passport-twitter\").Strategy;\r\nlet User \t\t\t= require(\"../../../models/user\");\r\n\r\n// https://apps.twitter.com/app/new\r\nmodule.exports = function() {\r\n\tif (secrets.apiKeys && secrets.apiKeys.twitter && secrets.apiKeys.twitter.clientID) {\r\n\r\n\t\tpassport.use(\"twitter\", new GoogleStrategy({\r\n\t\t\tconsumerKey: secrets.apiKeys.twitter.clientID,\r\n\t\t\tconsumerSecret: secrets.apiKeys.twitter.clientSecret,\r\n\t\t\tcallbackURL: \"/auth/twitter/callback\",\r\n\t\t\tpassReqToCallback: true\r\n\t\t}, function(req, accessToken, refreshToken, profile, done) {\r\n\t\t\t//logger.info(\"Received profile: \", profile);\r\n\r\n\t\t\thelper.linkToSocialAccount({\r\n\t\t\t\treq, \r\n\t\t\t\taccessToken,\r\n\t\t\t\trefreshToken,\r\n\t\t\t\tprofile,\r\n\t\t\t\tdone,\r\n\r\n\t\t\t\tprovider: \"twitter\",\r\n\t\t\t\temail: `${profile.username}@twitter.com`,\r\n\t\t\t\tuserData: {\r\n\t\t\t\t\tname: profile.displayName,\r\n\t\t\t\t\tgender: null,\r\n\t\t\t\t\tpicture: profile._json.profile_image_url_https,\r\n\t\t\t\t\tlocation: profile._json.location\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t}));\r\n\r\n\t}\r\n};\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./server/core/auth/strategies/twitter.js\n **/","module.exports = require(\"passport-twitter\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"passport-twitter\"\n ** module id = 75\n ** module chunks = 0\n **/","module.exports = require(\"webpack\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"webpack\"\n ** module id = 76\n ** module chunks = 0\n **/","var path = require(\"path\");\r\nvar glob = require(\"glob\");\r\nvar webpack = require(\"webpack\");\r\n\r\nvar precss = require(\"precss\");\r\nvar autoprefixer = require(\"autoprefixer\");\r\n\r\nmodule.exports = {\r\n\tdevtool: 'eval-source-map',\r\n\tentry: {\r\n\t\tapp: ['webpack-hot-middleware/client', \"./client/app/main.js\"],\r\n\t\tfrontend: ['webpack-hot-middleware/client', \"./client/frontend/main.js\"]\r\n\t},\r\n\toutput: {\r\n\t\tpath: path.resolve(__dirname, \"server\", \"public\", \"app\"),\r\n\t\tpublicPath: \"/app/\",\r\n\t\tfilename: \"[name].js\",\r\n\t\tchunkFilename: \"[chunkhash].js\"\r\n\t},\r\n\tmodule: {\r\n\t\tloaders: [\r\n\t\t\t// required to write \"require('./style.css')\"\r\n\t\t\t{ test: /\\.css$/,   loader: \"style!css\" },\r\n\r\n\t\t\t{ test: /\\.scss$/, \tloaders: [\"style\", \"css\", \"postcss\", \"sass\"] },\r\n\r\n\t\t\t{ test: /\\.json$/,   loader: \"json-loader\" },\r\n\r\n\t\t\t// ES6/7 syntax and JSX transpiling out of the box\r\n    \t\t{ test: /\\.js$/,\tloader: 'babel', \t\texclude: [/node_modules/, /vendor/], query: {\r\n\t\t\t\t\tpresets: ['es2015', 'stage-0']\r\n\t\t\t\t}\t\r\n\t\t\t},\r\n\r\n\t\t\t{ test: /\\.vue$/,   loader: \"vue\" },\r\n\r\n\t\t\t{ test: /\\.gif$/, \tloader: \"url-loader?name=images/[name]-[hash:6].[ext]&limit=100000\" },\r\n\t\t\t{ test: /\\.png$/, \tloader: \"url-loader?name=images/[name]-[hash:6].[ext]&limit=100000\" },\r\n\t\t\t{ test: /\\.jpg$/, \tloader: \"file-loader?name=images/[name]-[hash:6].[ext]\" },\t\t\r\n\r\n\t\t\t// required for bootstrap icons\r\n\t\t\t{ test: /\\.woff$/,  loader: \"url-loader?prefix=font/&limit=5000&mimetype=application/font-woff\" },\r\n\t\t\t{ test: /\\.ttf$/,   loader: \"file-loader?prefix=font/\" },\r\n\t\t\t{ test: /\\.eot$/,   loader: \"file-loader?prefix=font/\" },\r\n\t\t\t{ test: /\\.svg$/,   loader: \"file-loader?prefix=font/\" }\r\n\r\n\t\t]\r\n\t},\r\n\tresolve: {\r\n    \textensions: ['', '.vue', '.js', '.json'],\r\n    \talias: {\r\n    \t\t'images': path.resolve(__dirname, 'client', 'images')\r\n    \t}\r\n\t},\r\n\tplugins: [\r\n\t\tnew webpack.HotModuleReplacementPlugin(),\r\n\t\tnew webpack.NoErrorsPlugin()\r\n\r\n\t\t//new ExtractTextPlugin(\"[name].css\")\r\n\t],\r\n\r\n\tpostcss: function () {\r\n\t\treturn [\r\n\t\t\tautoprefixer({ browsers: ['last 2 versions'] }), \r\n\t\t\tprecss\r\n\t\t];\r\n\t},\t\r\n\r\n\tvue: {\r\n\t\tautoprefixer: {\r\n\t\t\tbrowsers: ['last 2 versions']\r\n\t\t}\r\n\t}\t\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./webpack.dev.config.js\n **/","module.exports = require(\"glob\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"glob\"\n ** module id = 78\n ** module chunks = 0\n **/","module.exports = require(\"precss\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"precss\"\n ** module id = 79\n ** module chunks = 0\n **/","module.exports = require(\"autoprefixer\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"autoprefixer\"\n ** module id = 80\n ** module chunks = 0\n **/","module.exports = require(\"webpack-dev-middleware\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"webpack-dev-middleware\"\n ** module id = 81\n ** module chunks = 0\n **/","module.exports = require(\"webpack-hot-middleware\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"webpack-hot-middleware\"\n ** module id = 82\n ** module chunks = 0\n **/","\"use strict\";\r\n\r\nlet config \t= require(\"../config\");\r\nlet logger \t= require(\"../core/logger\");\r\nlet path \t= require(\"path\");\r\n\r\nmodule.exports = function(app, db) {\r\n\r\n\t// Index page\r\n\tapp.get(\"/\", function(req, res) {\r\n\t\tif (req.user != null)\r\n\t\t\tres.render(\"main\", {\r\n\t\t\t\tuser: req.user\r\n\t\t\t});\r\n\t\telse\r\n\t\t\tres.render(\"index\");\r\n\t});\r\n\r\n\t// Handle account routes\r\n\trequire(\"./account\")(app, db);\r\n\r\n\t// Handle Auth routes\r\n\trequire(\"./auth\")(app, db);\r\n\r\n\t// Load applogic routes\r\n\trequire(\"../applogic/routeHandlers\")(app, db);\r\n\r\n\t// Handle Graphql request\r\n\trequire(\"./graphql\")(app, db);\r\n\r\n\t// Handle errors\r\n\trequire(\"./errors\")(app, db);\t\r\n};\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./server/routes/index.js\n **/","\"use strict\";\r\n\r\nlet config \t= require(\"../config\");\r\nlet logger \t= require(\"../core/logger\");\r\n\r\nlet secrets \t= require(\"../core/secrets\");\r\nlet tokgen \t\t= require(\"../libs/tokgen\");\r\n\r\nlet crypto = require(\"crypto\");\r\nlet async = require(\"async\");\r\nlet passport = require(\"passport\");\r\nlet express = require(\"express\");\r\n\r\nlet response = require(\"../core/response\");\r\nlet mailer = require(\"../libs/mailer\");\r\n\r\nlet User = require(\"../models/user\");\r\n\r\n/**\r\n * Check what social API are configured. We only show\r\n * this social buttons on login # signup pages\r\n */\r\nfunction checkAvailableSocialAuth() {\r\n\t// set social options\r\n\tlet social = {};\r\n\r\n\tif (secrets.apiKeys) {\r\n\t\tif (secrets.apiKeys.google && secrets.apiKeys.google.clientID)\r\n\t\t\tsocial.google = true;\r\n\r\n\t\tif (secrets.apiKeys.facebook && secrets.apiKeys.facebook.clientID)\r\n\t\t\tsocial.facebook = true;\r\n\r\n\t\tif (secrets.apiKeys.github && secrets.apiKeys.github.clientID)\r\n\t\t\tsocial.github = true;\r\n\r\n\t\tif (secrets.apiKeys.twitter && secrets.apiKeys.twitter.clientID)\r\n\t\t\tsocial.twitter = true;\r\n\t}\r\n\r\n\tif (Object.keys(social).length > 0)\r\n\t\treturn social;\r\n\r\n\treturn null;\r\n}\r\n\r\nmodule.exports = function(app, db) {\r\n\r\n\t// Login page\r\n\tapp.get(\"/login\", function(req, res) {\r\n\t\tif (req.user != null) {\r\n\t\t\treturn res.redirect(\"/\");\r\n\t\t}\r\n\r\n\t\tres.render(\"account/login\", {\r\n\t\t\tsocialAuth: checkAvailableSocialAuth()\r\n\t\t});\r\n\t});\r\n\r\n\t// Logout\r\n\tapp.get(\"/logout\", function(req, res) {\r\n\t\treq.logout();\r\n\t\tres.redirect(\"/\");\r\n\t});\r\n\r\n\t// Sign-up\r\n\tapp.get(\"/signup\", function(req, res) {\r\n\t\tif (config.disableSignUp === true)\r\n\t\t\treturn res.redirect(\"/login\");\r\n\r\n\t\tres.render(\"account/signup\", {\r\n\t\t\tsocialAuth: checkAvailableSocialAuth()\r\n\t\t});\r\n\r\n\t});\t\r\n\r\n\t// User registration\r\n\tapp.post(\"/signup\", function(req, res) {\r\n\t\tif (config.disableSignUp === true)\r\n\t\t\treturn res.redirect(\"/\");\r\n\r\n\t\treq.assert(\"name\", req.t(\"NameCannotBeEmpty\")).notEmpty();\r\n\t\treq.assert(\"email\", req.t(\"EmailCannotBeEmpty\")).notEmpty();\r\n\t\treq.assert(\"email\", req.t(\"EmailIsNotValid\")).isEmail();\r\n\t\treq.sanitize(\"email\").normalizeEmail({ remove_dots: false });\r\n\r\n\t\t//req.assert(\"username\", req.t(\"UsernameCannotBeEmpty\")).notEmpty();\r\n\t\t\r\n\t\tif (!req.body.username)\r\n\t\t\treq.body.username = req.body.email;\r\n\r\n\t\treq.sanitize(\"passwordless\").toBoolean();\r\n\t\tlet passwordless = req.body.passwordless === true;\r\n\t\tif (!passwordless) {\r\n\t\t\treq.assert(\"password\", req.t(\"PasswordCannotBeEmpty\")).notEmpty();\r\n\t\t\treq.assert(\"password\", req.t(\"PasswordTooShort\")).len(6);\r\n\t\t}\r\n\r\n\t\tlet errors = req.validationErrors();\r\n\r\n\t\tif (errors) {\r\n\t\t\treq.flash(\"error\", errors);\r\n\t\t\treturn res.redirect(\"/signup\");\r\n\t\t}\r\n\r\n\t\tasync.waterfall([\r\n\r\n\t\t\tfunction generateVerificationToken(done) {\r\n\t\t\t\tif (config.verificationRequired) {\r\n\t\t\t\t\tcrypto.randomBytes(25, function(err, buf) {\r\n\t\t\t\t\t\tdone(err, err ? null : buf.toString(\"hex\"));\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdone(null, null);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tfunction passwordless(token, done) {\r\n\t\t\t\tif (passwordless) {\r\n\t\t\t\t\tcrypto.randomBytes(25, function(err, buf) {\r\n\t\t\t\t\t\tdone(err, token, err ? null : buf.toString(\"hex\"));\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t\tdone(null, token, req.body.password);\r\n\t\t\t},\r\n\r\n\t\t\tfunction createUser(token, password, done) {\r\n\r\n\t\t\t\tlet user = new User({\r\n\t\t\t\t\tfullName: req.body.name,\r\n\t\t\t\t\temail: req.body.email,\r\n\t\t\t\t\tusername: req.body.username,\r\n\t\t\t\t\tpassword: password,\r\n\t\t\t\t\troles: [\"user\"],\r\n\t\t\t\t\tprovider: \"local\"\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (token) {\r\n\t\t\t\t\tuser.verified = false;\r\n\t\t\t\t\tuser.verifyToken = token;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tuser.verified = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tuser.save(function(err, user) {\r\n\t\t\t\t\tif (err && err.code === 11000) {\r\n\t\t\t\t\t\tlet field = err.message.split(\".$\")[1];\r\n\t\t\t\t\t\tfield = field.split(\" dup key\")[0];\r\n\t\t\t\t\t\tfield = field.substring(0, field.lastIndexOf(\"_\"));\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (field == \"email\")\r\n\t\t\t\t\t\t\treq.flash(\"error\", { msg: req.t(\"EmailIsExists\") });\r\n\t\t\t\t\t\telse \r\n\t\t\t\t\t\t\treq.flash(\"error\", { msg: req.t(\"UsernameIsExists\") });\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdone(err, user);\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\tfunction sendEmail(user, done) {\r\n\t\t\t\tif (user.verified) {\r\n\t\t\t\t\t// Send welcome email\r\n\t\t\t\t\tlet subject = req.t(\"mailSubjectWelcome\", config);\r\n\r\n\t\t\t\t\tres.render(\"mail/welcome\", {\r\n\t\t\t\t\t\tname: user.fullName\r\n\t\t\t\t\t}, function(err, html) {\r\n\t\t\t\t\t\tif (err)\r\n\t\t\t\t\t\t\treturn done(err);\r\n\r\n\t\t\t\t\t\tmailer.send(user.email, subject, html, function(err, info) {\r\n\t\t\t\t\t\t\t//if (err)\r\n\t\t\t\t\t\t\t//\treq.flash(\"error\", { msg: \"Unable to send email to \" + user.email});\r\n\r\n\t\t\t\t\t\t\tdone(null, user);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\t\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Send verification email\r\n\t\t\t\t\tlet subject = req.t(\"mailSubjectActivate\", config);\r\n\r\n\t\t\t\t\tres.render(\"mail/accountVerify\", {\r\n\t\t\t\t\t\tname: user.fullName,\r\n\t\t\t\t\t\tvalidateLink: \"http://\" + req.headers.host + \"/verify/\" + user.verifyToken\r\n\t\t\t\t\t}, function(err, html) {\r\n\t\t\t\t\t\tif (err)\r\n\t\t\t\t\t\t\treturn done(err);\r\n\r\n\t\t\t\t\t\tmailer.send(user.email, subject, html, function(err, info) {\r\n\t\t\t\t\t\t\tif (err)\r\n\t\t\t\t\t\t\t\treq.flash(\"error\", { msg: req.t(\"UnableToSendEmail\", user) });\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\treq.flash(\"info\", { msg: req.t(\"emailSentVerifyLink\")});\r\n\r\n\r\n\t\t\t\t\t\t\tdone(err, user);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t], function(err, user) {\r\n\t\t\tif (err) {\r\n\t\t\t\tlogger.error(err);\r\n\t\t\t\treturn res.redirect(\"back\");\r\n\t\t\t}\r\n\r\n\t\t\tif (user.verified) {\r\n\t\t\t\treq.login(user, function(err) {\r\n\t\t\t\t\tif (err)\r\n\t\t\t\t\t\tlogger.error(err);\r\n\r\n\t\t\t\t\treturn res.redirect(\"/\");\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t\tres.redirect(\"/login\");\r\n\t\t});\r\n\t});\r\n\r\n\r\n\t// Verify account\r\n\tapp.get(\"/verify/:token\", function(req, res) {\r\n\t\tif (req.isAuthenticated())\r\n\t\t\treturn res.redirect(\"/\");\r\n\t\t\r\n\t\tasync.waterfall([\r\n\r\n\t\t\tfunction checkToken(done) {\r\n\t\t\t\tUser\t\t\t\r\n\t\t\t\t\t.findOne({ verifyToken: req.params.token })\r\n\t\t\t\t\t.exec( (err, user) => {\r\n\t\t\t\t\t\tif (err) \r\n\t\t\t\t\t\t\treturn done(err);\r\n\r\n\t\t\t\t\t\tif (!user) {\r\n\t\t\t\t\t\t\treq.flash(\"error\", { msg: req.t(\"AccountVerificationExpired\") });\r\n\t\t\t\t\t\t\treturn done(\"Verification is invalid!\");\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tuser.verified = true;\r\n\t\t\t\t\t\tuser.verifyToken = undefined;\r\n\t\t\t\t\t\tuser.lastLogin = Date.now();\r\n\r\n\t\t\t\t\t\tuser.save(function(err) {\r\n\t\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\t\treq.flash(\"error\", { msg: req.t(\"UnableModifyAccountDetails\") });\r\n\t\t\t\t\t\t\t\treturn done(err);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tdone(null, user);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\t\t\t\r\n\t\t\t},\r\n\r\n\t\t\tfunction sendWelcomeEmailToUser(user, done) {\r\n\t\t\t\tlet subject = req.t(\"mailSubjectWelcome\", config);\r\n\r\n\t\t\t\tres.render(\"mail/welcome\", {\r\n\t\t\t\t\tname: user.fullName\r\n\t\t\t\t}, function(err, html) {\r\n\t\t\t\t\tif (err)\r\n\t\t\t\t\t\treturn done(err);\r\n\r\n\t\t\t\t\tmailer.send(user.email, subject, html, function(err, info) {\r\n\t\t\t\t\t\t//if (err)\r\n\t\t\t\t\t\t//\treq.flash(\"error\", { msg: \"Unable to send email to \" + user.email});\r\n\r\n\t\t\t\t\t\tdone(null, user);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\t\r\n\t\t\t},\r\n\r\n\t\t\tfunction loginUser(user, done) {\r\n\t\t\t\treq.login(user, function(err) {\r\n\t\t\t\t\tdone(err, user);\r\n\t\t\t\t});\t\t\t\t\r\n\t\t\t}\r\n\r\n\t\t], function(err) {\r\n\t\t\tif (err) {\r\n\t\t\t\tlogger.error(err);\r\n\t\t\t\treturn res.redirect(\"/signup\");\r\n\t\t\t}\r\n\r\n\t\t\tres.redirect(\"/\");\r\n\t\t});\r\n\t});\t\r\n\r\n\t// Passwordless login\r\n\tapp.get(\"/passwordless/:token\", function(req, res) {\r\n\t\tif (req.isAuthenticated())\r\n\t\t\treturn res.redirect(\"/\");\r\n\t\t\r\n\t\tasync.waterfall([\r\n\r\n\t\t\tfunction checkToken(done) {\r\n\t\t\t\tUser\t\t\t\r\n\t\t\t\t\t.findOne({ passwordLessToken: req.params.token })\r\n\t\t\t\t\t.exec( (err, user) => {\r\n\t\t\t\t\t\tif (err) \r\n\t\t\t\t\t\t\treturn done(err);\r\n\r\n\t\t\t\t\t\tif (!user) {\r\n\t\t\t\t\t\t\treq.flash(\"error\", { msg: req.t(\"PasswordlessTokenExpired\") });\r\n\t\t\t\t\t\t\treturn done(\"Token is invalid!\");\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tuser.passwordLessToken = undefined;\r\n\t\t\t\t\t\tif (!user.verified) {\r\n\t\t\t\t\t\t\tuser.verified = true;\r\n\t\t\t\t\t\t\tuser.verifyToken = undefined;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tuser.lastLogin = Date.now();\r\n\r\n\t\t\t\t\t\tuser.save(function(err) {\r\n\t\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\t\treq.flash(\"error\", { msg: req.t(\"UnableModifyAccountDetails\") });\r\n\t\t\t\t\t\t\t\treturn done(err);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tdone(null, user);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\t\t\t\r\n\t\t\t},\r\n\r\n\t\t\tfunction loginUser(user, done) {\r\n\t\t\t\treq.login(user, function(err) {\r\n\t\t\t\t\tdone(err, user);\r\n\t\t\t\t});\t\t\t\t\r\n\t\t\t}\r\n\r\n\t\t], function(err) {\r\n\t\t\tif (err) {\r\n\t\t\t\tlogger.error(err);\r\n\t\t\t\treturn res.redirect(\"/login\");\r\n\t\t\t}\r\n\r\n\t\t\tres.redirect(\"/\");\r\n\t\t});\r\n\t});\t\r\n\r\n\t// Forgot password\r\n\tapp.get(\"/forgot\", function(req, res) {\r\n\t\tif (req.isAuthenticated())\r\n\t\t\treturn res.redirect(\"/\");\r\n\t\t\r\n\t\tres.render(\"account/forgot\");\r\n\t});\t\r\n\r\n\t// Forgot password\r\n\tapp.post(\"/forgot\", function(req, res) {\r\n\t\treq.assert(\"email\", req.t(\"EmailIsNotValid\")).isEmail();\r\n\t\treq.assert(\"email\", req.t(\"EmailCannotBeEmpty\")).notEmpty();\r\n\t\treq.sanitize(\"email\").normalizeEmail({ remove_dots: false });\r\n\t\t\r\n\t\tlet errors = req.validationErrors();\r\n\t\tif (errors) {\r\n\t\t\treq.flash(\"error\", errors);\r\n\t\t\treturn res.redirect(\"back\");\r\n\t\t}\t\r\n\r\n\t\tasync.waterfall([\r\n\r\n\t\t\tfunction generateToken(done) {\r\n\t\t\t\tcrypto.randomBytes(25, function(err, buf) {\r\n\t\t\t\t\tdone(err, err ? null : buf.toString(\"hex\"));\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\tfunction getUserAndSaveToken(token, done) {\r\n\t\t\t\tUser.findOne({ email: req.body.email }, function(err, user) {\r\n\t\t\t\t\tif (!user) {\r\n\t\t\t\t\t\treq.flash(\"error\", { msg: req.t(\"EmailNotAssociatedToAccount\", req.body) });\r\n\t\t\t\t\t\treturn done(\"Email address \" + req.body.email + \" is not registered!\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tuser.resetPasswordToken = token;\r\n\t\t\t\t\tuser.resetPasswordExpires = Date.now() + 3600000; // expire in 1 hour\r\n\t\t\t\t\tuser.save(function(err) {\r\n\t\t\t\t\t\tdone(err, token, user);\r\n\t\t\t\t\t});\t\t\t\t\t\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\tfunction sendResetEmailToUser(token, user, done) {\r\n\t\t\t\tlet subject = req.t(\"mailSubjectResetPassword\", config);\r\n\r\n\t\t\t\tres.render(\"mail/passwordReset\", {\r\n\t\t\t\t\tname: user.fullName,\r\n\t\t\t\t\tresetLink: \"http://\" + req.headers.host + \"/reset/\" + token\r\n\t\t\t\t}, function(err, html) {\r\n\t\t\t\t\tif (err)\r\n\t\t\t\t\t\treturn done(err);\r\n\t\t\t\t\t\r\n\t\t\t\t\tmailer.send(user.email, subject, html, function(err, info) {\r\n\t\t\t\t\t\tif (err)\r\n\t\t\t\t\t\t\treq.flash(\"error\", { msg: req.t(\"UnableToSendEmail\", user) });\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\treq.flash(\"info\", { msg: req.t(\"emailSentPasswordResetLink\", user) });\r\n\r\n\t\t\t\t\t\tdone(err);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t], function(err) {\r\n\t\t\tif (err)\r\n\t\t\t\tlogger.error(err);\r\n\r\n\t\t\tres.redirect(\"back\");\r\n\t\t});\r\n\t});\t\r\n\r\n\r\n\r\n\t// Reset password\r\n\tapp.get(\"/reset/:token\", function(req, res, next) {\r\n\t\tif (req.isAuthenticated())\r\n\t\t\treturn res.redirect(\"/\");\r\n\t\t\r\n\t\tUser\r\n\t\t\t.findOne({ resetPasswordToken: req.params.token })\r\n\t\t\t.where(\"resetPasswordExpires\").gt(Date.now())\r\n\t\t\t.exec((err, user) => {\r\n\t\t\t\tif (err) \r\n\t\t\t\t\treturn next(err);\r\n\r\n\t\t\t\tif (!user) {\r\n\t\t\t\t\treq.flash(\"error\", { msg: req.t(\"PasswordResetTokenExpired\") });\r\n\t\t\t\t\treturn res.redirect(\"/forgot\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tres.render(\"account/reset\");\r\n\t\t\t});\r\n\t});\r\n\r\n\t// Reset password\r\n\tapp.post(\"/reset/:token\", function(req, res, next) {\r\n\t\treq.assert(\"password\", req.t(\"PasswordTooShort\")).len(6);\r\n\t\treq.assert(\"confirm\", req.t(\"PasswordNotMatched\")).equals(req.body.password);\r\n\r\n\t\tconst errors = req.validationErrors();\r\n\t\tif (errors) {\r\n\t\t\treq.flash(\"error\", errors);\r\n\t\t\treturn res.redirect(\"back\");\r\n\t\t}\r\n\r\n\t\tasync.waterfall([\r\n\r\n\t\t\tfunction checkTokenAndExpires(done) {\r\n\t\t\t\tUser\t\t\t\r\n\t\t\t\t\t.findOne({ resetPasswordToken: req.params.token })\r\n\t\t\t\t\t.where(\"resetPasswordExpires\").gt(Date.now())\r\n\t\t\t\t\t.exec( (err, user) => {\r\n\t\t\t\t\t\tif (err) \r\n\t\t\t\t\t\t\treturn done(err);\r\n\r\n\t\t\t\t\t\tif (!user) {\r\n\t\t\t\t\t\t\treq.flash(\"error\", { msg: req.t(\"PasswordResetTokenExpired\") });\r\n\t\t\t\t\t\t\treturn done(\"Password reset token is invalid or has expired.\");\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Clear passwordless flag, if the user change password\r\n\t\t\t\t\t\tif (user.passwordLess)\r\n\t\t\t\t\t\t\tuser.passwordLess = false;\r\n\r\n\t\t\t\t\t\tuser.password = req.body.password;\r\n\t\t\t\t\t\tuser.resetPasswordToken = undefined;\r\n\t\t\t\t\t\tuser.resetPasswordExpires = undefined;\r\n\t\t\t\t\t\tuser.lastLogin = Date.now();\r\n\r\n\t\t\t\t\t\tuser.save(function(err) {\r\n\t\t\t\t\t\t\tif (err) \r\n\t\t\t\t\t\t\t\treturn done(err);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\treq.login(user, function(err) {\r\n\t\t\t\t\t\t\t\tdone(err, user);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\t\t\t\r\n\t\t\t},\r\n\r\n\t\t\tfunction sendPasswordChangeEmailToUser(user, done) {\r\n\t\t\t\tlet subject = req.t(\"mailSubjectPasswordChanged\", config);\r\n\r\n\t\t\t\tres.render(\"mail/passwordChange\", {\r\n\t\t\t\t\tname: user.fullName\r\n\t\t\t\t}, function(err, html) {\r\n\t\t\t\t\tif (err)\r\n\t\t\t\t\t\treturn done(err);\r\n\r\n\t\t\t\t\tmailer.send(user.email, subject, html, function(err, info) {\r\n\t\t\t\t\t\tif (err)\r\n\t\t\t\t\t\t\treq.flash(\"error\", { msg: req.t(\"UnableToSendEmail\", user) });\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\treq.flash(\"info\", { msg: req.t(\"PasswordChanged\")});\r\n\r\n\t\t\t\t\t\tdone(err);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t], function(err) {\r\n\t\t\tif (err) {\r\n\t\t\t\tlogger.error(err);\r\n\t\t\t\treturn res.redirect(\"back\");\r\n\t\t\t}\r\n\r\n\t\t\tres.redirect(\"/\");\r\n\t\t});\r\n\t});\r\n\r\n\t// Generate API key\r\n\tapp.get(\"/generateAPIKey\", function(req, res) {\r\n\t\tif (!req.isAuthenticated())\r\n\t\t\treturn response.json(res, null, response.UNAUTHORIZED);\r\n\t\t\r\n\t\tUser\r\n\t\t\t.findById(req.user.id)\r\n\t\t\t.exec((err, user) => {\r\n\t\t\t\tif (err) \r\n\t\t\t\t\treturn response.json(res, null, response.SERVER_ERROR);\r\n\r\n\t\t\t\tif (!user) {\r\n\t\t\t\t\treturn response.json(res, null, response.NOT_FOUND, req.t(\"InvalidUser\"));\r\n\t\t\t\t}\r\n\r\n\t\t\t\tuser.apiKey = tokgen();\r\n\r\n\t\t\t\tuser.save((err) => {\r\n\t\t\t\t\tif (err) \r\n\t\t\t\t\t\treturn response.json(res, null, response.SERVER_ERROR);\r\n\r\n\t\t\t\t\treturn response.json(res, user);\r\n\t\t\t\t});\r\n\r\n\t\t\t});\r\n\t});\t\r\n};\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./server/routes/account.js\n **/","module.exports = require(\"async\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"async\"\n ** module id = 85\n ** module chunks = 0\n **/","\"use strict\";\r\n\r\nmodule.exports = {\r\n\t\r\n\tBAD_REQUEST: {\r\n\t\tstatus: 400,\r\n\t\ttype: \"BAD_REQUEST\",\r\n\t\tmessage: \"Invalid request\"\r\n\t},\r\n\r\n\tUNAUTHORIZED: {\r\n\t\tstatus: 401,\r\n\t\ttype: \"UNAUTHORIZED\",\r\n\t\tmessage: \"Unauthorized. Please login first!\"\r\n\t},\r\n\r\n\tREQUEST_FAILED: {\r\n\t\tstatus: 402,\r\n\t\ttype: \"REQUEST_FAILED\",\r\n\t\tmessage: \"Request failed!\"\r\n\t},\t\r\n\r\n\tFORBIDDEN: {\r\n\t\tstatus: 403,\r\n\t\ttype: \"FORBIDDEN\",\r\n\t\tmessage: \"You have no permission for this resource!\"\r\n\t},\r\n\r\n\tNOT_FOUND: {\r\n\t\tstatus: 404,\r\n\t\ttype: \"NOT_FOUND\",\r\n\t\tmessage: \"Not found!\"\r\n\t},\r\n\r\n\tTOO_MANY_REQUEST: {\r\n\t\tstatus: 429,\r\n\t\ttype: \"TOO_MANY_REQUEST\",\r\n\t\tmessage: \"Too many request!\"\r\n\t},\r\n\r\n\tSERVER_ERROR: {\r\n\t\tstatus: 500,\r\n\t\ttype: \"SERVER_ERROR\",\r\n\t\tmessage: \"Server error\"\r\n\t},\r\n\r\n\tNOT_IMPLEMENTED: {\r\n\t\tstatus: 501,\r\n\t\ttype: \"NOT_IMPLEMENTED\",\r\n\t\tmessage: \"This resource is not implemented!\"\r\n\t},\r\n\r\n\t\r\n\t/**\r\n\t * Generate a JSON REST API response\r\n\t *\r\n\t * If data present and no error, we will send status 200 with JSON data\r\n\t * If not data but error, we will send HTTP error code and message\r\n\t * \r\n\t * @param  {Object} res        \tExpressJS res object\r\n\t * @param  {json} \tdata       \tJSON response data\r\n\t * @param  {Object} err        \tError object\r\n\t * @param  {String} errMessage  Custom error message\r\n\t */\r\n\tjson(res, data, err, errMessage) {\r\n\t\tlet response = {};\r\n\r\n\t\tif (err) {\r\n\t\t\tresponse.error = err;\r\n\t\t\tresponse.status = err.status || 500;\r\n\t\t\tif (errMessage)\r\n\t\t\t\tresponse.error.message = errMessage;\r\n\r\n\t\t\tresponse.data = data;\r\n\r\n\t\t\treturn res.status(response.status).json(response);\r\n\t\t}\r\n\r\n\t\tresponse.status = 200;\r\n\t\tresponse.data = data;\r\n\r\n\t\treturn res.json(response);\r\n\t}\r\n\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./server/core/response.js\n **/","\"use strict\";\r\n\r\nlet config    \t= require(\"../config\");\r\nlet logger    \t= require(\"../core/logger\");\r\nlet nodemailer \t= require(\"nodemailer\");\r\nlet htmlToText \t= require(\"nodemailer-html-to-text\").htmlToText;\r\n\r\nmodule.exports = {\r\n\tsend: function(recipients, subject, body, cb) {\r\n\t\tlogger.info(`Sending email to ${recipients} with subject ${subject}...`);\r\n\r\n\t\tlet mailOptions = {\r\n\t\t\tfrom: config.mailer.from,\r\n\t\t\tto: recipients,\r\n\t\t\tsubject: subject,\r\n\t\t\thtml: body\r\n\t\t};\r\n\r\n\t\tlet transporter;\r\n\t\tif (config.mailer.transport == \"smtp\") {\r\n\t\t\ttransporter = nodemailer.createTransport(config.mailer.smtp);\r\n\t\t}\r\n\t\telse if (config.mailer.transport == \"mailgun\") {\r\n\t\t\tlet mg = require(\"nodemailer-mailgun-transport\");\r\n\t\t\ttransporter = nodemailer.createTransport(mg({\r\n\t\t\t\tauth: {\r\n\t\t\t\t\tapi_key: config.mailer.mailgun.apiKey,\r\n\t\t\t\t\tdomain: config.mailer.mailgun.domain\r\n\t\t\t\t}\r\n\t\t\t}));\r\n\t\t}\r\n\t\telse if (config.mailer.transport == \"sendgrid\") {\r\n\t\t\tlet sgTransport = require(\"nodemailer-sendgrid-transport\");\r\n\t\t\ttransporter = nodemailer.createTransport(sgTransport({\r\n\t\t\t\tauth: {\r\n\t\t\t\t\tapi_key: config.mailer.sendgrid.apiKey\r\n\t\t\t\t}\r\n\t\t\t}));\r\n\t\t}\r\n\r\n\t\tif (transporter) {\r\n\t\t\ttransporter.use(\"compile\", htmlToText());\r\n\t\t\ttransporter.sendMail(mailOptions, (err, info) => {\r\n\t\t\t\tif (err)\r\n\t\t\t\t\tlogger.warn(\"Unable to send email: \", err);\r\n\t\t\t\telse\r\n\t\t\t\t\tlogger.info(\"Email message sent.\", info.response);\r\n\t\t\t\t\r\n\t\t\t\tif (cb)\r\n\t\t\t\t\tcb(err, info);\r\n\t\t\t});\r\n\t\t}\r\n\t\telse \r\n\t\t\tlogger.warn(\"Unable to send email! Invalid mailer transport: \" + config.mailer.transport);\r\n\t}\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./server/libs/mailer.js\n **/","module.exports = require(\"nodemailer\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"nodemailer\"\n ** module id = 88\n ** module chunks = 0\n **/","module.exports = require(\"nodemailer-html-to-text\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"nodemailer-html-to-text\"\n ** module id = 89\n ** module chunks = 0\n **/","module.exports = require(\"nodemailer-mailgun-transport\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"nodemailer-mailgun-transport\"\n ** module id = 90\n ** module chunks = 0\n **/","module.exports = require(\"nodemailer-sendgrid-transport\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"nodemailer-sendgrid-transport\"\n ** module id = 91\n ** module chunks = 0\n **/","\"use strict\";\r\n\r\nlet config \t\t= require(\"../config\");\r\nlet logger \t\t= require(\"../core/logger\");\r\n\r\nlet crypto \t\t= require(\"crypto\");\r\nlet async \t\t= require(\"async\");\r\n\r\nlet passport \t= require(\"passport\");\r\nlet express \t= require(\"express\");\r\n\r\nlet mailer \t\t= require(\"../libs/mailer\");\r\nlet User \t\t= require(\"../models/user\");\r\nlet Response \t= require(\"../core/response\");\r\n\r\n/**\r\n * Generate JSON or HTML response to client,\r\n * If browser accept JSON and not HTML, we send\r\n * JSON response. Else we redirect to an URL\r\n * which defined in `redirect` parameter.\r\n *\r\n * If req.flash contains errors, we send back error messages too.\r\n * \r\n * @param  {Object} req      request object\r\n * @param  {Object} res      response object\r\n * @param  {String} redirect redirect site URL.\r\n * @param  {Object} err      Error object.\r\n */\r\nfunction response(req, res, redirect, err) {\r\n\tif (req.accepts(\"json\") && !req.accepts(\"html\")) {\r\n\r\n\t\tlet flash = req.flash();\r\n\r\n\t\tif (flash && flash.error && flash.error.length > 0) {\r\n\r\n\t\t\tlet errMessage = flash.error[0].msg;\r\n\t\t\tResponse.json(res, null, err || Response.REQUEST_FAILED, errMessage);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet successData = \"OK\";\r\n\t\t\tif (flash && flash.info && flash.info.length > 0)\r\n\t\t\t\tsuccessData = flash.info[0].msg;\r\n\t\t\tResponse.json(res, successData);\r\n\t\t}\r\n\r\n\t}\r\n\telse if (redirect)\r\n\t\tres.redirect(redirect);\r\n}\r\n\r\nmodule.exports = function(app, db) {\r\n\r\n\tlet authRouter = express.Router();\r\n\r\n\tauthRouter.post(\"/local\", function(req, res, next) {\r\n\r\n\t\treq.assert(\"username\", req.t(\"UsernameCannotBeEmpty\")).notEmpty();\r\n\t\t//req.assert('email', req.t(\"EmailIsNotValid\")).isEmail();\r\n\t\t//req.assert('email', req.t(\"EmailCannotBeEmpty\")).notEmpty();\r\n\t\t//req.sanitize('email').normalizeEmail({ remove_dots: false });\r\n\r\n\t\t// Passwordless miatt\r\n\t\t//req.assert('password', req.t(\"PasswordCannotBeEmpty\")).notEmpty();\r\n\r\n\t\tlet errors = req.validationErrors();\r\n\t\tif (errors) {\r\n\t\t\treq.flash(\"error\", errors);\r\n\t\t\treturn response(req, res, \"/login\", Response.BAD_REQUEST);\r\n\t\t}\r\n\r\n\t\tif (req.body.password) {\r\n\t\t\t// Login with password\r\n\t\t\tpassport.authenticate(\"local\", function(err, user, info) { \r\n\t\t\t\tif (!user) {\r\n\t\t\t\t\treq.flash(\"error\", { msg: info.message });\r\n\t\t\t\t\treturn response(req, res, \"/login\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\treq.login(user, function(err) {\r\n\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\treq.flash(\"error\", { msg: err });\r\n\t\t\t\t\t\treturn response(req, res, \"/login\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Update user's record with login time\r\n\t\t\t\t\treq.user.lastLogin = Date.now();\r\n\t\t\t\t\treq.user.save(function() {\r\n\t\t\t\t\t\t// Remove sensitive data before login\r\n\t\t\t\t\t\treq.user.password = undefined;\r\n\t\t\t\t\t\treq.user.salt = undefined;\r\n\t\t\t\t\t\tresponse(req, res, \"/\");\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t});\r\n\r\n\t\t\t})(req, res, next);\r\n\r\n\t\t} else {\r\n\t\t\t// Passwordless login\r\n\t\t\tasync.waterfall([\r\n\r\n\t\t\t\tfunction generateToken(done) {\r\n\t\t\t\t\tcrypto.randomBytes(25, function(err, buf) {\r\n\t\t\t\t\t\tdone(err, err ? null : buf.toString(\"hex\"));\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\r\n\t\t\t\tfunction getUser(token, done) {\r\n\t\t\t\t\tlet username = req.body.username;\r\n\t\t\t\t\tUser.findOne({ username: username }, function(err, user) {\r\n\t\t\t\t\t\tif (!user) {\r\n\t\t\t\t\t\t\treq.flash(\"error\", { msg: req.t(\"UsernameIsNotAssociated\", { username: username}) });\r\n\t\t\t\t\t\t\treturn done(\"Invalid username \" + username);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tuser.passwordLessToken = token;\r\n\t\t\t\t\t\t//user.passwordLessTokenExpires = Date.now() + 3600000; // expire in 1 hour\r\n\t\t\t\t\t\tuser.save(function(err) {\r\n\t\t\t\t\t\t\tdone(err, token, user);\r\n\t\t\t\t\t\t});\t\t\t\t\t\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\r\n\t\t\t\tfunction sendResetEmailToUser(token, user, done) {\r\n\t\t\t\t\tlet subject = req.t(\"mailSubjectLogin\", config);\r\n\r\n\t\t\t\t\tres.render(\"mail/passwordLessLogin\", {\r\n\t\t\t\t\t\tname: user.fullName,\r\n\t\t\t\t\t\tloginLink: \"http://\" + req.headers.host + \"/passwordless/\" + token\r\n\t\t\t\t\t}, function(err, html) {\r\n\t\t\t\t\t\tif (err)\r\n\t\t\t\t\t\t\treturn done(err);\r\n\r\n\t\t\t\t\t\tmailer.send(user.email, subject, html, function(err, info) {\r\n\t\t\t\t\t\t\tif (err)\r\n\t\t\t\t\t\t\t\treq.flash(\"error\", { msg: req.t(\"UnableToSendEmail\", user) });\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\treq.flash(\"info\", { msg: req.t(\"emailSentWithMagicLink\", user) });\r\n\r\n\t\t\t\t\t\t\tdone(err);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t], function(err, user) {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\tlogger.error(err);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tresponse(req, res, \"back\");\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t});\r\n\r\n\t/**\r\n\t * Google authentication routes\r\n\t *\r\n\t * Available scopes: https://developers.google.com/+/web/api/rest/oauth#authorization-scopes\r\n\t */\r\n\tauthRouter.get(\"/google\", passport.authenticate(\"google\", {\r\n\t\tscope: \"profile email\"\r\n\t\t/*scope: [\r\n\t\t\t'https://www.googleapis.com/auth/plus.login',\r\n\t\t\t'https://www.googleapis.com/auth/plus.profile.emails.read'\r\n\t\t]*/\r\n\t}));\r\n\r\n\tauthRouter.get(\"/google/callback\", passport.authenticate(\"google\", {\r\n\t\tfailureRedirect: \"/login\"\r\n\t}), function(req, res) {\r\n\t\tres.redirect(\"/\");\r\n\t});\r\n\r\n\t/**\r\n\t * Facebook authentication routes\r\n\t */\r\n\tauthRouter.get(\"/facebook\", passport.authenticate(\"facebook\", {\r\n\t\tscope: [\"email\", \"user_location\"]\r\n\t}));\r\n\r\n\tauthRouter.get(\"/facebook/callback\", passport.authenticate(\"facebook\", {\r\n\t\tfailureRedirect: \"/login\"\r\n\t}), function(req, res) {\r\n\t\tres.redirect(\"/\");\r\n\t});\t\r\n\r\n\t/**\r\n\t * Twitter authentication routes\r\n\t */\r\n\tauthRouter.get(\"/twitter\", passport.authenticate(\"twitter\"));\r\n\r\n\tauthRouter.get(\"/twitter/callback\", passport.authenticate(\"twitter\", {\r\n\t\tfailureRedirect: \"/login\"\r\n\t}), function(req, res) {\r\n\t\tres.redirect(\"/\");\r\n\t});\t\r\n\r\n\t/**\r\n\t * Github authentication routes\r\n\t */\r\n\tauthRouter.get(\"/github\", passport.authenticate(\"github\", {\r\n\t\tscope: \"user:email\"\r\n\t}));\r\n\r\n\tauthRouter.get(\"/github/callback\", passport.authenticate(\"github\", {\r\n\t\tfailureRedirect: \"/login\"\r\n\t}), function(req, res) {\r\n\t\tres.redirect(\"/\");\r\n\t});\t\r\n\r\n\t// Add router to app\r\n\tapp.use(\"/auth\", authRouter);\r\n};\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./server/routes/auth.js\n **/","/* global __dirname */\r\n\"use strict\";\r\n\r\nlet logger \t\t\t= require(\"../core/logger\");\r\nlet config \t\t\t= require(\"../config\");\r\n\r\nlet path \t\t\t= require(\"path\");\r\nlet chalk \t\t\t= require(\"chalk\");\r\n\r\nif (!WEBPACK_BUNDLE) require('require-webpack-compat')(module, require);\r\n\r\n\r\nmodule.exports = function(app, db) {\r\n\tlogger.info(\"\");\r\n\tlogger.info(chalk.bold(\"Search routes...\"));\r\n\r\n\tfunction requireAll(r) { \r\n\t\treturn r.keys().map(function(module) {\r\n\t\t\tlogger.info(\"  Load\", path.relative(path.join(__dirname, \"modules\"), module), \"route...\");\r\n\t\t\tlet router = r(module);\r\n\t\t\trouter(app, db);\r\n\r\n\t\t\treturn router;\r\n\t\t})\r\n\t}\r\n\tvar modules = requireAll(require.context(\"./modules\", true, /routes\\.js$/));\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./server/applogic/routeHandlers.js\n **/","var map = {\n\t\"./counter/routes.js\": 95,\n\t\"./devices/routes.js\": 97,\n\t\"./posts/routes.js\": 106,\n\t\"./session/routes.js\": 107\n};\nfunction webpackContext(req) {\n\treturn __webpack_require__(webpackContextResolve(req));\n};\nfunction webpackContextResolve(req) {\n\treturn map[req] || (function() { throw new Error(\"Cannot find module '\" + req + \"'.\") }());\n};\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 94;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/applogic/modules routes\\.js$\n ** module id = 94\n ** module chunks = 0\n **/","\"use strict\";\r\n\r\n//let ROOT \t\t\t= \"../../../\";\r\n\r\nlet logger \t\t\t= require(\"../../../core/logger\");\r\nlet config \t\t\t= require(\"../../../config\");\r\n\r\nlet auth\t\t\t= require(\"../../../core/auth/helper\");\r\nlet store \t\t\t= require(\"./memstore\");\r\n\r\nmodule.exports = function(app, db) {\r\n\r\n\t// Get current value of counter\r\n\tapp.get(\"/counter\", auth.isAuthenticated, function(req, res) {\r\n\t\tres.send(\"Hello Counter! \" + store.counter);\r\n\t});\r\n\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./server/applogic/modules/counter/routes.js\n **/","\"use strict\";\r\n\r\nmodule.exports = {\r\n\tcounter: 0\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./server/applogic/modules/counter/memstore.js\n **/","\"use strict\";\r\n\r\n// let ROOT \t\t\t= \"../../../\";\r\n\r\nlet logger \t\t\t= require(\"../../../core/logger\");\r\nlet config \t\t\t= require(\"../../../config\");\r\n\r\nlet express\t\t\t= require(\"express\");\r\n\r\nlet auth\t\t\t= require(\"../../../core/auth/helper\");\r\nlet response\t\t= require(\"../../../core/response\");\r\nlet Device \t\t\t= require(\"./models/device\");\r\n\r\nlet io \t\t\t\t= require(\"../../../core/socket\");\r\n\r\nlet namespace = \"/devices\";\r\n\r\nmodule.exports = function(app, db) {\r\n\r\n\tlet router = express.Router();\r\n\r\n\t// Must be authenticated\r\n\trouter.use(auth.isAuthenticatedOrApiKey);\r\n\r\n\t// Must be admin role\r\n\t//router.use(auth.hasRole(\"admin\"));\r\n\r\n\trouter.route(\"/\")\r\n\t\t\r\n\t\t/**\r\n\t\t * Get all devices\r\n\t\t */\r\n\t\t.get((req, res) => {\r\n\t\t\r\n\t\t\tDevice.find({}).exec((err, docs) => {\r\n\r\n\t\t\t\t// Sample for multiple response by accept header\r\n\t\t\t\treturn res.format({\r\n\t\t\t\t\t// html() { res.render(\"devices\", { devices: items })}\r\n\t\t\t\t\tjson() {\r\n\t\t\t\t\t\tif (docs.length == 0) return response.json(res, []);\r\n\r\n\t\t\t\t\t\tlet items = docs.map((item) => item.toJSON());\r\n\r\n\t\t\t\t\t\treturn response.json(res, items);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t});\r\n\t\t})\r\n\t\t\r\n\t\t/**\r\n\t\t * Save a new device\r\n\t\t */\r\n\t\t.post((req, res) => {\r\n\r\n\t\t\treq.assert(\"name\", \"Device name cannot be blank!\").notEmpty();\r\n\r\n\t\t\tlet errors = req.validationErrors();\r\n\t\t\tif (errors)\r\n\t\t\t\treturn response.json(res, null, response.BAD_REQUEST, errors);\r\n\t\t\r\n\r\n\t\t\tlet device = new Device({\r\n\t\t\t\taddress: req.body.address,\r\n\t\t\t\ttype: req.body.type,\r\n\t\t\t\tname: req.body.name,\r\n\t\t\t\tdescription: req.body.description,\r\n\t\t\t\tstatus: req.body.status\r\n\t\t\t});\r\n\r\n\t\t\tdevice.save((err) => {\r\n\t\t\t\tif (err)\r\n\t\t\t\t\treturn response.json(res, null, response.SERVER_ERROR, err);\r\n\r\n\t\t\t\tlet json = device.toJSON();\r\n\r\n\t\t\t\tif (io.namespaces[namespace])\r\n\t\t\t\t\tio.namespaces[namespace].emit(\"new\", json);\r\n\r\n\t\t\t\treturn response.json(res, json);\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t/**\r\n\t * Resolve the deviceID URL parameter. First decode the hashed ID \r\n\t * and search device by ID in database\r\n\t */\r\n\trouter.param(\"deviceID\", function(req, res, next, deviceID) {\r\n\t\tlet id = Device.schema.methods.decodeID(deviceID);\r\n\t\tif (id == null || id == \"\")\r\n\t\t\treturn response.json(res, null, response.BAD_REQUEST, \"Invalid Device ID!\");\r\n\r\n\t\tDevice.findById(id, (err, doc) => {\r\n\t\t\tif (err)\r\n\t\t\t\treturn response.json(res, null, response.BAD_REQUEST, err);\r\n\t\t\t\r\n\t\t\tif (!doc) \r\n\t\t\t\treturn response.json(res, null, response.NOT_FOUND, \"Device not found!\");\r\n\r\n\t\t\treq.device = doc;\r\n\t\t\tnext();\r\n\t\t});\r\n\t});\r\n\r\n\t/**\r\n\t * Handle deviceID specific routes\r\n\t */\r\n\trouter.route(\"/:deviceID\")\r\n\r\n\t\t// Call every request method\r\n\t\t.all((req, res, next) => {\r\n\r\n\t\t\tnext();\r\n\t\t})\r\n\r\n\t\t/**\r\n\t\t * Get a device\r\n\t\t */\r\n\t\t.get((req, res) => {\r\n\t\t\treturn response.json(res, req.device.toJSON());\r\n\t\t})\r\n\r\n\t\t/**\r\n\t\t * Modify a device\r\n\t\t */\r\n\t\t.put((req, res) => {\r\n\t\t\tif (req.body.address != null)\r\n\t\t\t\treq.device.address = req.body.address;\r\n\r\n\t\t\tif (req.body.type != null)\r\n\t\t\t\treq.device.type = req.body.type;\r\n\r\n\t\t\tif (req.body.name != null)\r\n\t\t\t\treq.device.name = req.body.name;\r\n\r\n\t\t\tif (req.body.description != null)\r\n\t\t\t\treq.device.description = req.body.description;\r\n\r\n\t\t\tif (req.body.status != null)\r\n\t\t\t\treq.device.status = req.body.status;\r\n\r\n\t\t\treq.device.save((err) => {\r\n\t\t\t\tif (err)\r\n\t\t\t\t\treturn response.json(res, null, response.BAD_REQUEST, err);\r\n\r\n\t\t\t\tlet json = req.device.toJSON();\r\n\r\n\t\t\t\tif (io.namespaces[namespace])\r\n\t\t\t\t\tio.namespaces[namespace].emit(\"update\", json);\r\n\r\n\t\t\t\treturn response.json(res, json);\r\n\t\t\t});\r\n\t\t})\r\n\r\n\t\t/**\r\n\t\t * Delete a device\r\n\t\t */\r\n\t\t.delete((req, res) => {\r\n\t\t\tDevice.remove({ _id: req.device.id }, (err) => {\r\n\t\t\t\tif (err)\r\n\t\t\t\t\treturn response.json(res, null, response.BAD_REQUEST, err);\r\n\r\n\t\t\t\tif (io.namespaces[namespace])\r\n\t\t\t\t\tio.namespaces[namespace].emit(\"remove\", req.device.toJSON());\r\n\r\n\t\t\t\treturn response.json(res);\r\n\t\t\t});\r\n\r\n\t\t});\r\n\r\n\r\n\t// API versioning\r\n\tapp.use(\"/v1\" + namespace, router);\r\n\r\n\t// v1 is the default route\r\n\tapp.use(namespace, router);\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./server/applogic/modules/devices/routes.js\n **/","\"use strict\";\r\n\r\nlet logger \t\t\t= require(\"./logger\");\r\nlet config \t\t\t= require(\"../config\");\r\nlet secrets \t\t= require(\"./secrets\");\r\n\r\nlet\tpath \t\t\t= require(\"path\");\r\nlet\tfs \t\t\t\t= require(\"fs\");\r\nlet\thttp \t\t\t= require(\"http\");\r\nlet _ \t\t\t\t= require(\"lodash\");\r\n\r\nlet\tcookieParser \t= require(\"cookie-parser\");\r\nlet\tpassport \t\t= require(\"passport\");\r\nlet\tsocketio \t\t= require(\"socket.io\");\r\nlet\tsession \t\t= require(\"express-session\");\r\nlet\tMongoStore \t\t= require(\"connect-mongo\")(session);\r\n\r\nlet socketHandlers  = require(\"../applogic/socketHandlers\");\r\n\r\nlet self = {\r\n\r\n\t/**\r\n\t * IO namespaces\r\n\t * @type {Object}\r\n\t */\r\n\tnamespaces: {},\r\n\r\n\t/** \r\n\t * List of logged in online users\r\n\t * @type {Array}\r\n\t */\r\n\tonlineUsers: [],\r\n\r\n\t/**\r\n\t * Init Socket.IO module and load socket handlers \r\n\t * from applogic\r\n\t * \r\n\t * @param  {Object} app Express App\r\n\t * @param  {Object} db  MongoDB connection\r\n\t */\r\n\tinit(app, db) {\r\n\r\n\t\t// Create a new HTTP server\r\n\t\tlet server = http.createServer(app);\r\n\r\n\t\t// Create a MongoDB storage object\r\n\t\tlet mongoStore = new MongoStore({\r\n\t\t\tmongooseConnection: db.connection,\r\n\t\t\tcollection: config.sessions.collection,\r\n\t\t\tautoReconnect: true\r\n\t\t});\r\n\r\n\t\t// Create a new Socket.io server\r\n\t\tlet IO = socketio(server);\r\n\r\n\t\t// Add common handler to the root namespace\r\n\t\tself.initNameSpace(\"/\", IO, mongoStore);\r\n\t\tIO.on(\"connection\", function (socket) {\r\n\t\t\tsocket.on(\"welcome\", function(msg) {\r\n\t\t\t\tlogger.info(\"Incoming welcome message from \" + socket.request.user.username + \":\", msg);\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t// Initialize every socket handler\r\n\t\tsocketHandlers.handlers.forEach((Handler) => {\r\n\t\t\tif (!Handler || !Handler.namespace) return;\r\n\r\n\t\t\tlet io = self.namespaces[Handler.namespace];\r\n\t\t\tif (io == null) {\r\n\t\t\t\tio = IO.of(Handler.namespace);\r\n\t\t\t\tself.initNameSpace(Handler.namespace, io, mongoStore, Handler.role);\r\n\t\t\t\t\r\n\t\t\t\tif (_.isFunction(Handler.init))\r\n\t\t\t\t\tHandler.init(io);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tapp.io = self;\r\n\r\n\t\treturn server;\r\n\t},\r\n\r\n\t/**\r\n\t * Initialize IO namespace. Apply authentication middleware\r\n\t * \r\n\t * @param  {String} ns         Name of namespace\r\n\t * @param  {Object} io         IO instance\r\n\t * @param  {Object} mongoStore Mongo Session store\r\n\t */\r\n\tinitNameSpace(ns, io, mongoStore, roleRequired) {\r\n\r\n\t\t// Intercept Socket.io's handshake request\r\n\t\tio.use(function (socket, next) {\r\n\t\t\t// Use the 'cookie-parser' module to parse the request cookies\r\n\t\t\tcookieParser(secrets.sessionSecret)(socket.request, {}, function (err) {\r\n\t\t\t\t// Get the session id from the request cookies\r\n\t\t\t\tlet sessionId = socket.request.signedCookies ? socket.request.signedCookies[config.sessions.name] : undefined;\r\n\r\n\t\t\t\tif (!sessionId) {\r\n\t\t\t\t\tlogger.warn(\"sessionId was not found in socket.request\");\r\n\t\t\t\t\treturn next(new Error(\"sessionId was not found in socket.request\"), false);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Use the mongoStorage instance to get the Express session information\r\n\t\t\t\tmongoStore.get(sessionId, function (err, session) {\r\n\t\t\t\t\tif (err) return next(err, false);\r\n\t\t\t\t\tif (!session) return next(new Error(\"session was not found for \" + sessionId), false);\r\n\r\n\t\t\t\t\t// Set the Socket.io session information\r\n\t\t\t\t\tsocket.request.session = session;\r\n\r\n\t\t\t\t\t// Set the socketID to session\r\n\t\t\t\t\tsession.socket = socket.id;\r\n\t\t\t\t\tmongoStore.set(sessionId, session);\r\n\r\n\t\t\t\t\t// Use Passport to populate the user details\r\n\t\t\t\t\tpassport.initialize()(socket.request, {}, function () {\r\n\t\t\t\t\t\tpassport.session()(socket.request, {}, function () {\r\n\t\t\t\t\t\t\tif (socket.request.user) {\r\n\t\t\t\t\t\t\t\tlet user = socket.request.user;\r\n\r\n\t\t\t\t\t\t\t\tif (roleRequired) {\r\n\t\t\t\t\t\t\t\t\tif (user.roles && user.roles.indexOf(roleRequired) !== -1) \r\n\t\t\t\t\t\t\t\t\t\tnext(null, true);\t\r\n\t\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\t\tlogger.warn(`Websocket user has no access to this namespace '${ns}'!`);\r\n\t\t\t\t\t\t\t\t\t\tnext(new Error(`You have NO access to this namespace '${ns}'!`), false);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tnext(null, true);\r\n\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tlogger.warn(\"Websocket user is not authenticated!\");\r\n\t\t\t\t\t\t\t\tnext(new Error(\"User is not authenticated! Please login first!\"), false);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t// Add an event listener to the 'connection' event\r\n\t\tio.on(\"connection\", function (socket) {\r\n\t\t\tself.addOnlineUser(socket.request.user);\r\n\t\t\tlogger.debug(\"WS client connected to namespace \" + (io.name || \"root\") + \"! User: \" + socket.request.user.username);\r\n\r\n\t\t\tsocket.on(\"disconnect\", function() {\r\n\t\t\t\tself.removeOnlineUser(socket.request.user);\r\n\t\t\t\tlogger.debug(\"WS client disconnected from namespace \" + (io.name || \"root\") + \"!\");\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tself.namespaces[ns] = io;\r\n\t},\r\n\r\n\tnsEmit(namespace, command, data) {\r\n\t\tif (self.namespaces[namespace]) {\r\n\t\t\tself.namespaces[namespace].emit(command, data);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t},\r\n\r\n\taddOnlineUser(user) {\r\n\t\tself.removeOnlineUser(user);\r\n\t\tself.onlineUsers.push(user);\r\n\t},\r\n\r\n\tremoveOnlineUser(user) {\r\n\t\t_.remove(self.onlineUsers, function(u) { return u._id == user._id; });\r\n\t}\r\n\r\n};\r\n\r\nmodule.exports = self;\n\n\n/** WEBPACK FOOTER **\n ** ./server/core/socket.js\n **/","module.exports = require(\"socket.io\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"socket.io\"\n ** module id = 99\n ** module chunks = 0\n **/","\"use strict\";\r\n\r\nlet logger \t\t\t= require(\"../core/logger\");\r\nlet config \t\t\t= require(\"../config\");\r\n\r\nlet path \t\t\t= require(\"path\");\r\nlet chalk \t\t\t= require(\"chalk\");\r\n\r\nif (!WEBPACK_BUNDLE) require('require-webpack-compat')(module, require);\r\n\r\n\r\nlogger.info(\"\");\r\nlogger.info(chalk.bold(\"Search socket handlers...\"));\r\n\r\nfunction requireAll(r) { \r\n\treturn r.keys().map(function(module) {\r\n\t\tlogger.info(\"  Load\", path.relative(path.join(__dirname, \"modules\"), module), \"handler...\");\r\n\t\treturn r(module);\r\n\t})\r\n}\r\n\r\nmodule.exports.handlers = requireAll(require.context(\"./modules\", true, /socket\\.js$/));\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./server/applogic/socketHandlers.js\n **/","var map = {\n\t\"./counter/socket.js\": 102,\n\t\"./devices/socket.js\": 103,\n\t\"./posts/socket.js\": 104\n};\nfunction webpackContext(req) {\n\treturn __webpack_require__(webpackContextResolve(req));\n};\nfunction webpackContextResolve(req) {\n\treturn map[req] || (function() { throw new Error(\"Cannot find module '\" + req + \"'.\") }());\n};\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 101;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/applogic/modules socket\\.js$\n ** module id = 101\n ** module chunks = 0\n **/","\"use strict\";\r\n\r\n// let ROOT \t\t\t= \"../../../\";\r\n\r\nlet logger \t\t\t= require(\"../../../core/logger\");\r\nlet config \t\t\t= require(\"../../../config\");\r\n\r\nlet store \t\t\t= require(\"./memstore\");\r\n\r\nmodule.exports = {\r\n\r\n\tnamespace: \"/counter\",\r\n\r\n\tinit(io) {\r\n\t\tio.on(\"connection\", (socket) => {\r\n\r\n\t\t\tsocket.on(\"changed\", function(msg) {\r\n\t\t\t\tstore.counter = msg;\r\n\t\t\t\tlogger.info(socket.request.user.username + \" increment the counter to \", store.counter);\r\n\t\t\t\tsocket.broadcast.emit(\"changed\", store.counter);\r\n\t\t\t});\r\n\r\n\t\t\tsocket.emit(\"changed\", store.counter);\r\n\r\n\t\t});\r\n\t}\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./server/applogic/modules/counter/socket.js\n **/","\"use strict\";\r\n\r\n// let ROOT \t\t\t= \"../../../\";\r\n\r\nlet logger \t\t\t= require(\"../../../core/logger\");\r\nlet config \t\t\t= require(\"../../../config\");\r\n\r\nmodule.exports = {\r\n\r\n\tnamespace: \"/devices\",\r\n\t//role: \"admin\",\r\n\r\n\tinit(io) {\r\n\t\tio.on(\"connection\", (socket) => {\r\n\r\n\t\t\t// Handle imcoming websocket messages\r\n\t\t\t// \r\n\t\t\t// For example:\r\n\t\t\t// \r\n\t\t\t// \tsocket.on(\"message\", function(payload) {\r\n\t\t\t// \t\tconsole.log(payload + \" received from \" + socket.request.user.username);\r\n\t\t\t// \t}\r\n\t\t\t// \t\r\n\t\t\t\r\n\t\t});\t\t\r\n\t}\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./server/applogic/modules/devices/socket.js\n **/","\"use strict\";\r\n\r\n// let ROOT \t\t\t= \"../../../\";\r\n\r\nlet logger \t\t\t= require(\"../../../core/logger\");\r\nlet config \t\t\t= require(\"../../../config\");\r\nlet moduleConfig\t= require(\"./module.json\");\r\n\r\nmodule.exports = {\r\n\r\n\tnamespace: moduleConfig.namespace,\r\n\t//role: \"admin\",\r\n\r\n\tinit(io) {\r\n\t\tio.on(\"connection\", (socket) => {\r\n\r\n\t\t\t// Handle imcoming websocket messages\r\n\t\t\t// \r\n\t\t\t// For example:\r\n\t\t\t// \r\n\t\t\t// \tsocket.on(\"message\", function(payload) {\r\n\t\t\t// \t\tconsole.log(payload + \" received from \" + socket.request.user.username);\r\n\t\t\t// \t}\r\n\t\t\t// \t\r\n\t\t\t\r\n\t\t});\t\t\r\n\t}\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./server/applogic/modules/posts/socket.js\n **/","module.exports = {\n\t\"namespace\": \"/posts\"\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/applogic/modules/posts/module.json\n ** module id = 105\n ** module chunks = 0\n **/","\"use strict\";\r\n\r\n// let ROOT \t\t\t= \"../../../\";\r\n\r\nlet logger \t\t\t= require(\"../../../core/logger\");\r\nlet config \t\t\t= require(\"../../../config\");\r\n\r\nlet moduleConfig\t= require(\"./module.json\");\r\n\r\nlet express\t\t\t= require(\"express\");\r\nlet async \t\t\t= require(\"async\");\r\n\r\nlet auth\t\t\t= require(\"../../../core/auth/helper\");\r\nlet response\t\t= require(\"../../../core/response\");\r\nlet Post \t\t\t= require(\"./models/post\");\r\n\r\nlet io \t\t\t\t= require(\"../../../core/socket\");\r\n\r\nmodule.exports = function(app, db) {\r\n\r\n\tlet router = express.Router();\r\n\r\n\t// Must be authenticated\r\n\trouter.use(auth.isAuthenticatedOrApiKey);\r\n\r\n\t// Must be user role\r\n\trouter.use(auth.hasRole(\"user\"));\r\n\r\n\t/**\r\n\t * Upvote a post\r\n\t */\r\n\trouter.get(\"/upvote/:postID\", (req, res) => {\r\n\r\n\t\tasync.waterfall([\r\n\r\n\t\t\tfunction checkUserInIsUpVoters(done) {\r\n\t\t\t\tif (req.post.upVoters.indexOf(req.user.id) !== -1) \r\n\t\t\t\t\tdone(req.t(\"YouHaveAlreadyVotedThisPost\"));\r\n\t\t\t\telse\r\n\t\t\t\t\tdone();\r\n\t\t\t},\r\n\r\n\t\t\tfunction removeUserFromDownVoters(done) {\r\n\t\t\t\tif (req.post.downVoters.indexOf(req.user.id) !== -1) \r\n\t\t\t\t\tPost.findByIdAndUpdate(req.post.id, { $pull: { downVoters: req.user.id }, $inc: { votes: 1 } }, { \"new\": true }, done);\r\n\t\t\t\telse\r\n\t\t\t\t\tdone(null, null);\r\n\t\t\t},\r\n\r\n\t\t\tfunction addUserToUpVoters(doc, done) {\r\n\t\t\t\tPost.findByIdAndUpdate(req.post.id, { $addToSet: { upVoters: req.user.id }, $inc: { votes: 1 } }, { \"new\": true }, done);\r\n\t\t\t},\r\n\r\n\t\t\tfunction populateAuthorOfPost(doc, done) {\r\n\t\t\t\tdoc.populate(\"author\", \"fullName code email gravatar\", done);\r\n\t\t\t}\r\n\r\n\t\t], (err, doc) => {\r\n\t\t\tif (err)\r\n\t\t\t\treturn response.json(res, null, response.BAD_REQUEST, err);\r\n\r\n\t\t\tlet json = doc.toJSON();\r\n\r\n\t\t\tif (io.namespaces[moduleConfig.namespace])\r\n\t\t\t\tio.namespaces[moduleConfig.namespace].emit(\"update\", json);\r\n\r\n\t\t\treturn response.json(res, json);\r\n\t\t});\r\n\r\n\t});\r\n\r\n\t/**\r\n\t * Downvote a post\r\n\t */\r\n\trouter.get(\"/downvote/:postID\", (req, res) => {\r\n\t\tPromise.resolve().then(() => {\t\t\r\n\t\t\t// Check user is on downVoters\r\n\t\t\tif (req.post.downVoters.indexOf(req.user.id) !== -1) \r\n\t\t\t\tthrow new Error(req.t(\"YouHaveAlreadyVotedThisPost\"));\r\n\r\n\t\t}).then(() => {\r\n\t\t\t// Remove user from upVoters if it is on the list\r\n\t\t\tif (req.post.upVoters.indexOf(req.user.id) !== -1) \r\n\t\t\t\treturn Post.findByIdAndUpdate(req.post.id, { $pull: { upVoters: req.user.id }, $inc: { votes: -1 } }, { \"new\": true });\r\n\r\n\t\t}).then(() => {\r\n\t\t\t// Add user to downVoters\r\n\t\t\treturn Post.findByIdAndUpdate(req.post.id, { $addToSet: { downVoters: req.user.id } , $inc: { votes: -1 }}, { \"new\": true });\r\n\r\n\t\t}).then((doc) => {\r\n\t\t\t// Populate author\r\n\t\t\treturn Post.populate(doc, { path: \"author\", select: \"fullName code email gravatar\"});\r\n\r\n\t\t}).then((doc) => {\r\n\t\t\t// Send back the response\r\n\t\t\tlet json = doc.toJSON();\r\n\r\n\t\t\tif (io.namespaces[moduleConfig.namespace])\r\n\t\t\t\tio.namespaces[moduleConfig.namespace].emit(\"update\", json);\r\n\r\n\t\t\tresponse.json(res, json);\r\n\r\n\t\t}).catch((err)=> {\r\n\t\t\t// Send error response\r\n\t\t\tresponse.json(res, null, response.BAD_REQUEST, err.message);\r\n\t\t});\r\n\r\n\t});\t\r\n\r\n\t/**\r\n\t * Get all posts\r\n\t */\r\n\trouter.get(\"/:viewMode/:sort\", (req, res) => {\r\n\r\n\t\tlet filter = {};\r\n\r\n\t\tif (req.params.viewMode == \"my\") \r\n\t\t\tfilter.author = req.user.id;\r\n\r\n\t\tlet query = Post.find(filter);\r\n\r\n\t\tswitch(req.params.sort) {\r\n\t\tcase \"hot\": query.sort({ votes: -1 }); break;\r\n\t\tcase \"mostviewed\": query.sort({ views: -1 }); break;\r\n\t\tdefault: query.sort({ createdAt: -1 });\r\n\t\t}\r\n\r\n\t\tif (req.query.limit)\r\n\t\t\tquery.limit(req.query.limit || 20);\r\n\t\r\n\t\tquery.populate(\"author\", \"fullName code email gravatar\");\r\n\r\n\t\tquery.exec((err, docs) => {\r\n\t\t\tif (!docs || docs.length == 0) return response.json(res, []);\r\n\r\n\t\t\tlet items = docs.map((item) => item.toJSON());\r\n\t\t\treturn response.json(res, items);\r\n\t\t});\r\n\t});\r\n\r\n\trouter.post(\"/\", (req, res) => {\r\n\r\n\t\treq.assert(\"title\", req.t(\"PostTitleCannotBeEmpty\")).notEmpty();\r\n\t\treq.assert(\"content\", req.t(\"PostContentCannotBeEmpty\")).notEmpty();\r\n\r\n\t\tlet errors = req.validationErrors();\r\n\t\tif (errors)\r\n\t\t\treturn response.json(res, null, response.BAD_REQUEST, errors);\r\n\t\r\n\r\n\t\tlet post = new Post({\r\n\t\t\ttitle: req.body.title,\r\n\t\t\tcontent: req.body.content,\r\n\t\t\tauthor: req.user.id\r\n\t\t});\r\n\r\n\t\tpost.save((err) => {\r\n\t\t\tif (err)\r\n\t\t\t\treturn response.json(res, null, response.SERVER_ERROR, err);\r\n\r\n\t\t\tpost.populate(\"author\", \"fullName code email gravatar\", (err) => {\r\n\r\n\t\t\t\tlet json = post.toJSON();\r\n\r\n\t\t\t\tif (io.namespaces[moduleConfig.namespace])\r\n\t\t\t\t\tio.namespaces[moduleConfig.namespace].emit(\"new\", json);\r\n\r\n\t\t\t\treturn response.json(res, json);\r\n\t\t\t});\r\n\t\t});\r\n\t});\r\n\r\n\t/**\r\n\t * Resolve the postID URL parameter. First decode the hashed ID \r\n\t * and search post by ID in database\r\n\t */\r\n\trouter.param(\"postID\", function(req, res, next, postID) {\r\n\t\tlet id = Post.schema.methods.decodeID(postID);\r\n\t\tif (id == null || id == \"\")\r\n\t\t\treturn response.json(res, null, response.BAD_REQUEST, req.t(\"InvalidPostID\"));\r\n\r\n\t\tPost.findById(id, (err, doc) => {\r\n\t\t\tif (err)\r\n\t\t\t\treturn response.json(res, null, response.BAD_REQUEST, err);\r\n\t\t\t\r\n\t\t\tif (!doc) \r\n\t\t\t\treturn response.json(res, null, response.NOT_FOUND, req.t(\"PostNotFound\"));\r\n\r\n\t\t\tdoc.populate(\"author\", \"fullName code email gravatar\", (err) => {\r\n\r\n\t\t\t\treq.post = doc;\r\n\t\t\t\tnext();\r\n\r\n\t\t\t});\r\n\t\t});\r\n\t});\r\n\r\n\t/**\r\n\t * Handle postID specific routes\r\n\t */\r\n\trouter.route(\"/:postID\")\r\n\r\n\t\t// Call every request method\r\n\t\t.all((req, res, next) => {\r\n\r\n\t\t\tnext();\r\n\t\t})\r\n\r\n\t\t/**\r\n\t\t * Get a post\r\n\t\t */\r\n\t\t.get((req, res) => {\r\n\t\t\t// Increment view counter\r\n\t\t\tPost.findByIdAndUpdate(req.post.id, { $inc: { views: 1 } }).exec();\r\n\r\n\t\t\treturn response.json(res, req.post.toJSON());\r\n\t\t})\r\n\r\n\t\t/**\r\n\t\t * Modify a post\r\n\t\t */\r\n\t\t.put((req, res) => {\r\n\t\t\treq.assert(\"title\", req.t(\"PostTitleCannotBeEmpty\")).notEmpty();\r\n\t\t\treq.assert(\"content\", req.t(\"PostContentCannotBeEmpty\")).notEmpty();\r\n\r\n\t\t\tlet errors = req.validationErrors();\r\n\t\t\tif (errors)\r\n\t\t\t\treturn response.json(res, null, response.BAD_REQUEST, errors);\r\n\r\n\t\t\tif (req.post.author.id != req.user.id) {\r\n\t\t\t\treturn response.json(res, null, response.BAD_REQUEST, req.t(\"OnlyAuthorEditPost\"));\r\n\t\t\t}\r\n\r\n\t\t\treq.post.title = req.body.title;\r\n\t\t\treq.post.content = req.body.content;\r\n\r\n\t\t\treq.post.save((err) => {\r\n\t\t\t\tif (err)\r\n\t\t\t\t\treturn response.json(res, null, response.BAD_REQUEST, err);\r\n\r\n\t\t\t\tlet json = req.post.toJSON();\r\n\r\n\t\t\t\tif (io.namespaces[moduleConfig.namespace])\r\n\t\t\t\t\tio.namespaces[moduleConfig.namespace].emit(\"update\", json);\r\n\r\n\t\t\t\treturn response.json(res, json);\r\n\t\t\t});\r\n\t\t})\r\n\r\n\t\t/**\r\n\t\t * Delete a post\r\n\t\t */\r\n\t\t.delete((req, res) => {\r\n\r\n\t\t\tif (req.post.author.id != req.user.id) {\r\n\t\t\t\treturn response.json(res, null, response.BAD_REQUEST, req.t(\"OnlyAuthorDeletePost\"));\r\n\t\t\t}\r\n\r\n\t\t\tPost.remove({ _id: req.post.id }, (err) => {\r\n\t\t\t\tif (err)\r\n\t\t\t\t\treturn response.json(res, null, response.BAD_REQUEST, err);\r\n\r\n\t\t\t\tif (io.namespaces[moduleConfig.namespace])\r\n\t\t\t\t\tio.namespaces[moduleConfig.namespace].emit(\"remove\", req.post.toJSON());\r\n\r\n\t\t\t\treturn response.json(res);\r\n\t\t\t});\r\n\r\n\t\t});\r\n\r\n\r\n\t// API versioning\r\n\tapp.use(\"/v1/posts\", router);\r\n\r\n\t// v1 is the default route\r\n\tapp.use(\"/posts\", router);\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./server/applogic/modules/posts/routes.js\n **/","\"use strict\";\r\n\r\n// let ROOT \t\t\t= \"../../../\";\r\n\r\nlet logger \t\t\t= require(\"../../../core/logger\");\r\nlet config \t\t\t= require(\"../../../config\");\r\n\r\nlet _ \t\t\t\t= require(\"lodash\");\r\nlet express\t\t\t= require(\"express\");\r\n\r\nlet auth\t\t\t= require(\"../../../core/auth/helper\");\r\nlet response\t\t= require(\"../../../core/response\");\r\n\r\nlet io\t\t\t\t= require(\"../../../core/socket\");\r\nlet User\t\t\t= require(\"../../../models/user\");\r\n\r\nlet namespace = \"/session\";\r\n\r\nfunction pickUserProps(user) {\r\n\treturn _.pick(user, [\r\n\t\t\"fullName\",\r\n\t\t\"email\",\r\n\t\t\"username\",\r\n\t\t\"roles\",\r\n\t\t\"lastLogin\"\r\n\t]);\r\n}\r\n\r\nmodule.exports = function(app, db) {\r\n\r\n\tlet router = express.Router();\r\n\r\n\t// Must be authenticated\r\n\trouter.use(auth.isAuthenticatedOrApiKey);\r\n\r\n\t// Get current logged in user\r\n\trouter.get(\"/me\", function(req, res) {\r\n\t\tresponse.json(res, req.user.pick([\r\n\t\t\t\"code\",\r\n\t\t\t\"fullName\",\r\n\t\t\t\"email\",\r\n\t\t\t\"username\",\r\n\t\t\t\"roles\",\r\n\t\t\t\"lastLogin\",\r\n\t\t\t\"gravatar\",\r\n\r\n\t\t\t\"provider\",\r\n\t\t\t\"profile\",\r\n\t\t\t\"socialLinks\",\r\n\t\t\t\"apiKey\",\r\n\t\t\t\"passwordLess\"\r\n\t\t]));\r\n\t});\r\n\r\n\trouter.get(\"/onlineUsers\", function(req, res) {\r\n\t\tlet users = _.map(io.onlineUsers, function(user) {\r\n\t\t\treturn user.pick();\r\n\t\t});\r\n\r\n\t\tresponse.json(res, users);\r\n\t});\r\n\r\n\t// API versioning\r\n\tapp.use(\"/v1\" + namespace, router);\r\n\r\n\t// v1 is the default route\r\n\tapp.use(namespace, router);\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./server/applogic/modules/session/routes.js\n **/","\"use strict\";\r\n\r\nlet config \t\t\t= require(\"../config\");\r\nlet logger \t\t\t= require(\"../core/logger\");\r\nlet auth \t\t\t= require(\"../core/auth/helper\");\r\nlet ApolloServer \t= require(\"apollo-server\").apolloServer;\r\nlet graphqlTools \t= require(\"graphql-tools\");\r\nlet Schema \t\t\t= require(\"../schema\").schema;\r\nlet Resolvers \t\t= require(\"../schema\").resolvers;\r\n\r\nmodule.exports = function(app, db) {\r\n\r\n\tlet schema = graphqlTools.makeExecutableSchema({ typeDefs: Schema, resolvers: Resolvers });\r\n\t//console.log(schema);\r\n\r\n\t// Register graphql server\r\n\tapp.use(\"/graphql\", auth.isAuthenticatedOrApiKey, ApolloServer( (req) => {\r\n\t\tconst query = req.query.query || req.body.query;\r\n\t\tif (query && query.length > 2000) {\r\n\t\t\t// None of our app's queries are this long\r\n\t\t\t// Probably indicates someone trying to send an overly expensive query\r\n\t\t\tthrow new Error(\"Query too large.\");\r\n\t\t}\t\r\n\t\tlogger.debug(\"GraphQL query:\", query);\r\n\r\n\t\treturn {\r\n\t\t\tgraphiql: config.isDevMode(),\r\n\t\t\tpretty: config.isDevMode(),\r\n\t\t\tprintErrors: config.isDevMode(),\r\n\t\t\tschema: schema,\r\n\t\t\t//schema: Schema,\r\n\t\t\t//resolvers: Resolvers,\r\n\t\t\tcontext: {\r\n\t\t\t\treq: req,\r\n\t\t\t\tt: req.t,\r\n\t\t\t\tuser: req.user,\r\n\t\t\t\tsession: req.session\r\n\t\t\t}\r\n\t\t};\r\n\t}));\r\n\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./server/routes/graphql.js\n **/","module.exports = require(\"apollo-server\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"apollo-server\"\n ** module id = 109\n ** module chunks = 0\n **/","module.exports = require(\"graphql-tools\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"graphql-tools\"\n ** module id = 110\n ** module chunks = 0\n **/","\"use strict\";\r\n\r\nlet logger \t\t\t= require(\"../core/logger\");\r\nlet config \t\t\t= require(\"../config\");\r\nlet graphqlTools \t= require(\"graphql-tools\");\r\nlet path \t\t\t= require(\"path\");\r\nlet chalk \t\t\t= require(\"chalk\");\r\nlet _ \t\t\t\t= require(\"lodash\");\r\n\r\nif (!WEBPACK_BUNDLE) require('require-webpack-compat')(module, require);\r\n\r\n\r\nlet moduleQueries = [];\r\nlet moduleTypeDefinitions = [];\r\nlet moduleMutations = [];\r\nlet moduleResolvers = [];\r\n\r\nlogger.info(\"\");\r\nlogger.info(chalk.bold(\"Search GraphQL schemas...\"));\r\n\r\nfunction requireAll(r) { \r\n\treturn r.keys().map(function(module) {\r\n\t\tlogger.info(\"  Load\", path.relative(path.join(__dirname, \"..\", \"applogic\", \"modules\"), module), \"schema...\");\t\t\r\n\t\treturn r(module);\r\n\t})\r\n}\r\nlet schemas = requireAll(require.context(\"./\", true, /schema\\.js$/));\r\nschemas = schemas.concat(requireAll(require.context(\"../applogic/modules\", true, /schema\\.js$/)));\r\n\r\n// --- LOAD MODULE SCHEMAS\r\n\r\n// Load schema files\r\nschemas.forEach((moduleSchema) => {\r\n\tmoduleQueries.push(moduleSchema.schema.query);\r\n\tmoduleTypeDefinitions.push(moduleSchema.schema.typeDefinitions);\r\n\tmoduleMutations.push(moduleSchema.schema.mutation);\r\n\r\n\tmoduleResolvers.push(moduleSchema.resolvers);\r\n});\r\n\r\n\r\n// --- MERGE TYPE DEFINITONS\r\n\r\nconst schema = `\r\n\r\nscalar Timestamp\r\n\r\ntype Query {\r\n\t${moduleQueries.join(\"\\n\")}\r\n}\r\n\r\n${moduleTypeDefinitions.join(\"\\n\")}\r\n\r\ntype Mutation {\r\n\t${moduleMutations.join(\"\\n\")}\r\n}\r\n\r\nschema {\r\n  query: Query\r\n  mutation: Mutation\r\n}\r\n`;\r\n\r\n// --- MERGE RESOLVERS\r\n\r\nfunction mergeModuleResolvers(baseResolvers) {\r\n\tmoduleResolvers.forEach((module) => {\r\n\t\tbaseResolvers = _.merge(baseResolvers, module);\r\n\t});\r\n\r\n\treturn baseResolvers;\r\n}\r\n\r\nmodule.exports = {\r\n\tschema: [schema],\r\n\tresolvers: mergeModuleResolvers({\r\n\r\n\t\tTimestamp: {\r\n\t\t\t__parseValue(value) {\r\n\t\t\t\treturn new Date(value);\r\n\t\t\t},\r\n\t\t\t__serialize(value) {\r\n\t\t\t\treturn value.getTime();\r\n\t\t\t},\r\n\t\t\t__parseLiteral(ast) {\r\n\t\t\t\tconsole.log(ast); // ???? when will be called it?\r\n\t\t\t\t/*if (ast.kind === Kind.INT) {\r\n\t\t\t\t\treturn parseInt(ast.value, 10);\r\n\t\t\t\t}*/\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t})\r\n};\r\n\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./server/schema/index.js\n **/","var map = {\n\t\"./user.schema.js\": 113\n};\nfunction webpackContext(req) {\n\treturn __webpack_require__(webpackContextResolve(req));\n};\nfunction webpackContextResolve(req) {\n\treturn map[req] || (function() { throw new Error(\"Cannot find module '\" + req + \"'.\") }());\n};\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 112;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/schema schema\\.js$\n ** module id = 112\n ** module chunks = 0\n **/","\"use strict\";\r\n\r\n// let ROOT \t\t\t= \"../\";\r\n\r\nlet logger \t\t\t= require(\"../core/logger\");\r\nlet config \t\t\t= require(\"../config\");\r\n\r\nlet _ \t\t\t\t= require(\"lodash\");\r\nlet C \t\t\t\t= require(\"../core/constants\");\r\n\r\nlet Post \t\t\t= require(\"../applogic/modules/posts/models/post\");\r\nlet User \t\t\t= require(\"../models/user\");\r\n\r\nlet helper\t\t\t= require(\"../libs/schema-helper\");\r\n\r\nlet io \t\t\t\t= require(\"../core/socket\");\r\n\r\nconst query = `\r\n\tusers(limit: Int, offset: Int, sort: String): [User]\r\n\tuser(id: Int, code: String): User\r\n`;\r\n\r\nconst typeDefinitions = `\r\ntype User {\r\n\tid: Int!\r\n\tcode: String!\r\n\tfullName: String\r\n\temail: String\r\n\tusername: String\r\n\tprovider: String\r\n\troles: [String]\r\n\tverified: Boolean\r\n\tgravatar: String\r\n\tlastLogin: Timestamp\r\n\tposts(limit: Int, offset: Int, sort: String): [Post]\r\n}\r\n`;\r\n\r\nconst mutation = `\r\n`;\r\n\r\nconst resolvers = {\r\n\tQuery: {\r\n\r\n\t\tusers(root, args, context) {\r\n\t\t\tif (!helper.hasRole(context, C.ROLE_ADMIN)) \r\n\t\t\t\treturn null;\r\n\r\n\t\t\treturn helper.applyLimitOffsetSort(User.find({}), args).exec();\r\n\t\t},\r\n\r\n\t\tuser(root, args, context) {\r\n\t\t\tif (!helper.hasRole(context, C.ROLE_ADMIN))\r\n\t\t\t\treturn null;\r\n\r\n\t\t\tlet id = args.id;\r\n\r\n\t\t\tif (args.code)\r\n\t\t\t\tid = User.schema.methods.decodeID(args.code);\r\n\r\n\t\t\tif (id)\r\n\t\t\t\treturn User.findById(id).exec();\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tUser: {\r\n\t\tposts(author, args, context) {\r\n\t\t\tif (!helper.hasRole(context, C.ROLE_USER))\r\n\t\t\t\treturn null;\r\n\t\t\t\t\r\n\t\t\treturn helper.applyLimitOffsetSort(Post.find({ author: author.id }), args).exec();\r\n\t\t}\r\n\t},\r\n\r\n\tMutation: {\r\n\t}\r\n\r\n};\r\n\r\nmodule.exports = {\r\n\tschema: {\r\n\t\tquery,\r\n\t\ttypeDefinitions,\r\n\t\tmutation\r\n\t},\r\n\tresolvers\r\n};\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./server/schema/user.schema.js\n **/","function applyLimitOffsetSort(query, args) {\r\n\tif (args.limit)\r\n\t\tquery.limit(args.limit);\r\n\r\n\tif (args.offset)\r\n\t\tquery.skip(args.offset);\r\n\r\n\tif (args.sort)\r\n\t\tquery.sort(args.sort);\r\n\r\n\treturn query;\r\n}\r\n\r\nfunction hasRole(context, role) {\r\n\treturn context.user.roles.indexOf(role) != -1;\r\n}\r\n\r\n\r\nmodule.exports = {\r\n\tapplyLimitOffsetSort,\r\n\thasRole\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./server/libs/schema-helper.js\n **/","var map = {\n\t\"./devices/schema.js\": 116,\n\t\"./posts/schema.js\": 117\n};\nfunction webpackContext(req) {\n\treturn __webpack_require__(webpackContextResolve(req));\n};\nfunction webpackContextResolve(req) {\n\treturn map[req] || (function() { throw new Error(\"Cannot find module '\" + req + \"'.\") }());\n};\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 115;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/applogic/modules schema\\.js$\n ** module id = 115\n ** module chunks = 0\n **/","\"use strict\";\r\n\r\n// let ROOT \t\t\t= \"../../../\";\r\n\r\nlet logger \t\t\t= require(\"../../../core/logger\");\r\nlet config \t\t\t= require(\"../../../config\");\r\n\r\n//let moduleConfig\t= require(\"./module.json\");\r\n\r\nlet _ \t\t\t\t= require(\"lodash\");\r\nlet async \t\t\t= require(\"async\");\r\nlet C \t\t\t\t= require(\"../../../core/constants\");\r\n\r\nlet Device \t\t\t= require(\"./models/device\");\r\n\r\nlet helper\t\t\t= require(\"../../../libs/schema-helper\");\r\n\r\n\r\nconst query = `\r\n\tdevices(limit: Int, offset: Int, sort: String): [Device]\r\n\tdevice(id: Int, code: String): Device\r\n`;\r\n\r\nconst typeDefinitions = `\r\ntype Device {\r\n\tid: Int!\r\n\tcode: String!\r\n\taddress: String\r\n\ttype: String\r\n\tname: String\r\n\tdescription: String\r\n\tstatus: Int\r\n\tlastCommunication: Timestamp\r\n}\r\n`;\r\n\r\nconst mutation = ``;\r\n\r\nconst resolvers = {\r\n\tQuery: {\r\n\t\tdevices(root, args, context) {\r\n\t\t\tif (!helper.hasRole(context, C.ROLE_USER))\r\n\t\t\t\treturn null;\r\n\r\n\t\t\treturn helper.applyLimitOffsetSort(Device.find({}), args).exec();\r\n\t\t},\r\n\r\n\t\tdevice(root, args, context) {\r\n\t\t\tif (!helper.hasRole(context, C.ROLE_USER))\r\n\t\t\t\treturn null;\r\n\r\n\t\t\tlet id = args.id;\r\n\r\n\t\t\tif (args.code)\r\n\t\t\t\tid = Device.schema.methods.decodeID(args.code);\r\n\r\n\t\t\tif (id)\r\n\t\t\t\treturn Device.findById(id).exec();\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tMutation: {\r\n\t}\r\n\r\n};\r\n\r\nmodule.exports = {\r\n\tschema: {\r\n\t\tquery,\r\n\t\ttypeDefinitions,\r\n\t\tmutation\r\n\t},\r\n\tresolvers\r\n};\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./server/applogic/modules/devices/schema.js\n **/","\"use strict\";\r\n\r\n// let ROOT \t\t\t= \"../../../\";\r\n\r\nlet logger \t\t\t= require(\"../../../core/logger\");\r\nlet config \t\t\t= require(\"../../../config\");\r\n\r\nlet moduleConfig\t= require(\"./module.json\");\r\n\r\nlet _ \t\t\t\t= require(\"lodash\");\r\nlet async \t\t\t= require(\"async\");\r\nlet C \t\t\t\t= require(\"../../../core/constants\");\r\n\r\nlet Post \t\t\t= require(\"./models/post\");\r\nlet User \t\t\t= require(\"../../../models/user\");\r\n\r\nlet io \t\t\t\t= require(\"../../../core/socket\");\r\n\r\nlet helper\t\t\t= require(\"../../../libs/schema-helper\");\r\n\r\nconst query = `\r\n\tposts(limit: Int, offset: Int, sort: String): [Post]\r\n\tpost(id: Int, code: String): Post\r\n`;\r\n\r\nconst typeDefinitions = `\r\ntype Post {\r\n\tid: Int!\r\n\tcode: String!\r\n\ttitle: String\r\n\tcontent: String\r\n\tauthor: User!\r\n\tviews: Int\r\n\tvoters(limit: Int, offset: Int, sort: String): [User]\r\n\tupVoters(limit: Int, offset: Int, sort: String): [User]\r\n\tdownVoters(limit: Int, offset: Int, sort: String): [User]\r\n\tvotes: Int,\r\n\tcreatedAt: Timestamp\r\n\tupdatedAt: Timestamp\r\n}\r\n`;\r\n\r\nconst mutation = `\r\n\tupVote(postID: Int!): Post\r\n\tdownVote(postID: Int!): Post\r\n`;\r\n\r\nconst resolvers = {\r\n\tQuery: {\r\n\t\tposts(root, args, context) {\r\n\t\t\tif (!helper.hasRole(context, C.ROLE_USER))  \r\n\t\t\t\treturn null;\r\n\r\n\t\t\treturn helper.applyLimitOffsetSort(Post.find({}), args).exec();\r\n\t\t},\r\n\r\n\t\tpost(root, args, context) {\r\n\t\t\tif (!helper.hasRole(context, C.ROLE_USER))\r\n\t\t\t\treturn null;\r\n\r\n\t\t\tlet id = args.id;\r\n\r\n\t\t\tif (args.code)\r\n\t\t\t\tid = Post.schema.methods.decodeID(args.code);\r\n\r\n\t\t\tif (id)\r\n\t\t\t\treturn Post.findById(id).exec();\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tPost: {\r\n\t\tauthor(post, args, context) {\r\n\t\t\tif (!helper.hasRole(context, C.ROLE_USER))\r\n\t\t\t\treturn null;\r\n\r\n\t\t\treturn User.findById(post.author).exec();\r\n\t\t},\r\n\r\n\t\tupVoters(post, args, context) {\r\n\t\t\tif (!helper.hasRole(context, C.ROLE_USER))\r\n\t\t\t\treturn null;\r\n\r\n\t\t\treturn helper.applyLimitOffsetSort(User.find({ _id: { $in: post.upVoters} }), args).exec();\r\n\t\t},\r\n\r\n\t\tdownVoters(post, args, context) {\r\n\t\t\tif (!helper.hasRole(context, C.ROLE_USER))\r\n\t\t\t\treturn null;\r\n\r\n\t\t\treturn helper.applyLimitOffsetSort(User.find({ _id: { $in: post.downVoters} }), args).exec();\r\n\t\t},\r\n\r\n\t\tvoters(post, args, context) {\r\n\t\t\tif (!helper.hasRole(context, C.ROLE_USER))\r\n\t\t\t\treturn null;\r\n\r\n\t\t\treturn helper.applyLimitOffsetSort(User.find({ _id: { $in: post.upVoters.concat(post.downVoters) } }), args).exec();\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tMutation: {\r\n\r\n\t\tupVote(root, args, context) {\r\n\t\t\tlet user = context.user;\r\n\t\t\tlet postID = args.postID;\r\n\r\n\t\t\tif (!helper.hasRole(context, C.ROLE_USER)) \r\n\t\t\t\treturn Promise.reject(\"Must has 'user' role for this function!\");\r\n\r\n\t\t\treturn new Promise( (resolve, reject) => {\r\n\t\t\t\tasync.waterfall([\r\n\r\n\t\t\t\t\tfunction getPostById(done) {\r\n\t\t\t\t\t\tPost.findById(postID, done);\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\tfunction checkUserInIsUpVoters(post, done) {\r\n\t\t\t\t\t\tif (post.upVoters.indexOf(user.id) !== -1) \r\n\t\t\t\t\t\t\tdone(context.t(\"YouHaveAlreadyVotedThisPost\"));\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tdone(null, post);\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\tfunction removeUserFromDownVoters(post, done) {\r\n\t\t\t\t\t\tif (post.downVoters.indexOf(user.id) !== -1) \r\n\t\t\t\t\t\t\tPost.findByIdAndUpdate(postID, { $pull: { downVoters: user.id }, $inc: { votes: 1 } }, { \"new\": true }, done);\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tdone(null, null);\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\tfunction addUserToUpVoters(doc, done) {\r\n\t\t\t\t\t\tPost.findByIdAndUpdate(postID, { $addToSet: { upVoters: user.id }, $inc: { votes: 1 } }, { \"new\": true }, done);\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\tfunction populateAuthorOfPost(doc, done) {\r\n\t\t\t\t\t\tdoc.populate(\"author\", \"fullName code email gravatar\", done);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t], (err, doc) => {\r\n\t\t\t\t\tif (err)\r\n\t\t\t\t\t\treturn reject(err);\r\n\r\n\t\t\t\t\tlet json = doc.toJSON();\r\n\r\n\t\t\t\t\tio.nsemit(\"update\", json);\r\n\r\n\t\t\t\t\tresolve(doc);\r\n\t\t\t\t});\r\n\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tdownVote(root, args, context) {\r\n\t\t\tlet user = context.user;\r\n\t\t\tlet postID = args.postID;\r\n\r\n\r\n\t\t\treturn Promise.resolve().then(() => {\t\t\r\n\t\t\t\tif (!helper.hasRole(context, C.ROLE_USER)) \r\n\t\t\t\t\tthrow new Error(\"Must has 'user' role for this function!\");\r\n\t\t\t}).then(() => {\r\n\t\t\t\treturn Post.findById(postID);\r\n\t\t\t}).then((post) => {\r\n\t\t\t\t// Check user is on downVoters\r\n\t\t\t\tif (post.downVoters.indexOf(user.id) !== -1) \r\n\t\t\t\t\tthrow new Error(context.t(\"YouHaveAlreadyVotedThisPost\"));\r\n\t\t\t\telse\r\n\t\t\t\t\treturn post;\r\n\r\n\t\t\t}).then((post) => {\r\n\t\t\t\t// Remove user from upVoters if it is on the list\r\n\t\t\t\tif (post.upVoters.indexOf(user.id) !== -1) \r\n\t\t\t\t\treturn Post.findByIdAndUpdate(post.id, { $pull: { upVoters: user.id }, $inc: { votes: -1 } }, { \"new\": true });\r\n\r\n\t\t\t}).then((post) => {\r\n\t\t\t\t// Add user to downVoters\r\n\t\t\t\treturn Post.findByIdAndUpdate(post.id, { $addToSet: { downVoters: user.id } , $inc: { votes: -1 }}, { \"new\": true });\r\n\r\n\t\t\t}).then((doc) => {\r\n\t\t\t\t// Populate author\r\n\t\t\t\treturn Post.populate(doc, { path: \"author\", select: \"fullName code email gravatar\"});\r\n\r\n\t\t\t}).then((doc) => {\r\n\t\t\t\t// Send back the response\r\n\t\t\t\tlet json = doc.toJSON();\r\n\r\n\t\t\t\tio.nsemit(\"update\", json);\r\n\r\n\t\t\t\treturn doc;\r\n\r\n\t\t\t});\r\n\r\n\t\t}\r\n\t}\r\n};\r\n\r\nmodule.exports = {\r\n\tschema: {\r\n\t\tquery,\r\n\t\ttypeDefinitions,\r\n\t\tmutation\r\n\t},\r\n\tresolvers\r\n};\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./server/applogic/modules/posts/schema.js\n **/","\"use strict\";\r\n\r\nlet config  = require(\"../config\");\r\nlet logger  = require(\"../core/logger\");\r\n\r\nlet response  = require(\"../core/response\");\r\n\r\nmodule.exports = function(app, db) {\r\n\r\n\tapp.use(function(err, req, res, next) {\r\n\t\tif (!err) {\r\n\t\t\treturn next();\r\n\t\t}\r\n\r\n\t\tlogger.error(err.stack);\r\n\t\tres.status(err.status || 500);\r\n\r\n\t\t// Respond with html page\r\n\t\tif (req.accepts(\"html\")) {\r\n\t\t\treturn res.render(\"500\", {\r\n\t\t\t\turl: req.originalUrl,\r\n\t\t\t\terror: err\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Respond with json\r\n\t\tif (req.accepts(\"json\")) {\r\n\t\t\treturn response.json(res, null, response.SERVER_ERROR);\r\n\t\t}\r\n\t});\r\n\r\n\tapp.use(function(req, res) {\r\n\t\tres.status(404);\r\n\t\tif (!config.isTestMode())\r\n\t\t\tlogger.warn(\"404 error! URL:\", req.url);\r\n\r\n\t\t// Respond with html page\r\n\t\tif (req.accepts(\"html\")) {\r\n\t\t\tlet err = new Error(\"404 Page Not Found\");\r\n\t\t\terr.status = 404;\r\n\t\t\treturn res.render(\"404\", {\r\n\t\t\t\turl: req.originalUrl,\r\n\t\t\t\terror: err\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Respond with json\r\n\t\tif (req.accepts(\"json\")) {\r\n\t\t\treturn response.json(res, null, response.NOT_FOUND);\r\n\t\t}\r\n\t});\r\n\r\n};\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./server/routes/errors.js\n **/","\"use strict\";\r\n\r\nlet logger = require(\"./logger\");\r\nlet config = require(\"../config\");\r\n\r\nlet moment = require(\"moment\");\r\nlet chalk = require(\"chalk\");\r\nlet Agenda = require(\"agenda\");\r\n\r\nlet User = require(\"../models/user\");\r\n\r\nlet agenda = new Agenda({\r\n\tdb: {\r\n\t\taddress: config.db.uri,\r\n\t\tcollection: \"agendaJobs\"\r\n\t},\r\n\tprocessEvery: config.agendaTimer || \"one minute\"\r\n});\r\n\r\nagenda.on(\"fail\", function(err, job) {\r\n\treturn logger.error(\"Job failed with error: \" + err.message);\r\n});\r\n\r\n/**\r\n * Remove unverified account after 24 hours\r\n */\r\n\r\nagenda.define(\"removeUnverifiedAccounts\", function(job, done) {\r\n\tlogger.debug(\"Running 'removeUnverifiedAccounts' process...\");\r\n\ttry {\r\n\r\n\t\tUser.remove({ \r\n\t\t\tcreatedAt: {\r\n\t\t\t\t$lte: moment().subtract(1, \"day\").toDate()\r\n\t\t\t},\r\n\t\t\tverified: false\r\n\t\t}, (err, count) => {\r\n\t\t\tif (count > 0)\r\n\t\t\t\tlogger.warn(chalk.bold.red(count + \" unverified and expired account removed!\"));\r\n\r\n\t\t\tdone();\r\n\t\t});\r\n\t} catch (error) {\r\n\t\tlogger.error(\"Job running exception!\");\r\n\t\tlogger.error(error);\r\n\t\treturn done(error);\r\n\t}\r\n});\r\n\r\nagenda.on(\"ready\", function() {\r\n\tif (config.isTestMode())\r\n\t\treturn;\r\n\r\n\tagenda.every(\"8 hours\", \"removeUnverifiedAccounts\"); \r\n\tagenda.start();\r\n\tlogger.info(chalk.yellow(\"Agenda started!\"));\r\n});\r\n\r\nmodule.exports = agenda;\n\n\n/** WEBPACK FOOTER **\n ** ./server/core/agenda.js\n **/","module.exports = require(\"agenda\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"agenda\"\n ** module id = 120\n ** module chunks = 0\n **/","\"use strict\";\r\n\r\nlet config    = require(\"../config\");\r\nlet logger    = require(\"../core/logger\");\r\nlet chalk \t  = require(\"chalk\");\r\nlet moment    = require(\"moment\");\r\nlet mongoose  = require(\"mongoose\");\r\nlet agenda    = require(\"../core/agenda\");\r\n\r\nlet gracefulExit = function() {\r\n\tif (mongoose.connection.readyState === 0) {\r\n\t\treturn process.exit(0);\r\n\t}\r\n\tmongoose.connection.close(function() {\r\n\t\treturn agenda.stop(function() {\r\n\t\t\tlogger.info();\r\n\t\t\tlogger.info(chalk.bold(\"---------------------[ Server stopped at %s Uptime: %s ]---------------------------\"), moment().format(\"YYYY-MM-DD HH:mm:ss.SSS\"), moment.duration(process.uptime() * 1000).humanize());\r\n\t\t\treturn process.exit(0);\r\n\t\t});\r\n\t});\r\n};\r\n\r\nprocess.on(\"SIGINT\", gracefulExit).on(\"SIGTERM\", gracefulExit);\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./server/libs/gracefulExit.js\n **/","\"use strict\";\r\n\r\nlet os = require(\"os\");\r\nlet clui = require(\"clui\");\r\nlet pretty = require(\"pretty-bytes\");\r\nlet logger = require(\"../core/logger\");\r\n\r\nmodule.exports = function() {\r\n\tlet Gauge = clui.Gauge;\r\n\tlet total = os.totalmem();\r\n\tlet free = os.freemem();\r\n\tlet used = total - free;\r\n\tlet human = pretty(free);\r\n\r\n\tlogger.info(\"CPU:\\t\\tArch: \" + (os.arch()) + \", Cores: \" + (os.cpus().length));\r\n\tlogger.info(\"Memory:\\t\\t\" + Gauge(used, total, 20, total * 0.8, human + \" free\"));\r\n\tlogger.info(\"OS:\\t\\t\" + (os.platform()) + \" (\" + (os.type()) + \")\");\r\n};\r\n\r\n/*let mailer = require(\"./mailer\");\r\n\r\nsetTimeout(function() {\r\n\tmailer.send(\"bd0fa9fb42-4967aa@inbox.mailtrap.io\", \"Boilerplate test message\", \"<h1>Boilerplate test message</h1><p>Hello NodeMailer</p>\");\r\n}, 5 * 1000);\r\n*/\n\n\n/** WEBPACK FOOTER **\n ** ./server/libs/sysinfo.js\n **/","module.exports = require(\"os\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"os\"\n ** module id = 123\n ** module chunks = 0\n **/","module.exports = require(\"clui\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"clui\"\n ** module id = 124\n ** module chunks = 0\n **/","module.exports = require(\"pretty-bytes\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"pretty-bytes\"\n ** module id = 125\n ** module chunks = 0\n **/"],"sourceRoot":""}