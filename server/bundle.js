!function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={exports:{},id:o,loaded:!1};return e[o].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";global.WEBPACK_BUNDLE=!1;var o=n(1),r=n(12),i=n(21),s=n(9);r.info(),r.info(s.bold("---------------------[ Server starting at %s ]---------------------------"),i().format("YYYY-MM-DD HH:mm:ss.SSS")),r.info(),r.info(s.bold("Application root path: ")+global.rootPath);var a=(n(22),n(23)()),u=n(39)(a);n(119);n(121),u.listen(o.port,function(){r.info(""),r.info(o.app.title+" v"+o.app.version+" application started!"),r.info("----------------------------------------------"),r.info("Environment:\t"+s.underline.bold(process.env.NODE_ENV)),r.info("IP:\t\t"+o.ip),r.info("Port:\t\t"+o.port),r.info("Database:\t\t"+o.db.uri),r.info(""),n(122)(),r.info("----------------------------------------------")}),t=e.exports=u},function(e,t,n){(function(t){"use strict";var o=n(2),r=n(3);global.rootPath=o.normalize(o.join(t,"..",".."));var i=void 0;i=process.argv.length>0?process.argv[1]:o.dirname(process.argv[0]),global.rootPath=o.normalize(o.join(o.dirname(i),"..")),e.exports={isDevMode:function(){return!process.env.NODE_ENV||"development"===process.env.NODE_ENV},isProductionMode:function(){return"production"===process.env.NODE_ENV},isTestMode:function(){return"test"===process.env.NODE_ENV}};var s={};e.exports.isTestMode()?(console.log("Load test config..."),s=n(4)):e.exports.isProductionMode()&&(console.log("Load production config..."),s=n(6)),e.exports=r.defaultsDeep(e.exports,s,n(7))}).call(t,"server\\config")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("lodash")},function(e,t,n){"use strict";var o=n(5);e.exports={app:{title:o.name+" [Test mode]"},test:!0,db:{uri:process.env.MONGO_URI||"mongodb://localhost/"+o.config.dbName+"-test",options:{user:"",pass:""}}}},function(e,t){e.exports=require("../package.json")},function(e,t,n){"use strict";var o=n(5);e.exports={app:{},ip:process.env.SERVER_IP||"127.0.0.1",db:{uri:process.env.MONGO_URI||"mongodb://localhost/"+o.config.dbName,options:{user:"",pass:""}}}},function(e,t,n){"use strict";var o=n(2),r=n(5),i=n(8);e.exports={app:{title:r.title,version:r.version,description:r.description,keywords:r.keywords.join(","),url:"http://localhost:"+(process.env.PORT||3e3)+"/",contactEmail:"hello@vem-app.com"},ip:"0.0.0.0",port:process.env.PORT||3e3,rootPath:global.rootPath,dataFolder:o.join(global.rootPath,"data"),uploadLimit:2097152,sessions:{cookie:{maxAge:6048e5,httpOnly:!0,secure:!1},name:"sessionId",collection:"sessions"},test:!1,mailer:{from:"noreply@bolierplate-app.com",transport:"smtp",smtp:{host:"mailtrap.io",port:2525,auth:{user:"367335eaa82697636",pass:"e5a76af9b056d0"}}},db:{uri:process.env.MONGO_URI||"mongodb://localhost/"+r.config.dbName+"-dev",options:{user:"",pass:"",server:{socketOptions:{keepAlive:1}}}},logging:{graylog:{enabled:!0,servers:[{host:"192.168.0.174",port:12201}]},papertrail:{enabled:null!=i.papertrail,host:null!=i.papertrail?i.papertrail.host:null,port:null!=i.papertrail?i.papertrail.port:null,level:"debug",program:"vem"},logentries:{enabled:null!=i.logentries,token:null!=i.logentries?i.logentries.token:null},loggly:{enabled:null!=i.loggly,token:null!=i.loggly?i.loggly.token:null,subdomain:null!=i.loggly?i.loggly.subdomain:null},logsene:{enabled:null!=i.logsene,token:null!=i.logsene?i.logsene.token:null},logzio:{enabled:null!=i.logzio,token:null!=i.logzio?i.logzio.token:null}},disableSignUp:!1,verificationRequired:!0,agendaTimer:"one minute"}},function(e,t,n){(function(t){"use strict";var o=n(9),r=n(10),i=n(2),s=n(11),a=i.join(t,"..","..","secrets.json");if(!r.existsSync(a)){var u={hashSecret:s.url64(32),sessionSecret:s.url64(32)};r.writeFileSync(a,JSON.stringify(u,null,2)),console.warn(o.green.bold("Secret file created!"))}e.exports=JSON.parse(r.readFileSync(a))}).call(t,"server\\core")},function(e,t){e.exports=require("chalk")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("secret-utils")},function(e,t,n){"use strict";var o=n(13),r=n(2),i=n(10),s=n(1),a=(n(8),r.join(s.rootPath,"logs"));i.existsSync(a)||i.mkdir(a,function(e){if(e)throw e});var u=[new o.transports.Console({level:"debug",colorize:!0,prettyPrint:!0,handleExceptions:"production"===process.env.NODE_ENV})];if(s.logging.logentries.enabled&&s.logging.logentries.token){console.log("Logentries log transport enabled!");n(14);u.push(new o.transports.Logentries({level:"debug",token:s.logging.logentries.token}))}if(s.logging.papertrail.enabled){console.log("Papertrail log transport enabled!"),n(15).Papertrail;var c=new o.transports.Papertrail(s.logging.papertrail);u.push(c)}"production"===process.env.NODE_ENV&&u.push(new(n(16))({filename:r.join(a,"server.log"),level:"info",timestamp:!0,json:!0,handleExceptions:!0}),new o.transports.File({filename:r.join(a,"exceptions.log"),level:"error",timestamp:!0,json:!1,prettyPrint:!0,handleExceptions:!0,humanReadableUnhandledException:!0}));var l=new o.Logger({level:"debug",transports:u,exitOnError:!1});if(s.logging.loggly.enabled&&s.logging.loggly.token){console.log("Loggly log transport enabled!");n(17);l.add(o.transports.Loggly,{inputToken:s.logging.loggly.token,subdomain:s.logging.loggly.subdomain,tags:["vem-server"],json:!0})}if(s.logging.logsene.enabled&&s.logging.logsene.token){console.log("Logsene log transport enabled!");var d=n(18);l.add(d,{type:"vem-server",token:s.logging.logsene.token})}if(s.logging.logzio.enabled&&s.logging.logzio.token){console.log("Logz.io log transport enabled!");var f=n(19);l.add(f,{token:s.logging.logzio.token})}if(s.logging.graylog.enabled){console.log("Graylog log transport enabled! Servers: "+JSON.stringify(s.logging.graylog.servers));var p=n(20);l.add(p,{name:"Graylog",level:"debug",graylog:{servers:s.logging.graylog.servers,facility:"vem"}})}e.exports=l},function(e,t){e.exports=require("winston")},function(e,t){e.exports=require("le_node")},function(e,t){e.exports=require("winston-papertrail")},function(e,t){e.exports=require("winston-daily-rotate-file")},function(e,t){e.exports=require("winston-loggly-bulk")},function(e,t){e.exports=require("winston-logsene")},function(e,t){e.exports=require("winston-logzio")},function(e,t){e.exports=require("winston-graylog2")},function(e,t){e.exports=require("moment")},function(e,t,n){"use strict";var o=n(12),r=n(1),i=n(10);i.existsSync(r.dataFolder)||i.mkdir(r.dataFolder,function(e){if(e)throw e}),r.isDevMode()&&(o.info("Loaded configuration:"),o.info(r),o.info())},function(e,t,n){"use strict";var o=n(12),r=n(1),i=n(9),s=n(24),a=n(25);e.exports=function(){var e=void 0;return o.info(),s.Promise=global.Promise,1!==s.connection.readyState?(o.info("Connecting to Mongo "+r.db.uri+"..."),e=s.connect(r.db.uri,r.db.options,function(e){return e?(o.error("Could not connect to MongoDB!"),o.error(e)):void s.set("debug",r.isDevMode())}),s.connection.on("error",function(e){return o.error("Could not connect to MongoDB!"),o.error(e)}),a.initialize(e),s.connection.once("open",function(){o.info(i.yellow.bold("Mongo DB connected.")),o.info(),r.isTestMode()&&(o.warn("Drop test database..."),s.connection.db.dropDatabase()),r.isProduction||n(26)()})):(o.info("Mongo already connected."),e=s),e}},function(e,t){e.exports=require("mongoose")},function(e,t){e.exports=require("mongoose-auto-increment")},function(e,t,n){"use strict";var o=n(12),r=(n(1),n(3),n(27)),i=(n(29)(),n(30));e.exports=function(){i.find({}).exec(function(e,t){if(0===t.length){o.warn("Load default Users to DB...");var n=new i({fullName:"Administrator",email:"admin@boilerplate-app.com",username:"admin",password:"admin1234",provider:"local",roles:["admin","user"],verified:!0});n.save(function(e){if(e)return o.warn("Unable to create default admin user!");var t=new i({fullName:"Test User",email:"test@boilerplate-app.com",username:"test",password:"test1234",provider:"local",roles:["user"],verified:!0,apiKey:r()});t.save(function(){return e?o.warn("Unable to create default admin user!"):void o.info("Default users created!")})})}}),n(36)()}},function(e,t,n){"use strict";var o=n(28),r=new o(256,o.BASE62);e.exports=function(){return r.generate()}},function(e,t){e.exports=require("uuid-token-generator")},function(e,t){e.exports=require("fakerator")},function(e,t,n){"use strict";var o=(n(1),n(12),n(31)),r=(n(10),n(2),n(3)),i=n(32),s=n(33),a=(n(23),n(24)),u=a.Schema,c=n(34)("users"),l=n(25),d={timestamps:!0,toObject:{virtuals:!0},toJSON:{virtuals:!0}},f=function(e){return"local"!==this.provider&&!this.updated||e.length},p=function(e){return"local"!==this.provider||e&&e.length>=6},m=new u({fullName:{type:String,trim:!0,"default":"",validate:[f,"Please fill in your full name"]},email:{type:String,trim:!0,unique:!0,index:!0,lowercase:!0,"default":"",validate:[f,"Please fill in your email"],match:[/.+\@.+\..+/,"Please fill a valid email address"]},username:{type:String,unique:!0,index:!0,required:"Please fill in a username",trim:!0},password:{type:String,"default":"",validate:[p,"Password should be longer"]},passwordLess:{type:Boolean,"default":!1},passwordLessToken:{type:String},provider:{type:String,"default":"local"},profile:{},socialLinks:{facebook:{type:String,unique:!0,sparse:!0},twitter:{type:String,unique:!0,sparse:!0},google:{type:String,unique:!0,sparse:!0},github:{type:String,unique:!0,sparse:!0}},roles:{type:[{type:String,"enum":[o.ROLE_ADMIN,o.ROLE_USER,o.ROLE_GUEST]}],"default":[o.ROLE_USER]},resetPasswordToken:String,resetPasswordExpires:Date,verified:{type:Boolean,"default":!1},verifyToken:{type:String},apiKey:{type:String,unique:!0,index:!0,sparse:!0},lastLogin:{type:Date},metadata:{}},d);m.virtual("code").get(function(){return this.encodeID()}),m.plugin(l.plugin,{model:"User",startAt:1}),m.pre("save",function(e){var t=this;return t.isModified("password")?void s.genSalt(10,function(n,o){s.hash(t.password,o,null,function(n,o){t.password=o,e()})}):e()}),m.methods.comparePassword=function(e,t){s.compare(e,this.password,function(e,n){t(e,n)})},m.virtual("gravatar").get(function(){if(!this.email)return"https://gravatar.com/avatar/?s=64&d=wavatar";var e=i.createHash("md5").update(this.email).digest("hex");return"https://gravatar.com/avatar/"+e+"?s=64&d=wavatar"}),m.methods.encodeID=function(){return c.encodeHex(this._id)},m.methods.decodeID=function(e){return c.decodeHex(e)},m.methods.pick=function(e,t){return r.pick(t||this.toJSON(),e||["code","fullName","email","username","roles","lastLogin","gravatar"])};var g=a.model("User",m);e.exports=g},function(e,t){"use strict";e.exports={ROLE_ADMIN:"admin",ROLE_USER:"user",ROLE_GUEST:"guest"}},function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("bcrypt-nodejs")},function(e,t,n){"use strict";var o=n(35),r=n(8);e.exports=function(e,t){return new o(e+r.hashSecret,t||10)}},function(e,t){e.exports=require("hashids")},function(e,t,n){"use strict";var o=n(12),r=(n(1),n(3)),i=(n(27),n(29)()),s=n(30),a=n(37),u=n(38);e.exports=function(){a.find({}).exec(function(e,t){0===t.length&&(o.warn("Load default Devices to DB..."),r.times(5,function(){var e=new a({address:i.internet.ip(),type:i.random.arrayElement(["rasperry","odroid","nanopi","pc"]),name:i.populate("#{names.firstName}'s device"),description:i.lorem.sentence(),status:i.random["boolean"]("80")?1:0,lastCommunication:Date.now()});e.save(function(e){if(e)return o.warn("Unable to create default devices!",e)})}))}),u.find({}).exec(function(e,t){0===t.length&&(o.warn("Load default Posts to DB..."),s.find({}).lean().select("_id").exec(function(e,t){r.times(10,function(){var e=i.entity.post(),n=new u({title:e.title,content:e.content,author:i.random.arrayElement(t)._id});n.save(function(e){if(e)return o.warn("Unable to create default posts!",e)})})}))})}},function(e,t,n){"use strict";var o=(n(1),n(12),n(23),n(24)),r=o.Schema,i=n(34)("devices"),s=n(25),a={timestamps:!0,toObject:{virtuals:!0},toJSON:{virtuals:!0}},u=new r({address:{type:String,trim:!0},type:{type:String,trim:!0},name:{type:String,trim:!0},description:{type:String,trim:!0,"default":""},status:{type:Number,"default":1},lastCommunication:{type:Date,"default":Date.now},metadata:{}},a);u.virtual("code").get(function(){return this.encodeID()}),u.plugin(s.plugin,{model:"Device",startAt:1}),u.methods.encodeID=function(){return i.encodeHex(this._id)},u.methods.decodeID=function(e){return i.decodeHex(e)};var c=o.model("Device",u);e.exports=c},function(e,t,n){"use strict";var o=(n(1),n(12),n(23),n(24)),r=o.Schema,i=n(34)("posts"),s=n(25),a={timestamps:!0,toObject:{virtuals:!0},toJSON:{virtuals:!0}},u=new r({title:{type:String,trim:!0},content:{type:String,trim:!0},author:{type:Number,required:"Please fill in an author ID",ref:"User"},views:{type:Number,"default":0},upVoters:{type:[Number]},downVoters:{type:[Number]},votes:{type:Number,"default":0},metadata:{}},a);u.virtual("code").get(function(){return this.encodeID()}),u.plugin(s.plugin,{model:"Post",startAt:1}),u.methods.encodeID=function(){return i.encodeHex(this._id)},u.methods.decodeID=function(e){return i.decodeHex(e)};var c=o.model("Post",u);e.exports=c},function(e,t,n){"use strict";function o(e){e.locals.app=f.app,e.use(function(e,t,n){return t.locals.url=e.protocol+"://"+e.headers.host+e.url,n()}),e.locals.year=v().format("YYYY"),e.locals.disableSignUp=f.disableSignUp||!1}function r(e){if(e.use(R({filter:function(e,t){return/json|text|javascript|css/.test(t.getHeader("Content-Type"))},level:3})),e.set("port",f.port),e.use(b.urlencoded({extended:!0,limit:2*f.contentMaxLength})),e.use(S()),e.use(b.json()),e.use(D()),f.isProductionMode()&&(e.use(E({cache:{max:100}})),e.use(m["static"](g.join(N,"public")))),e.use(y(g.join(N,"public","favicon.ico"))),e.use(x()),e.set("etag",!0),e.use(h()),f.isDevMode()){var t=n(59),o=new t.Stream;o.writable=!0,o.write=function(e){return d.debug(e)},e.use(w("dev",{stream:o}))}}function i(e){var t={fallbackLng:"en",whitelist:["en","hu"],ns:["app","frontend"],defaultNS:"frontend",load:"all",saveMissing:!0,saveMissingTo:"all",backend:{loadPath:g.join(N,"locales","{{lng}}","{{ns}}.json"),addPath:g.join(N,"locales","{{lng}}","{{ns}}.missing.json"),jsonIndent:4}};f.isTestMode()&&(t.whitelist=["en"]),I.use(q).use(T.LanguageDetector).init(t,function(e,t){e&&d.warn(e)}),I.on("failedLoading",function(e,t,n){console.log("failedLoading",e,t,n)}),e.use(T.handle(I)),e.get("/locales/resources.json",T.getResourcesHandler(I)),e.post("/locales/add/:lng/:ns",T.missingKeyHandler(I))}function s(e){e.set("views",g.join(N,"views")),e.set("view engine","jade"),f.isDevMode()?(e.set("showStackError",!0),e.set("view cache",!1),e.use(O.noCache()),e.locals.pretty=!0):(e.locals.cache="memory",e.set("view cache",!0))}function a(e,t){e.use(k({saveUninitialized:!0,resave:!0,secret:p.sessionSecret,store:new U({mongooseConnection:t.connection,collection:f.sessions.collection,autoReconnect:!0}),cookie:f.sessions.cookie,name:f.sessions.name}))}function u(e){e.use(O.xssFilter()),e.use(O.noSniff()),e.use(O.ieNoOpen()),e.use(j()),e.use(O.hidePoweredBy())}function c(e){n(60)(e),!f.isTestMode()}function l(e){if(!f.isProductionMode()){var t=n(76),o=n(77),r=t(o),i=n(81);e.use(i(r,{noInfo:!0,publicPath:o.output.publicPath,headers:{"Access-Control-Allow-Origin":"*"},stats:{colors:!0}}));var s=n(82);e.use(s(r,{log:d.info}))}}var d=n(12),f=n(1),p=n(8),m=n(40),g=(n(41),n(2)),v=n(21),h=n(42),y=n(43),w=n(44),b=n(45),x=n(46),S=n(47),E=(n(48),n(49)),k=n(50),R=n(51),D=n(52),O=n(53),j=n(54),U=(n(24),n(55)(k)),I=n(56),T=n(57),q=n(58),N=g.normalize(g.join(f.rootPath,"server"));e.exports=function(e){var t=m();o(t),r(t),s(t),u(t),i(t),a(t,e),c(t),l(t),n(83)(t,e);var d=n(98).init(t,e);return d._app=t,d}},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("express-flash")},function(e,t){e.exports=require("serve-favicon")},function(e,t){e.exports=require("morgan")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("express-validator")},function(e,t){e.exports=require("csurf")},function(e,t){e.exports=require("netjet")},function(e,t){e.exports=require("express-session")},function(e,t){e.exports=require("compression")},function(e,t){e.exports=require("method-override")},function(e,t){e.exports=require("helmet")},function(e,t){e.exports=require("helmet-crossdomain")},function(e,t){e.exports=require("connect-mongo")},function(e,t){e.exports=require("i18next")},function(e,t){e.exports=require("i18next-express-middleware")},function(e,t){e.exports=require("i18next-node-fs-backend")},function(e,t){e.exports=require("stream")},function(e,t,n){"use strict";var o=n(12),r=(n(1),n(61)),i=n(2),s=n(9),a=n(30);e.exports=function(e){function t(e){return e.keys().map(function(t){o.info("  Loading passport strategy file "+i.basename(t)+"...");var n=e(t);return n(),n})}e.use(r.initialize()),e.use(r.session()),r.serializeUser(function(e,t){return t(null,e.id)}),r.deserializeUser(function(e,t){a.findOne({_id:e},"-password",function(e,n){return t(e,n)})}),o.info(""),o.info(s.bold("Search passport strategies..."));t(n(62))}},function(e,t){e.exports=require("passport")},function(e,t,n){function o(e){return n(r(e))}function r(e){return i[e]||function(){throw new Error("Cannot find module '"+e+"'.")}()}var i={"./apikey.js":63,"./facebook.js":65,"./github.js":68,"./google.js":70,"./local.js":72,"./twitter.js":74};o.keys=function(){return Object.keys(i)},o.resolve=r,e.exports=o,o.id=62},function(e,t,n){"use strict";var o=n(61),r=n(64).Strategy,i=n(30);e.exports=function(){o.use(new r({passReqToCallback:!0},function(e,t,n){return i.findOne({apiKey:t},function(t,o){return t?n(t):o?o.verified?n(null,o):n(null,!1,{message:e.t("PleaseActivateAccount")}):n(null,!1,{message:e.t("UnknowAPIKey")})})}))}},function(e,t){e.exports=require("passport-localapikey-update")},function(e,t,n){"use strict";var o=(n(12),n(1),n(8)),r=n(66),i=n(61),s=n(67).Strategy;n(30);e.exports=function(){o.apiKeys&&o.apiKeys.facebook&&o.apiKeys.facebook.clientID&&i.use("facebook",new s({clientID:o.apiKeys.facebook.clientID,clientSecret:o.apiKeys.facebook.clientSecret,callbackURL:"/auth/facebook/callback",profileFields:["name","email","link","locale","timezone"],passReqToCallback:!0},function(e,t,n,o,i){r.linkToSocialAccount({req:e,accessToken:t,refreshToken:n,profile:o,done:i,provider:"facebook",email:o._json.email,userData:{name:o.name.givenName+" "+o.name.familyName,gender:o._json.gender,picture:"https://graph.facebook.com/"+o.id+"/picture?type=large",location:o._json.location?o._json.location.name:null}})}))}},function(e,t,n){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},r=(n(12),n(1)),i=n(61),s=n(30);e.exports.isAuthenticated=function(e,t,n){return e.isAuthenticated()?n():t.sendStatus(401)},e.exports.isAuthenticatedOrApiKey=function(e,t,n){return e.isAuthenticated()?n():e.headers.apikey||e.query.apikey||e.body.apikey?void i.authenticate("localapikey",function(o,r,i){return o?t.sendStatus(500):r?void e.login(r,function(e){return e?t.sendStatus(500):n()}):t.status(401).send(i.message||"")})(e,t,n):t.sendStatus(401)},e.exports.hasRole=function(t){if(!t)throw new Error("Required role needs to be set");return function(n,o,r){return e.exports.isAuthenticated(n,o,function(){n.user&&n.user.roles&&n.user.roles.indexOf(t)!==-1?r():o.sendStatus(403)})}},e.exports.hasAdminRole=function(){return e.exports.hasRole("admin")},e.exports.linkToSocialAccount=function(e){var t=e.req,n=(e.accessToken,e.refreshToken,e.profile),i=e.done,a=e.provider,u=e.email,c=e.userData;if(t.user){var l={};l["socialLinks."+a]=n.id,s.findOne(l,function(e,o){return o?o._id!=t.user._id?(t.flash("error",{msg:t.t("SocialIDLinkedToOtherAccount")}),i(e)):i(e,o):void s.findById(t.user.id,function(e,o){o.socialLinks=o.socialLinks||{},o.socialLinks[a]=n.id,o.profile=o.profile||{},o.profile.name=o.profile.name||c.name,o.profile.gender=o.profile.gender||c.gender,o.profile.picture=o.profile.picture||c.picture,o.profile.location=o.profile.location||c.location,o.save(function(e){t.flash("info",{msg:t.t("AccountHasBeenLinked")}),i(e,o)})})})}else{var d={};d["socialLinks."+a]=n.id,s.findOne(d,function(e,l){return l?i(e,l):u?void s.findOne({email:u},function(e,l){if(l){var d=function(){var e=l;return e.socialLinks=e.socialLinks||{},e.socialLinks[a]=n.id,e.profile=e.profile||{},e.profile.name=e.profile.name||c.name,e.profile.gender=e.profile.gender||c.gender,e.profile.picture=e.profile.picture||c.picture,e.profile.location=e.profile.location||c.location,e.save(function(n){t.flash("info",{msg:t.t("AccountHasBeenLinked")}),i(n,e)}),{v:void 0}}();if("object"===("undefined"==typeof d?"undefined":o(d)))return d.v}if(r.disableSignUp===!0)return t.flash("error",{msg:t.t("SignUpDisabledPleaseLogin")}),i();var f=new s;f.fullName=c.name,f.email=u,f.username=u,f.provider=a,f.verified=!0,f.passwordLess=!0,f.socialLinks={},f.socialLinks[a]=n.id,f.profile=c,f.save(function(e){i(e,f)})}):(t.flash("error",{msg:t.t("SocialMissingEmailAddress")}),i())})}}},function(e,t){e.exports=require("passport-facebook")},function(e,t,n){"use strict";var o=(n(12),n(1),n(8)),r=n(66),i=n(61),s=n(69).Strategy;n(30);e.exports=function(){o.apiKeys&&o.apiKeys.github&&o.apiKeys.github.clientID&&i.use("github",new s({clientID:o.apiKeys.github.clientID,clientSecret:o.apiKeys.github.clientSecret,callbackURL:"/auth/github/callback",passReqToCallback:!0},function(e,t,n,o,i){r.linkToSocialAccount({req:e,accessToken:t,refreshToken:n,profile:o,done:i,provider:"github",email:o._json.email,userData:{name:o.displayName,gender:null,picture:o._json.avatar_url,location:o._json.location}})}))}},function(e,t){e.exports=require("passport-github")},function(e,t,n){"use strict";var o=(n(12),n(1),n(8)),r=n(66),i=n(61),s=n(71).OAuth2Strategy;n(30);e.exports=function(){o.apiKeys&&o.apiKeys.google&&o.apiKeys.google.clientID&&i.use("google",new s({clientID:o.apiKeys.google.clientID,clientSecret:o.apiKeys.google.clientSecret,callbackURL:"/auth/google/callback",passReqToCallback:!0},function(e,t,n,o,i){r.linkToSocialAccount({req:e,accessToken:t,refreshToken:n,profile:o,done:i,provider:"google",email:o.emails[0].value,userData:{name:o.displayName,gender:o._json.gender,picture:o._json.image.url,location:null}})}))}},function(e,t){e.exports=require("passport-google-oauth")},function(e,t,n){"use strict";var o=n(61),r=n(73).Strategy,i=n(30);e.exports=function(){o.use(new r({usernameField:"username",passwordField:"password",passReqToCallback:!0},function(e,t,n,o){return i.findOne({$or:[{username:t},{email:t}]},function(t,r){return t?o(t):r?r.verified?r.passwordLess?o(null,!1,{message:e.t("PasswordlessAccountLeaveEmpty")}):void r.comparePassword(n,function(t,n){return t?o(t):n!==!0?o(null,!1,{message:e.t("InvalidPassword")}):o(null,r)}):o(null,!1,{message:e.t("PleaseActivateAccount")}):o(null,!1,{message:e.t("UnknowUsernameOrEmail")})})}))}},function(e,t){e.exports=require("passport-local")},function(e,t,n){"use strict";var o=(n(12),n(1),n(8)),r=n(66),i=n(61),s=n(75).Strategy;n(30);e.exports=function(){o.apiKeys&&o.apiKeys.twitter&&o.apiKeys.twitter.clientID&&i.use("twitter",new s({consumerKey:o.apiKeys.twitter.clientID,consumerSecret:o.apiKeys.twitter.clientSecret,callbackURL:"/auth/twitter/callback",passReqToCallback:!0},function(e,t,n,o,i){r.linkToSocialAccount({req:e,accessToken:t,refreshToken:n,profile:o,done:i,provider:"twitter",email:o.username+"@twitter.com",userData:{name:o.displayName,gender:null,picture:o._json.profile_image_url_https,location:o._json.location}})}))}},function(e,t){e.exports=require("passport-twitter")},function(e,t){e.exports=require("webpack")},function(e,t,n){(function(t){"use strict";var o=n(2),r=(n(78),n(76)),i=n(79),s=n(80);e.exports={devtool:"eval-source-map",entry:{app:["webpack-hot-middleware/client","./client/app/main.js"],frontend:["webpack-hot-middleware/client","./client/frontend/main.js"]},output:{path:o.resolve(t,"server","public","app"),publicPath:"/app/",filename:"[name].js",chunkFilename:"[chunkhash].js"},module:{loaders:[{test:/\.css$/,loader:"style!css"},{test:/\.scss$/,loaders:["style","css","postcss","sass"]},{test:/\.json$/,loader:"json-loader"},{test:/\.js$/,loader:"babel",exclude:[/node_modules/,/vendor/],query:{presets:["es2015","stage-0"]}},{test:/\.vue$/,loader:"vue"},{test:/\.gif$/,loader:"url-loader?name=images/[name]-[hash:6].[ext]&limit=100000"},{test:/\.png$/,loader:"url-loader?name=images/[name]-[hash:6].[ext]&limit=100000"},{test:/\.jpg$/,loader:"file-loader?name=images/[name]-[hash:6].[ext]"},{test:/\.woff$/,loader:"url-loader?prefix=font/&limit=5000&mimetype=application/font-woff"},{test:/\.ttf$/,loader:"file-loader?prefix=font/"},{test:/\.eot$/,loader:"file-loader?prefix=font/"},{test:/\.svg$/,loader:"file-loader?prefix=font/"}]},resolve:{extensions:["",".vue",".js",".json"],alias:{images:o.resolve(t,"client","images")}},plugins:[new r.HotModuleReplacementPlugin,new r.NoErrorsPlugin],postcss:function(){return[s({browsers:["last 2 versions"]}),i]},vue:{autoprefixer:{browsers:["last 2 versions"]}}}}).call(t,"")},function(e,t){e.exports=require("glob")},function(e,t){e.exports=require("precss")},function(e,t){e.exports=require("autoprefixer")},function(e,t){e.exports=require("webpack-dev-middleware")},function(e,t){e.exports=require("webpack-hot-middleware")},function(e,t,n){"use strict";n(1),n(12),n(2);e.exports=function(e,t){e.get("/",function(e,t){null!=e.user?t.render("main",{user:e.user}):t.render("index")}),n(84)(e,t),n(92)(e,t),n(93)(e,t),n(108)(e,t),n(118)(e,t)}},function(e,t,n){"use strict";function o(){var e={};return s.apiKeys&&(s.apiKeys.google&&s.apiKeys.google.clientID&&(e.google=!0),s.apiKeys.facebook&&s.apiKeys.facebook.clientID&&(e.facebook=!0),s.apiKeys.github&&s.apiKeys.github.clientID&&(e.github=!0),s.apiKeys.twitter&&s.apiKeys.twitter.clientID&&(e.twitter=!0)),Object.keys(e).length>0?e:null}var r=n(1),i=n(12),s=n(8),a=n(27),u=n(32),c=n(85),l=(n(61),n(40),n(86)),d=n(87),f=n(30);e.exports=function(e,t){e.get("/login",function(e,t){return null!=e.user?t.redirect("/"):void t.render("account/login",{socialAuth:o()})}),e.get("/logout",function(e,t){e.logout(),t.redirect("/")}),e.get("/signup",function(e,t){return r.disableSignUp===!0?t.redirect("/login"):void t.render("account/signup",{socialAuth:o()})}),e.post("/signup",function(e,t){if(r.disableSignUp===!0)return t.redirect("/");e.assert("name",e.t("NameCannotBeEmpty")).notEmpty(),e.assert("email",e.t("EmailCannotBeEmpty")).notEmpty(),e.assert("email",e.t("EmailIsNotValid")).isEmail(),e.sanitize("email").normalizeEmail({remove_dots:!1}),e.body.username||(e.body.username=e.body.email),e.sanitize("passwordless").toBoolean();var n=e.body.passwordless===!0;n||(e.assert("password",e.t("PasswordCannotBeEmpty")).notEmpty(),e.assert("password",e.t("PasswordTooShort")).len(6));var o=e.validationErrors();return o?(e.flash("error",o),t.redirect("/signup")):void c.waterfall([function(e){r.verificationRequired?u.randomBytes(25,function(t,n){e(t,t?null:n.toString("hex"))}):e(null,null)},function s(t,n){s?u.randomBytes(25,function(e,o){n(e,t,e?null:o.toString("hex"))}):n(null,t,e.body.password)},function(t,n,o){var r=new f({fullName:e.body.name,email:e.body.email,username:e.body.username,password:n,roles:["user"],provider:"local"});t?(r.verified=!1,r.verifyToken=t):r.verified=!0,r.save(function(t,n){if(t&&11e3===t.code){var r=t.message.split(".$")[1];r=r.split(" dup key")[0],r=r.substring(0,r.lastIndexOf("_")),"email"==r?e.flash("error",{msg:e.t("EmailIsExists")}):e.flash("error",{msg:e.t("UsernameIsExists")})}o(t,n)})},function(n,o){n.verified?!function(){var i=e.t("mailSubjectWelcome",r);t.render("mail/welcome",{name:n.fullName},function(e,t){return e?o(e):void d.send(n.email,i,t,function(e,t){o(null,n)})})}():!function(){var i=e.t("mailSubjectActivate",r);t.render("mail/accountVerify",{name:n.fullName,validateLink:"http://"+e.headers.host+"/verify/"+n.verifyToken},function(t,r){return t?o(t):void d.send(n.email,i,r,function(t,r){t?e.flash("error",{msg:e.t("UnableToSendEmail",n)}):e.flash("info",{msg:e.t("emailSentVerifyLink")}),o(t,n)})})}()}],function(n,o){return n?(i.error(n),t.redirect("back")):void(o.verified?e.login(o,function(e){return e&&i.error(e),t.redirect("/")}):t.redirect("/login"))})}),e.get("/verify/:token",function(e,t){return e.isAuthenticated()?t.redirect("/"):void c.waterfall([function(t){f.findOne({verifyToken:e.params.token}).exec(function(n,o){return n?t(n):o?(o.verified=!0,o.verifyToken=void 0,o.lastLogin=Date.now(),void o.save(function(n){return n?(e.flash("error",{msg:e.t("UnableModifyAccountDetails")}),t(n)):void t(null,o)})):(e.flash("error",{msg:e.t("AccountVerificationExpired")}),t("Verification is invalid!"))})},function(n,o){var i=e.t("mailSubjectWelcome",r);t.render("mail/welcome",{name:n.fullName},function(e,t){return e?o(e):void d.send(n.email,i,t,function(e,t){o(null,n)})})},function(t,n){e.login(t,function(e){n(e,t)})}],function(e){return e?(i.error(e),t.redirect("/signup")):void t.redirect("/")})}),e.get("/passwordless/:token",function(e,t){return e.isAuthenticated()?t.redirect("/"):void c.waterfall([function(t){f.findOne({passwordLessToken:e.params.token}).exec(function(n,o){return n?t(n):o?(o.passwordLessToken=void 0,o.verified||(o.verified=!0,o.verifyToken=void 0),o.lastLogin=Date.now(),void o.save(function(n){return n?(e.flash("error",{msg:e.t("UnableModifyAccountDetails")}),t(n)):void t(null,o)})):(e.flash("error",{msg:e.t("PasswordlessTokenExpired")}),t("Token is invalid!"))})},function(t,n){e.login(t,function(e){n(e,t)})}],function(e){return e?(i.error(e),t.redirect("/login")):void t.redirect("/")})}),e.get("/forgot",function(e,t){return e.isAuthenticated()?t.redirect("/"):void t.render("account/forgot")}),e.post("/forgot",function(e,t){e.assert("email",e.t("EmailIsNotValid")).isEmail(),e.assert("email",e.t("EmailCannotBeEmpty")).notEmpty(),e.sanitize("email").normalizeEmail({remove_dots:!1});var n=e.validationErrors();return n?(e.flash("error",n),t.redirect("back")):void c.waterfall([function(e){u.randomBytes(25,function(t,n){e(t,t?null:n.toString("hex"))})},function(t,n){f.findOne({email:e.body.email},function(o,r){return r?(r.resetPasswordToken=t,r.resetPasswordExpires=Date.now()+36e5,void r.save(function(e){n(e,t,r)})):(e.flash("error",{msg:e.t("EmailNotAssociatedToAccount",e.body)}),n("Email address "+e.body.email+" is not registered!"))})},function(n,o,i){var s=e.t("mailSubjectResetPassword",r);t.render("mail/passwordReset",{name:o.fullName,resetLink:"http://"+e.headers.host+"/reset/"+n},function(t,n){return t?i(t):void d.send(o.email,s,n,function(t,n){t?e.flash("error",{msg:e.t("UnableToSendEmail",o)}):e.flash("info",{msg:e.t("emailSentPasswordResetLink",o)}),i(t)})})}],function(e){e&&i.error(e),t.redirect("back")})}),e.get("/reset/:token",function(e,t,n){return e.isAuthenticated()?t.redirect("/"):void f.findOne({resetPasswordToken:e.params.token}).where("resetPasswordExpires").gt(Date.now()).exec(function(o,r){return o?n(o):r?void t.render("account/reset"):(e.flash("error",{msg:e.t("PasswordResetTokenExpired")}),t.redirect("/forgot"))})}),e.post("/reset/:token",function(e,t,n){e.assert("password",e.t("PasswordTooShort")).len(6),e.assert("confirm",e.t("PasswordNotMatched")).equals(e.body.password);var o=e.validationErrors();return o?(e.flash("error",o),t.redirect("back")):void c.waterfall([function(t){f.findOne({resetPasswordToken:e.params.token}).where("resetPasswordExpires").gt(Date.now()).exec(function(n,o){return n?t(n):o?(o.passwordLess&&(o.passwordLess=!1),o.password=e.body.password,o.resetPasswordToken=void 0,o.resetPasswordExpires=void 0,o.lastLogin=Date.now(),void o.save(function(n){return n?t(n):void e.login(o,function(e){t(e,o)})})):(e.flash("error",{msg:e.t("PasswordResetTokenExpired")
}),t("Password reset token is invalid or has expired."))})},function(n,o){var i=e.t("mailSubjectPasswordChanged",r);t.render("mail/passwordChange",{name:n.fullName},function(t,r){return t?o(t):void d.send(n.email,i,r,function(t,r){t?e.flash("error",{msg:e.t("UnableToSendEmail",n)}):e.flash("info",{msg:e.t("PasswordChanged")}),o(t)})})}],function(e){return e?(i.error(e),t.redirect("back")):void t.redirect("/")})}),e.get("/generateAPIKey",function(e,t){return e.isAuthenticated()?void f.findById(e.user.id).exec(function(n,o){return n?l.json(t,null,l.SERVER_ERROR):o?(o.apiKey=a(),void o.save(function(e){return e?l.json(t,null,l.SERVER_ERROR):l.json(t,o)})):l.json(t,null,l.NOT_FOUND,e.t("InvalidUser"))}):l.json(t,null,l.UNAUTHORIZED)})}},function(e,t){e.exports=require("async")},function(e,t){"use strict";e.exports={BAD_REQUEST:{status:400,type:"BAD_REQUEST",message:"Invalid request"},UNAUTHORIZED:{status:401,type:"UNAUTHORIZED",message:"Unauthorized. Please login first!"},REQUEST_FAILED:{status:402,type:"REQUEST_FAILED",message:"Request failed!"},FORBIDDEN:{status:403,type:"FORBIDDEN",message:"You have no permission for this resource!"},NOT_FOUND:{status:404,type:"NOT_FOUND",message:"Not found!"},TOO_MANY_REQUEST:{status:429,type:"TOO_MANY_REQUEST",message:"Too many request!"},SERVER_ERROR:{status:500,type:"SERVER_ERROR",message:"Server error"},NOT_IMPLEMENTED:{status:501,type:"NOT_IMPLEMENTED",message:"This resource is not implemented!"},json:function(e,t,n,o){var r={};return n?(r.error=n,r.status=n.status||500,o&&(r.error.message=o),r.data=t,e.status(r.status).json(r)):(r.status=200,r.data=t,e.json(r))}}},function(e,t,n){"use strict";var o=n(1),r=n(12),i=n(88),s=n(89).htmlToText;e.exports={send:function(e,t,a,u){r.info("Sending email to "+e+" with subject "+t+"...");var c={from:o.mailer.from,to:e,subject:t,html:a},l=void 0;if("smtp"==o.mailer.transport)l=i.createTransport(o.mailer.smtp);else if("mailgun"==o.mailer.transport){var d=n(90);l=i.createTransport(d({auth:{api_key:o.mailer.mailgun.apiKey,domain:o.mailer.mailgun.domain}}))}else if("sendgrid"==o.mailer.transport){var f=n(91);l=i.createTransport(f({auth:{api_key:o.mailer.sendgrid.apiKey}}))}l?(l.use("compile",s()),l.sendMail(c,function(e,t){e?r.warn("Unable to send email: ",e):r.info("Email message sent.",t.response),u&&u(e,t)})):r.warn("Unable to send email! Invalid mailer transport: "+o.mailer.transport)}}},function(e,t){e.exports=require("nodemailer")},function(e,t){e.exports=require("nodemailer-html-to-text")},function(e,t){e.exports=require("nodemailer-mailgun-transport")},function(e,t){e.exports=require("nodemailer-sendgrid-transport")},function(e,t,n){"use strict";function o(e,t,n,o){if(e.accepts("json")&&!e.accepts("html")){var r=e.flash();if(r&&r.error&&r.error.length>0){var i=r.error[0].msg;f.json(t,null,o||f.REQUEST_FAILED,i)}else{var s="OK";r&&r.info&&r.info.length>0&&(s=r.info[0].msg),f.json(t,s)}}else n&&t.redirect(n)}var r=n(1),i=n(12),s=n(32),a=n(85),u=n(61),c=n(40),l=n(87),d=n(30),f=n(86);e.exports=function(e,t){var n=c.Router();n.post("/local",function(e,t,n){e.assert("username",e.t("UsernameCannotBeEmpty")).notEmpty();var c=e.validationErrors();return c?(e.flash("error",c),o(e,t,"/login",f.BAD_REQUEST)):void(e.body.password?u.authenticate("local",function(n,r,i){return r?void e.login(r,function(n){return n?(e.flash("error",{msg:n}),o(e,t,"/login")):(e.user.lastLogin=Date.now(),void e.user.save(function(){e.user.password=void 0,e.user.salt=void 0,o(e,t,"/")}))}):(e.flash("error",{msg:i.message}),o(e,t,"/login"))})(e,t,n):a.waterfall([function(e){s.randomBytes(25,function(t,n){e(t,t?null:n.toString("hex"))})},function(t,n){var o=e.body.username;d.findOne({username:o},function(r,i){return i?(i.passwordLessToken=t,void i.save(function(e){n(e,t,i)})):(e.flash("error",{msg:e.t("UsernameIsNotAssociated",{username:o})}),n("Invalid username "+o))})},function(n,o,i){var s=e.t("mailSubjectLogin",r);t.render("mail/passwordLessLogin",{name:o.fullName,loginLink:"http://"+e.headers.host+"/passwordless/"+n},function(t,n){return t?i(t):void l.send(o.email,s,n,function(t,n){t?e.flash("error",{msg:e.t("UnableToSendEmail",o)}):e.flash("info",{msg:e.t("emailSentWithMagicLink",o)}),i(t)})})}],function(n,r){n&&i.error(n),o(e,t,"back")}))}),n.get("/google",u.authenticate("google",{scope:"profile email"})),n.get("/google/callback",u.authenticate("google",{failureRedirect:"/login"}),function(e,t){t.redirect("/")}),n.get("/facebook",u.authenticate("facebook",{scope:["email","user_location"]})),n.get("/facebook/callback",u.authenticate("facebook",{failureRedirect:"/login"}),function(e,t){t.redirect("/")}),n.get("/twitter",u.authenticate("twitter")),n.get("/twitter/callback",u.authenticate("twitter",{failureRedirect:"/login"}),function(e,t){t.redirect("/")}),n.get("/github",u.authenticate("github",{scope:"user:email"})),n.get("/github/callback",u.authenticate("github",{failureRedirect:"/login"}),function(e,t){t.redirect("/")}),e.use("/auth",n)}},function(e,t,n){(function(t){"use strict";var o=n(12),r=(n(1),n(2)),i=n(9);e.exports=function(e,s){function a(n){return n.keys().map(function(i){o.info("  Load",r.relative(r.join(t,"modules"),i),"route...");var a=n(i);return a(e,s),a})}o.info(""),o.info(i.bold("Search routes..."));a(n(94))}}).call(t,"server\\applogic")},function(e,t,n){function o(e){return n(r(e))}function r(e){return i[e]||function(){throw new Error("Cannot find module '"+e+"'.")}()}var i={"./counter/routes.js":95,"./devices/routes.js":97,"./posts/routes.js":106,"./session/routes.js":107};o.keys=function(){return Object.keys(i)},o.resolve=r,e.exports=o,o.id=94},function(e,t,n){"use strict";var o=(n(12),n(1),n(66)),r=n(96);e.exports=function(e,t){e.get("/counter",o.isAuthenticated,function(e,t){t.send("Hello Counter! "+r.counter)})}},function(e,t){"use strict";e.exports={counter:0}},function(e,t,n){"use strict";var o=(n(12),n(1),n(40)),r=n(66),i=n(86),s=n(37),a=n(98),u="/devices";e.exports=function(e,t){var n=o.Router();n.use(r.isAuthenticatedOrApiKey),n.route("/").get(function(e,t){s.find({}).exec(function(e,n){return t.format({json:function(){if(0==n.length)return i.json(t,[]);var e=n.map(function(e){return e.toJSON()});return i.json(t,e)}})})}).post(function(e,t){e.assert("name","Device name cannot be blank!").notEmpty();var n=e.validationErrors();if(n)return i.json(t,null,i.BAD_REQUEST,n);var o=new s({address:e.body.address,type:e.body.type,name:e.body.name,description:e.body.description,status:e.body.status});o.save(function(e){if(e)return i.json(t,null,i.SERVER_ERROR,e);var n=o.toJSON();return a.namespaces[u]&&a.namespaces[u].emit("new",n),i.json(t,n)})}),n.param("deviceID",function(e,t,n,o){var r=s.schema.methods.decodeID(o);return null==r||""==r?i.json(t,null,i.BAD_REQUEST,"Invalid Device ID!"):void s.findById(r,function(o,r){return o?i.json(t,null,i.BAD_REQUEST,o):r?(e.device=r,void n()):i.json(t,null,i.NOT_FOUND,"Device not found!")})}),n.route("/:deviceID").all(function(e,t,n){n()}).get(function(e,t){return i.json(t,e.device.toJSON())}).put(function(e,t){null!=e.body.address&&(e.device.address=e.body.address),null!=e.body.type&&(e.device.type=e.body.type),null!=e.body.name&&(e.device.name=e.body.name),null!=e.body.description&&(e.device.description=e.body.description),null!=e.body.status&&(e.device.status=e.body.status),e.device.save(function(n){if(n)return i.json(t,null,i.BAD_REQUEST,n);var o=e.device.toJSON();return a.namespaces[u]&&a.namespaces[u].emit("update",o),i.json(t,o)})})["delete"](function(e,t){s.remove({_id:e.device.id},function(n){return n?i.json(t,null,i.BAD_REQUEST,n):(a.namespaces[u]&&a.namespaces[u].emit("remove",e.device.toJSON()),i.json(t))})}),e.use("/v1"+u,n),e.use(u,n)}},function(e,t,n){"use strict";var o=n(12),r=n(1),i=n(8),s=(n(2),n(10),n(41)),a=n(3),u=n(46),c=n(61),l=n(99),d=n(50),f=n(55)(d),p=n(100),m={namespaces:{},onlineUsers:[],init:function(e,t){var n=s.createServer(e),i=new f({mongooseConnection:t.connection,collection:r.sessions.collection,autoReconnect:!0}),u=l(n);return m.initNameSpace("/",u,i),u.on("connection",function(e){e.on("welcome",function(t){o.info("Incoming welcome message from "+e.request.user.username+":",t)})}),p.handlers.forEach(function(e){if(e&&e.namespace){var t=m.namespaces[e.namespace];null==t&&(t=u.of(e.namespace),m.initNameSpace(e.namespace,t,i,e.role),a.isFunction(e.init)&&e.init(t))}}),e.io=m,n},initNameSpace:function(e,t,n,s){t.use(function(t,a){u(i.sessionSecret)(t.request,{},function(i){var u=t.request.signedCookies?t.request.signedCookies[r.sessions.name]:void 0;return u?void n.get(u,function(r,i){return r?a(r,!1):i?(t.request.session=i,i.socket=t.id,n.set(u,i),void c.initialize()(t.request,{},function(){c.session()(t.request,{},function(){if(t.request.user){var n=t.request.user;s?n.roles&&n.roles.indexOf(s)!==-1?a(null,!0):(o.warn("Websocket user has no access to this namespace '"+e+"'!"),a(new Error("You have NO access to this namespace '"+e+"'!"),!1)):a(null,!0)}else o.warn("Websocket user is not authenticated!"),a(new Error("User is not authenticated! Please login first!"),!1)})})):a(new Error("session was not found for "+u),!1)}):(o.warn("sessionId was not found in socket.request"),a(new Error("sessionId was not found in socket.request"),!1))})}),t.on("connection",function(e){m.addOnlineUser(e.request.user),o.debug("WS client connected to namespace "+(t.name||"root")+"! User: "+e.request.user.username),e.on("disconnect",function(){m.removeOnlineUser(e.request.user),o.debug("WS client disconnected from namespace "+(t.name||"root")+"!")})}),m.namespaces[e]=t},nsEmit:function(e,t,n){if(m.namespaces[e])return m.namespaces[e].emit(t,n),!0},addOnlineUser:function(e){m.removeOnlineUser(e),m.onlineUsers.push(e)},removeOnlineUser:function(e){a.remove(m.onlineUsers,function(t){return t._id==e._id})}};e.exports=m},function(e,t){e.exports=require("socket.io")},function(e,t,n){(function(t){"use strict";function o(e){return e.keys().map(function(n){return r.info("  Load",i.relative(i.join(t,"modules"),n),"handler..."),e(n)})}var r=n(12),i=(n(1),n(2)),s=n(9);r.info(""),r.info(s.bold("Search socket handlers...")),e.exports.handlers=o(n(101))}).call(t,"server\\applogic")},function(e,t,n){function o(e){return n(r(e))}function r(e){return i[e]||function(){throw new Error("Cannot find module '"+e+"'.")}()}var i={"./counter/socket.js":102,"./devices/socket.js":103,"./posts/socket.js":104};o.keys=function(){return Object.keys(i)},o.resolve=r,e.exports=o,o.id=101},function(e,t,n){"use strict";var o=n(12),r=(n(1),n(96));e.exports={namespace:"/counter",init:function(e){e.on("connection",function(e){e.on("changed",function(t){r.counter=t,o.info(e.request.user.username+" increment the counter to ",r.counter),e.broadcast.emit("changed",r.counter)}),e.emit("changed",r.counter)})}}},function(e,t,n){"use strict";n(12),n(1);e.exports={namespace:"/devices",init:function(e){e.on("connection",function(e){})}}},function(e,t,n){"use strict";var o=(n(12),n(1),n(105));e.exports={namespace:o.namespace,init:function(e){e.on("connection",function(e){})}}},function(e,t){e.exports={namespace:"/posts"}},function(e,t,n){"use strict";var o=(n(12),n(1),n(105)),r=n(40),i=n(85),s=n(66),a=n(86),u=n(38),c=n(98);e.exports=function(e,t){var n=r.Router();n.use(s.isAuthenticatedOrApiKey),n.use(s.hasRole("user")),n.get("/upvote/:postID",function(e,t){i.waterfall([function(t){e.post.upVoters.indexOf(e.user.id)!==-1?t(e.t("YouHaveAlreadyVotedThisPost")):t()},function(t){e.post.downVoters.indexOf(e.user.id)!==-1?u.findByIdAndUpdate(e.post.id,{$pull:{downVoters:e.user.id},$inc:{votes:1}},{"new":!0},t):t(null,null)},function(t,n){u.findByIdAndUpdate(e.post.id,{$addToSet:{upVoters:e.user.id},$inc:{votes:1}},{"new":!0},n)},function(e,t){e.populate("author","fullName code email gravatar",t)}],function(e,n){if(e)return a.json(t,null,a.BAD_REQUEST,e);var r=n.toJSON();return c.namespaces[o.namespace]&&c.namespaces[o.namespace].emit("update",r),a.json(t,r)})}),n.get("/downvote/:postID",function(e,t){Promise.resolve().then(function(){if(e.post.downVoters.indexOf(e.user.id)!==-1)throw new Error(e.t("YouHaveAlreadyVotedThisPost"))}).then(function(){if(e.post.upVoters.indexOf(e.user.id)!==-1)return u.findByIdAndUpdate(e.post.id,{$pull:{upVoters:e.user.id},$inc:{votes:-1}},{"new":!0})}).then(function(){return u.findByIdAndUpdate(e.post.id,{$addToSet:{downVoters:e.user.id},$inc:{votes:-1}},{"new":!0})}).then(function(e){return u.populate(e,{path:"author",select:"fullName code email gravatar"})}).then(function(e){var n=e.toJSON();c.namespaces[o.namespace]&&c.namespaces[o.namespace].emit("update",n),a.json(t,n)})["catch"](function(e){a.json(t,null,a.BAD_REQUEST,e.message)})}),n.get("/:viewMode/:sort",function(e,t){var n={};"my"==e.params.viewMode&&(n.author=e.user.id);var o=u.find(n);switch(e.params.sort){case"hot":o.sort({votes:-1});break;case"mostviewed":o.sort({views:-1});break;default:o.sort({createdAt:-1})}e.query.limit&&o.limit(e.query.limit||20),o.populate("author","fullName code email gravatar"),o.exec(function(e,n){if(!n||0==n.length)return a.json(t,[]);var o=n.map(function(e){return e.toJSON()});return a.json(t,o)})}),n.post("/",function(e,t){e.assert("title",e.t("PostTitleCannotBeEmpty")).notEmpty(),e.assert("content",e.t("PostContentCannotBeEmpty")).notEmpty();var n=e.validationErrors();if(n)return a.json(t,null,a.BAD_REQUEST,n);var r=new u({title:e.body.title,content:e.body.content,author:e.user.id});r.save(function(e){return e?a.json(t,null,a.SERVER_ERROR,e):void r.populate("author","fullName code email gravatar",function(e){var n=r.toJSON();return c.namespaces[o.namespace]&&c.namespaces[o.namespace].emit("new",n),a.json(t,n)})})}),n.param("postID",function(e,t,n,o){var r=u.schema.methods.decodeID(o);return null==r||""==r?a.json(t,null,a.BAD_REQUEST,e.t("InvalidPostID")):void u.findById(r,function(o,r){return o?a.json(t,null,a.BAD_REQUEST,o):r?void r.populate("author","fullName code email gravatar",function(t){e.post=r,n()}):a.json(t,null,a.NOT_FOUND,e.t("PostNotFound"))})}),n.route("/:postID").all(function(e,t,n){n()}).get(function(e,t){return u.findByIdAndUpdate(e.post.id,{$inc:{views:1}}).exec(),a.json(t,e.post.toJSON())}).put(function(e,t){e.assert("title",e.t("PostTitleCannotBeEmpty")).notEmpty(),e.assert("content",e.t("PostContentCannotBeEmpty")).notEmpty();var n=e.validationErrors();return n?a.json(t,null,a.BAD_REQUEST,n):e.post.author.id!=e.user.id?a.json(t,null,a.BAD_REQUEST,e.t("OnlyAuthorEditPost")):(e.post.title=e.body.title,e.post.content=e.body.content,void e.post.save(function(n){if(n)return a.json(t,null,a.BAD_REQUEST,n);var r=e.post.toJSON();return c.namespaces[o.namespace]&&c.namespaces[o.namespace].emit("update",r),a.json(t,r)}))})["delete"](function(e,t){return e.post.author.id!=e.user.id?a.json(t,null,a.BAD_REQUEST,e.t("OnlyAuthorDeletePost")):void u.remove({_id:e.post.id},function(n){return n?a.json(t,null,a.BAD_REQUEST,n):(c.namespaces[o.namespace]&&c.namespaces[o.namespace].emit("remove",e.post.toJSON()),a.json(t))})}),e.use("/v1/posts",n),e.use("/posts",n)}},function(e,t,n){"use strict";var o=(n(12),n(1),n(3)),r=n(40),i=n(66),s=n(86),a=n(98),u=(n(30),"/session");e.exports=function(e,t){var n=r.Router();n.use(i.isAuthenticatedOrApiKey),n.get("/me",function(e,t){s.json(t,e.user.pick(["code","fullName","email","username","roles","lastLogin","gravatar","provider","profile","socialLinks","apiKey","passwordLess"]))}),n.get("/onlineUsers",function(e,t){var n=o.map(a.onlineUsers,function(e){return e.pick()});s.json(t,n)}),e.use("/v1"+u,n),e.use(u,n)}},function(e,t,n){"use strict";var o=n(1),r=n(12),i=n(66),s=n(109).apolloServer,a=n(110),u=n(111).schema,c=n(111).resolvers;e.exports=function(e,t){var n=a.makeExecutableSchema({typeDefs:u,resolvers:c});e.use("/graphql",i.isAuthenticatedOrApiKey,s(function(e){var t=e.query.query||e.body.query;if(t&&t.length>2e3)throw new Error("Query too large.");return r.debug("GraphQL query:",t),{graphiql:o.isDevMode(),pretty:o.isDevMode(),printErrors:o.isDevMode(),schema:n,context:{req:e,t:e.t,user:e.user,session:e.session}}}))}},function(e,t){e.exports=require("apollo-server")},function(e,t){e.exports=require("graphql-tools")},function(e,t,n){(function(t){"use strict";function o(e){return e.keys().map(function(n){return i.info("  Load",s.relative(s.join(t,"..","applogic","modules"),n),"schema..."),e(n)})}function r(e){return f.forEach(function(t){e=u.merge(e,t)}),e}var i=n(12),s=(n(1),n(110),n(2)),a=n(9),u=n(3),c=[],l=[],d=[],f=[];i.info(""),i.info(a.bold("Search GraphQL schemas..."));var p=o(n(112));p=p.concat(o(n(115))),p.forEach(function(e){c.push(e.schema.query),l.push(e.schema.typeDefinitions),d.push(e.schema.mutation),f.push(e.resolvers)});var m="\n\nscalar Timestamp\n\ntype Query {\n\t"+c.join("\n")+"\n}\n\n"+l.join("\n")+"\n\ntype Mutation {\n\t"+d.join("\n")+"\n}\n\nschema {\n  query: Query\n  mutation: Mutation\n}\n";e.exports={schema:[m],resolvers:r({Timestamp:{__parseValue:function(e){return new Date(e)},__serialize:function(e){return e.getTime()},__parseLiteral:function(e){console.log(e)}}})}}).call(t,"server\\schema")},function(e,t,n){function o(e){return n(r(e))}function r(e){return i[e]||function(){throw new Error("Cannot find module '"+e+"'.")}()}var i={"./user.schema.js":113};o.keys=function(){return Object.keys(i)},o.resolve=r,e.exports=o,o.id=112},function(e,t,n){"use strict";var o=(n(12),n(1),n(3),n(31)),r=n(38),i=n(30),s=n(114),a=(n(98),"\n\tusers(limit: Int, offset: Int, sort: String): [User]\n\tuser(id: Int, code: String): User\n"),u="\ntype User {\n\tid: Int!\n\tcode: String!\n\tfullName: String\n\temail: String\n\tusername: String\n\tprovider: String\n\troles: [String]\n\tverified: Boolean\n\tgravatar: String\n\tlastLogin: Timestamp\n\tposts(limit: Int, offset: Int, sort: String): [Post]\n}\n",c="\n",l={Query:{users:function(e,t,n){return s.hasRole(n,o.ROLE_ADMIN)?s.applyLimitOffsetSort(i.find({}),t).exec():null},user:function(e,t,n){if(!s.hasRole(n,o.ROLE_ADMIN))return null;var r=t.id;return t.code&&(r=i.schema.methods.decodeID(t.code)),r?i.findById(r).exec():void 0}},User:{posts:function(e,t,n){return s.hasRole(n,o.ROLE_USER)?s.applyLimitOffsetSort(r.find({author:e.id}),t).exec():null}},Mutation:{}};e.exports={schema:{query:a,typeDefinitions:u,mutation:c},resolvers:l}},function(e,t){"use strict";function n(e,t){return t.limit&&e.limit(t.limit),t.offset&&e.skip(t.offset),t.sort&&e.sort(t.sort),e}function o(e,t){return e.user.roles.indexOf(t)!=-1}e.exports={applyLimitOffsetSort:n,hasRole:o}},function(e,t,n){function o(e){return n(r(e))}function r(e){return i[e]||function(){throw new Error("Cannot find module '"+e+"'.")}()}var i={"./devices/schema.js":116,"./posts/schema.js":117};o.keys=function(){return Object.keys(i)},o.resolve=r,e.exports=o,o.id=115},function(e,t,n){"use strict";var o=(n(12),n(1),n(3),n(85),n(31)),r=n(37),i=n(114),s="\n\tdevices(limit: Int, offset: Int, sort: String): [Device]\n\tdevice(id: Int, code: String): Device\n",a="\ntype Device {\n\tid: Int!\n\tcode: String!\n\taddress: String\n\ttype: String\n\tname: String\n\tdescription: String\n\tstatus: Int\n\tlastCommunication: Timestamp\n}\n",u="",c={Query:{devices:function(e,t,n){return i.hasRole(n,o.ROLE_USER)?i.applyLimitOffsetSort(r.find({}),t).exec():null},device:function(e,t,n){if(!i.hasRole(n,o.ROLE_USER))return null;var s=t.id;return t.code&&(s=r.schema.methods.decodeID(t.code)),s?r.findById(s).exec():void 0}},Mutation:{}};e.exports={schema:{query:s,typeDefinitions:a,mutation:u},resolvers:c}},function(e,t,n){"use strict";var o=(n(12),n(1),n(105),n(3),n(85)),r=n(31),i=n(38),s=n(30),a=n(98),u=n(114),c="\n\tposts(limit: Int, offset: Int, sort: String): [Post]\n\tpost(id: Int, code: String): Post\n",l="\ntype Post {\n\tid: Int!\n\tcode: String!\n\ttitle: String\n\tcontent: String\n\tauthor: User!\n\tviews: Int\n\tvoters(limit: Int, offset: Int, sort: String): [User]\n\tupVoters(limit: Int, offset: Int, sort: String): [User]\n\tdownVoters(limit: Int, offset: Int, sort: String): [User]\n\tvotes: Int,\n\tcreatedAt: Timestamp\n\tupdatedAt: Timestamp\n}\n",d="\n\tupVote(postID: Int!): Post\n\tdownVote(postID: Int!): Post\n",f={Query:{posts:function(e,t,n){return u.hasRole(n,r.ROLE_USER)?u.applyLimitOffsetSort(i.find({}),t).exec():null},post:function(e,t,n){if(!u.hasRole(n,r.ROLE_USER))return null;var o=t.id;return t.code&&(o=i.schema.methods.decodeID(t.code)),o?i.findById(o).exec():void 0}},Post:{author:function(e,t,n){return u.hasRole(n,r.ROLE_USER)?s.findById(e.author).exec():null},upVoters:function(e,t,n){return u.hasRole(n,r.ROLE_USER)?u.applyLimitOffsetSort(s.find({_id:{$in:e.upVoters}}),t).exec():null},downVoters:function(e,t,n){return u.hasRole(n,r.ROLE_USER)?u.applyLimitOffsetSort(s.find({_id:{$in:e.downVoters}}),t).exec():null},voters:function(e,t,n){return u.hasRole(n,r.ROLE_USER)?u.applyLimitOffsetSort(s.find({_id:{$in:e.upVoters.concat(e.downVoters)}}),t).exec():null}},Mutation:{upVote:function(e,t,n){var s=n.user,c=t.postID;return u.hasRole(n,r.ROLE_USER)?new Promise(function(e,t){o.waterfall([function(e){i.findById(c,e)},function(e,t){e.upVoters.indexOf(s.id)!==-1?t(n.t("YouHaveAlreadyVotedThisPost")):t(null,e)},function(e,t){e.downVoters.indexOf(s.id)!==-1?i.findByIdAndUpdate(c,{$pull:{downVoters:s.id},$inc:{votes:1}},{"new":!0},t):t(null,null)},function(e,t){i.findByIdAndUpdate(c,{$addToSet:{upVoters:s.id},$inc:{votes:1}},{"new":!0},t)},function(e,t){e.populate("author","fullName code email gravatar",t)}],function(n,o){if(n)return t(n);var r=o.toJSON();a.nsemit("update",r),e(o)})}):Promise.reject("Must has 'user' role for this function!")},downVote:function(e,t,n){var o=n.user,s=t.postID;return Promise.resolve().then(function(){if(!u.hasRole(n,r.ROLE_USER))throw new Error("Must has 'user' role for this function!")}).then(function(){return i.findById(s)}).then(function(e){if(e.downVoters.indexOf(o.id)!==-1)throw new Error(n.t("YouHaveAlreadyVotedThisPost"));return e}).then(function(e){if(e.upVoters.indexOf(o.id)!==-1)return i.findByIdAndUpdate(e.id,{$pull:{upVoters:o.id},$inc:{votes:-1}},{"new":!0})}).then(function(e){return i.findByIdAndUpdate(e.id,{$addToSet:{downVoters:o.id},$inc:{votes:-1}},{"new":!0})}).then(function(e){return i.populate(e,{path:"author",select:"fullName code email gravatar"})}).then(function(e){var t=e.toJSON();return a.nsemit("update",t),e})}}};e.exports={schema:{query:c,typeDefinitions:l,mutation:d},resolvers:f}},function(e,t,n){"use strict";var o=n(1),r=n(12),i=n(86);e.exports=function(e,t){e.use(function(e,t,n,o){return e?(r.error(e.stack),n.status(e.status||500),t.accepts("html")?n.render("500",{url:t.originalUrl,error:e}):t.accepts("json")?i.json(n,null,i.SERVER_ERROR):void 0):o()}),e.use(function(e,t){if(t.status(404),o.isTestMode()||r.warn("404 error! URL:",e.url),e.accepts("html")){var n=new Error("404 Page Not Found");return n.status=404,t.render("404",{url:e.originalUrl,error:n})}if(e.accepts("json"))return i.json(t,null,i.NOT_FOUND)})}},function(e,t,n){"use strict";var o=n(12),r=n(1),i=n(21),s=n(9),a=n(120),u=n(30),c=new a({db:{address:r.db.uri,collection:"agendaJobs"},processEvery:r.agendaTimer||"one minute"});c.on("fail",function(e,t){return o.error("Job failed with error: "+e.message)}),c.define("removeUnverifiedAccounts",function(e,t){o.debug("Running 'removeUnverifiedAccounts' process...");try{u.remove({createdAt:{$lte:i().subtract(1,"day").toDate()},verified:!1},function(e,n){n>0&&o.warn(s.bold.red(n+" unverified and expired account removed!")),t()})}catch(n){return o.error("Job running exception!"),o.error(n),t(n)}}),c.on("ready",function(){r.isTestMode()||(c.every("8 hours","removeUnverifiedAccounts"),c.start(),o.info(s.yellow("Agenda started!")))}),e.exports=c},function(e,t){e.exports=require("agenda")},function(e,t,n){"use strict";var o=(n(1),n(12)),r=n(9),i=n(21),s=n(24),a=n(119),u=function(){return 0===s.connection.readyState?process.exit(0):void s.connection.close(function(){return a.stop(function(){return o.info(),o.info(r.bold("---------------------[ Server stopped at %s Uptime: %s ]---------------------------"),i().format("YYYY-MM-DD HH:mm:ss.SSS"),i.duration(1e3*process.uptime()).humanize()),process.exit(0)})})};process.on("SIGINT",u).on("SIGTERM",u)},function(e,t,n){"use strict";var o=n(123),r=n(124),i=n(125),s=n(12);e.exports=function(){var e=r.Gauge,t=o.totalmem(),n=o.freemem(),a=t-n,u=i(n);s.info("CPU:\t\tArch: "+o.arch()+", Cores: "+o.cpus().length),s.info("Memory:\t\t"+e(a,t,20,.8*t,u+" free")),s.info("OS:\t\t"+o.platform()+" ("+o.type()+")")}},function(e,t){e.exports=require("os")},function(e,t){e.exports=require("clui")},function(e,t){e.exports=require("pretty-bytes")}]);
//# sourceMappingURL=bundle.js.map